[{"id":"37c5bb50.a63fe4","type":"tab","label":"Greenhouse Name","disabled":false,"info":""},{"id":"3bde78f1.198038","type":"tab","label":"Initialize","disabled":false,"info":""},{"id":"98e3ec9b.ecb6a","type":"tab","label":"Experiment","disabled":false,"info":""},{"id":"6862f897.ee8958","type":"tab","label":"Alarms","disabled":false,"info":""},{"id":"fd37fbb3.4259f8","type":"tab","label":"Environment","disabled":false,"info":""},{"id":"359ed2dc.ceea6e","type":"tab","label":"Ventilation","disabled":false,"info":""},{"id":"9bcfa612.592b38","type":"tab","label":"Database","disabled":false,"info":""},{"id":"cb9ae06e.42fa8","type":"ui_base","theme":{"name":"theme-custom","lightTheme":{"default":"#0094CE","baseColor":"#0094CE","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":true,"reset":false},"darkTheme":{"default":"#097479","baseColor":"#097479","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":false},"customTheme":{"name":"Profile Name","default":"#4B7930","baseColor":"#0d9749","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","reset":false},"themeState":{"base-color":{"default":"#4B7930","value":"#0d9749","edited":true},"page-titlebar-backgroundColor":{"value":"#0d9749","edited":false},"page-backgroundColor":{"value":"#fafafa","edited":false},"page-sidebar-backgroundColor":{"value":"#ffffff","edited":false},"group-textColor":{"value":"#13dd6b","edited":false},"group-borderColor":{"value":"#ffffff","edited":false},"group-backgroundColor":{"value":"#ffffff","edited":false},"widget-textColor":{"value":"#111111","edited":false},"widget-backgroundColor":{"value":"#0d9749","edited":false},"widget-borderColor":{"value":"#ffffff","edited":false},"base-font":{"value":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"}},"angularTheme":{"primary":"indigo","accents":"blue","warn":"red","background":"grey","palette":"light"}},"site":{"name":"Name of greenhouse","hideToolbar":"false","allowSwipe":"false","lockMenu":"false","allowTempTheme":"true","dateFormat":"DD/MM/YYYY","sizes":{"sx":48,"sy":48,"gx":6,"gy":6,"cx":6,"cy":6,"px":0,"py":0}}},{"id":"1b3d1ecd.f03981","type":"ui_spacer","name":"spacer","group":"","order":5,"width":3,"height":1},{"id":"7d446a01.0d7394","type":"ui_spacer","name":"spacer","group":"","order":5,"width":1,"height":1},{"id":"54999666.6d0978","type":"ui_spacer","name":"spacer","group":"","order":7,"width":1,"height":1},{"id":"144a707c.1ae75","type":"ui_spacer","name":"spacer","group":"","order":5,"width":3,"height":1},{"id":"8a8a1d95.292da","type":"ui_spacer","name":"spacer","group":"","order":5,"width":1,"height":1},{"id":"357b0958.40dce6","type":"ui_spacer","name":"spacer","group":"","order":7,"width":1,"height":1},{"id":"70576d12.e6afc4","type":"ui_spacer","name":"spacer","group":"","order":15,"width":2,"height":1},{"id":"250745a9.0ba41a","type":"ui_spacer","name":"spacer","group":"","order":17,"width":2,"height":1},{"id":"cc410b40.551398","type":"ui_spacer","name":"spacer","group":"","order":4,"width":3,"height":1},{"id":"b6dea28f.35559","type":"ui_group","name":"VENTILATION","tab":"c840e9ca.648e98","order":2,"disp":true,"width":"6","collapse":false},{"id":"d745c5b4.683f88","type":"ui_group","name":"DATA","tab":"807f8a9f.74eae8","order":1,"disp":true,"width":"6","collapse":false},{"id":"fa135d2d.aa085","type":"ui_group","name":"EXPERIMENT","tab":"c840e9ca.648e98","order":1,"disp":true,"width":"6","collapse":false},{"id":"c840e9ca.648e98","type":"ui_tab","name":"SETTINGS","icon":"fa-cogs","order":5,"disabled":false,"hidden":false},{"id":"d7c7e5cb.50c878","type":"MySQLdatabase","name":"data","host":"127.0.0.1","port":"3306","db":"your_database_name","tz":"","charset":""},{"id":"ae8d2d62.65cff","type":"ui_group","name":"ALERTS","tab":"c840e9ca.648e98","order":9,"disp":true,"width":"6","collapse":false},{"id":"807f8a9f.74eae8","type":"ui_tab","name":"DATA","icon":"fa-database","order":4,"disabled":false,"hidden":false},{"id":"b1990e72.3758d","type":"ui_group","name":"SENSOR AVERAGE","tab":"9ce00dc0.0b12d","order":1,"disp":true,"width":"8","collapse":false},{"id":"c628a29f.96a78","type":"mqtt-broker","name":"Greenhouse name","broker":"broker_ip","port":"1883","clientid":"","usetls":false,"compatmode":false,"protocolVersion":"4","keepalive":"60","cleansession":true,"birthTopic":"","birthQos":"2","birthPayload":"","birthMsg":{},"closeTopic":"","closeQos":"0","closePayload":"","closeMsg":{},"willTopic":"","willQos":"0","willPayload":"","willMsg":{},"sessionExpiry":""},{"id":"9ce00dc0.0b12d","type":"ui_tab","name":"MONITORING","icon":"fa-area-chart","order":1,"disabled":false,"hidden":false},{"id":"7b3878b4.914658","type":"ui_group","name":"VENTILATION","tab":"9ce00dc0.0b12d","order":4,"disp":true,"width":"8","collapse":false},{"id":"9f64fbcf.734d68","type":"ui_group","name":"INITIALIZATION","tab":"c840e9ca.648e98","order":10,"disp":true,"width":"6","collapse":false},{"id":"ed07161e.0a9588","type":"ui_group","name":"COOLING SYSTEM","tab":"c840e9ca.648e98","order":3,"disp":true,"width":"6","collapse":false},{"id":"c32e4918.a723a8","type":"ui_group","name":"GROUP 2","tab":"9ce00dc0.0b12d","order":3,"disp":true,"width":"8","collapse":false},{"id":"61c2c538.32dfbc","type":"ui_group","name":"GROUP 1","tab":"9ce00dc0.0b12d","order":2,"disp":true,"width":"8","collapse":false},{"id":"7a67050c.d3c01c","type":"ui_spacer","name":"spacer","group":"dbacaef7.4bd77","order":2,"width":1,"height":1},{"id":"ddba65b6.c6db38","type":"ui_spacer","name":"spacer","group":"dbacaef7.4bd77","order":4,"width":1,"height":1},{"id":"8da87e55.5cf1e","type":"ui_spacer","name":"spacer","group":"dbacaef7.4bd77","order":7,"width":1,"height":1},{"id":"a668c9ed.4f8b78","type":"ui_spacer","name":"spacer","group":"dbacaef7.4bd77","order":9,"width":1,"height":1},{"id":"3ef6d02b.2dede","type":"ui_spacer","name":"spacer","group":"dbacaef7.4bd77","order":12,"width":1,"height":1},{"id":"a74b2680.039cc8","type":"ui_spacer","name":"spacer","group":"dbacaef7.4bd77","order":14,"width":1,"height":1},{"id":"afb24e79.9b765","type":"ui_group","name":"FANLEFT1","tab":"c840e9ca.648e98","order":5,"disp":true,"width":"6","collapse":false},{"id":"a83c6fd2.b673","type":"ui_group","name":"FANLEFT2","tab":"c840e9ca.648e98","order":6,"disp":true,"width":"6","collapse":false},{"id":"e9e68015.2f878","type":"ui_group","name":"FANRIGHT3","tab":"c840e9ca.648e98","order":7,"disp":true,"width":"6","collapse":false},{"id":"7cb1faaf.799074","type":"ui_group","name":"FANRIGHT4","tab":"c840e9ca.648e98","order":8,"disp":true,"width":"6","collapse":false},{"id":"b0136812.6a2e48","type":"ui_spacer","name":"spacer","group":"61c2c538.32dfbc","order":2,"width":1,"height":1},{"id":"fc1fc991.c1d378","type":"ui_spacer","name":"spacer","group":"61c2c538.32dfbc","order":4,"width":1,"height":1},{"id":"e9e1c94b.f0bc18","type":"ui_spacer","name":"spacer","group":"61c2c538.32dfbc","order":7,"width":1,"height":1},{"id":"c425c3a3.f36db","type":"ui_spacer","name":"spacer","group":"61c2c538.32dfbc","order":9,"width":1,"height":1},{"id":"c1cc6dd8.4f175","type":"ui_spacer","name":"spacer","group":"61c2c538.32dfbc","order":12,"width":1,"height":1},{"id":"4844b69c.11ef88","type":"ui_spacer","name":"spacer","group":"61c2c538.32dfbc","order":14,"width":1,"height":1},{"id":"6ba047c4.e61058","type":"ui_spacer","name":"spacer","group":"61c2c538.32dfbc","order":18,"width":1,"height":1},{"id":"cc9f07df.2b2fc8","type":"ui_spacer","name":"spacer","group":"61c2c538.32dfbc","order":20,"width":1,"height":1},{"id":"5cc821f8.919c6","type":"ui_spacer","name":"spacer","group":"61c2c538.32dfbc","order":23,"width":1,"height":1},{"id":"a233fa65.26f4e8","type":"ui_spacer","name":"spacer","group":"61c2c538.32dfbc","order":25,"width":1,"height":1},{"id":"ece80c24.3a69b","type":"ui_spacer","name":"spacer","group":"61c2c538.32dfbc","order":28,"width":1,"height":1},{"id":"899c698f.05d4c8","type":"ui_spacer","name":"spacer","group":"61c2c538.32dfbc","order":30,"width":1,"height":1},{"id":"50c06c1.eb97d94","type":"ui_spacer","name":"spacer","group":"c32e4918.a723a8","order":2,"width":1,"height":1},{"id":"3352c180.527e2e","type":"ui_spacer","name":"spacer","group":"c32e4918.a723a8","order":4,"width":1,"height":1},{"id":"336c1a0b.322106","type":"ui_spacer","name":"spacer","group":"c32e4918.a723a8","order":7,"width":1,"height":1},{"id":"ae6d2f5c.f97b4","type":"ui_spacer","name":"spacer","group":"c32e4918.a723a8","order":9,"width":1,"height":1},{"id":"7c8ed3c3.a2c19c","type":"ui_spacer","name":"spacer","group":"c32e4918.a723a8","order":12,"width":1,"height":1},{"id":"3e416fda.07b2e","type":"ui_spacer","name":"spacer","group":"c32e4918.a723a8","order":14,"width":1,"height":1},{"id":"4da6fe1f.851fd","type":"ui_spacer","name":"spacer","group":"c32e4918.a723a8","order":18,"width":1,"height":1},{"id":"c6ad676a.cef128","type":"ui_spacer","name":"spacer","group":"c32e4918.a723a8","order":20,"width":1,"height":1},{"id":"8d5b6c0d.14062","type":"ui_spacer","name":"spacer","group":"c32e4918.a723a8","order":23,"width":1,"height":1},{"id":"da27d323.c9d36","type":"ui_spacer","name":"spacer","group":"c32e4918.a723a8","order":25,"width":1,"height":1},{"id":"663b4a63.298234","type":"ui_spacer","name":"spacer","group":"c32e4918.a723a8","order":28,"width":1,"height":1},{"id":"c53f58f2.81ffe8","type":"ui_spacer","name":"spacer","group":"c32e4918.a723a8","order":30,"width":1,"height":1},{"id":"114f291b.63da77","type":"ui_spacer","name":"spacer","group":"fa135d2d.aa085","order":6,"width":6,"height":1},{"id":"31e4ec3c.b0ca34","type":"ui_spacer","name":"spacer","group":"ed07161e.0a9588","order":15,"width":6,"height":1},{"id":"ffc1d5be.d43fa8","type":"ui_spacer","name":"spacer","group":"ed07161e.0a9588","order":16,"width":6,"height":1},{"id":"65381956.d557d8","type":"ui_spacer","name":"spacer","group":"ae8d2d62.65cff","order":2,"width":6,"height":1},{"id":"d6e54600.11f788","type":"file","z":"9bcfa612.592b38","name":"log sensor data","filename":"/your location/file_name.csv","appendNewline":true,"createDir":true,"overwriteFile":"false","x":2760,"y":2560,"wires":[[]]},{"id":"fb110d43.e318e","type":"function","z":"9bcfa612.592b38","name":"DataSensor1","func":"date = global.get(\"gDate\");\ntime = global.get(\"gTime\");\n\n// DATA table\ncrop=global.get(\"crop\");\ntrial=global.get(\"trial\");\nlocation=global.get(\"location\");\nauthor=global.get(\"author\");\nemail=global.get(\"email\");\nphone=global.get(\"phone\");\n\n//Sensor\nsensor=\"sensor1\";\ntemp=global.get(\"temp1\");\nhum=global.get(\"hum1\");\ndew=global.get(\"dew1\");\n//Alerts\ntempalert=global.get(\"tempalert\");\nhumalert=global.get(\"humalert\");\nfref=global.get(\"fRef\");\n//Insert the data into MySQL database\n//Note to these variables are related to the specific variables and parameters needed in this experiment\n//And includes data from air temp & hum\n//You can change this as well as you need must be the same as the table created in MySQL \nquery = \"INSERT INTO DATA (DATE,TIME,CROP,TRIAL,LOCATION,AUTHOR,EMAIL,PHONE,SENSOR,TEMPERATURE,HUMIDITY,DEWPOINT,TEMPALERT,HUMALERT,TREF)\";\nquery = query + \"VALUES ('\" + date + \"','\" + time + \"','\" + crop + \"','\" + trial + \"','\" + location + \"','\" + author + \"','\" + email + \"','\" + phone + \"','\";\nquery = query + sensor + \"','\" + temp + \"','\" + hum + \"','\" + dew + \"','\";\nquery = query + tempalert + \"','\" + humalert + \"','\" + fref + \"');\";\n\n//ID int auto_increment,DATE varchar(255),TIME varchar(255),CROP varchar(255),TRIAL varchar(255),LOCATION varchar(255),AUTHOR varchar(255),EMAIL varchar(255),PHONE INT,SENSOR varchar(255),TEMPERATURE double,HUMIDITY double,DEWPOINT double,TEMPALERT double,HUMALERT double,TREF double,primary key(ID)\n\n\ncsv = (`${date}, ${time}, ${sensor}, ${temp}, ${hum}, ${dew}, ${tempalert}, ${humalert}, ${fref}`);\n\n//if(status==\"ACTIVE\"){\n//    msg1 = {topic : query, payload: csv};\n//    return msg1;\n//}else{\n    //return null;\n    msg1 = {topic : query, payload: csv};\n    return msg1;\n//}","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2290,"y":2220,"wires":[["4e81bae3.0e1ac4","d6e54600.11f788","ef10eac5.3bf0b8"]]},{"id":"d3b9486e.11c6f8","type":"catch","z":"9bcfa612.592b38","name":"","scope":null,"uncaught":false,"x":2140,"y":3740,"wires":[["6562c7ae.fd4b28","3e5fb5bb.c0a67a"]]},{"id":"6562c7ae.fd4b28","type":"debug","z":"9bcfa612.592b38","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":2330,"y":3780,"wires":[]},{"id":"1f95f753.7cb1c9","type":"ui_template","z":"9bcfa612.592b38","group":"d745c5b4.683f88","name":"Download","order":6,"width":6,"height":1,"format":"<script>\n    (function(scope) {\n      scope.$watch('msg', function(msg) {\n        if (msg.payload == \"Download\") {\n            downloadFile();\n            //alert(msg.payload);\n        }\n      });\n    })(scope);\n    \n    //function downloadFile(data, fileName, type=\"text/plain\") {\n    function downloadFile(type=\"text/csv\") {\n      // Create an invisible A element\n      const a = document.createElement(\"a\");\n      a.style.display = \"none\";\n      document.body.appendChild(a);\n    \n      // Set the HREF to a Blob representation of the data to be downloaded\n      a.href = \"/files/db.csv\"; /*window.URL.createObjectURL(\n        new Blob([data], { type })\n      );*/\n    \n      // Use download attribute to set set desired file name\n      //a.setAttribute(\"download\", fileName);\n    \n      // Trigger the download by simulating click\n      a.click();\n    \n      // Cleanup\n      window.URL.revokeObjectURL(a.href);\n      document.body.removeChild(a);\n    }\n</script>","storeOutMessages":false,"fwdInMessages":true,"resendOnRefresh":false,"templateScope":"local","x":2340,"y":3820,"wires":[[]]},{"id":"50102656.7e4778","type":"comment","z":"9bcfa612.592b38","name":"Create http endpoint <nodered>/files/xxx  where xxx is the file name to download","info":"","x":2340,"y":3640,"wires":[]},{"id":"6fdcce41.42945","type":"http in","z":"9bcfa612.592b38","name":"","url":"/files/:fn","method":"get","upload":false,"swaggerDoc":"","x":2150,"y":3700,"wires":[["8e107b66.a83e98"]]},{"id":"93858758.ff5bd8","type":"exec","z":"9bcfa612.592b38","command":"rm -r /your location/file_name.csv","addpay":false,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":2220,"y":3920,"wires":[["c403e9d6.cb8728"],["c403e9d6.cb8728"],[]]},{"id":"ebd700c4.d0ba2","type":"ui_toast","z":"9bcfa612.592b38","position":"dialog","displayTime":"3","highlight":"","sendall":false,"outputs":1,"ok":"DELETE","cancel":"Cancel","raw":false,"topic":"data","name":"confirm delete","x":2360,"y":3860,"wires":[["d64c904f.587a9"]]},{"id":"d64c904f.587a9","type":"function","z":"9bcfa612.592b38","name":"if true: delete","func":"var status=global.get(\"status\");\nif (msg.topic == \"data\"){\n    if (msg.payload == \"DELETE\" && status==\"ACTIVE\") {\n        msg1 = {payload:\"Trial in progress!\"};\n        return [msg1,null];\n    }else if (msg.payload == \"DELETE\" && status==\"INACTIVE\"){\n        msg2 = {payload:\"delete\"};\n        return [null,msg2];\n    }else{\n        return [null,null];\n    }\n}","outputs":2,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2570,"y":3860,"wires":[["6f557558.00eadc"],["93858758.ff5bd8"]]},{"id":"c403e9d6.cb8728","type":"function","z":"9bcfa612.592b38","name":"remove message","func":"if (msg.payload === \"\" ){\n    msg = {payload: \"Removed all data succesfully!\"};\n    return msg;\n}\n\nif (msg.payload !== \"\"){\n    msg = {payload: \"Empty\"};\n    return msg;\n}\n\n//return null;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2570,"y":3920,"wires":[["88ddaec3.6c677"]]},{"id":"8e107b66.a83e98","type":"function","z":"9bcfa612.592b38","name":"Set base path","func":"var basePath = \"/your location/\";\nvar filename = msg.req.params.fn;\n\nmsg.filename = basePath + filename;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2360,"y":3700,"wires":[["6d303c4e.d9e764"]]},{"id":"6d303c4e.d9e764","type":"file in","z":"9bcfa612.592b38","name":"file","filename":"","format":"","chunk":false,"sendError":false,"encoding":"none","x":2550,"y":3700,"wires":[["d7f8cd09.56e1b"]]},{"id":"3e5fb5bb.c0a67a","type":"function","z":"9bcfa612.592b38","name":"error message","func":"//msg.payload = msg.error;\nmsg.statusCode = 404;//resource not found\nmsg.payload = \"No data found. Please go back.\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2360,"y":3740,"wires":[["d7f8cd09.56e1b"]]},{"id":"d7f8cd09.56e1b","type":"http response","z":"9bcfa612.592b38","name":"http response","statusCode":"","headers":{},"x":2580,"y":3760,"wires":[]},{"id":"88ddaec3.6c677","type":"ui_toast","z":"9bcfa612.592b38","position":"top right","displayTime":"3","highlight":"","sendall":true,"outputs":0,"ok":"OK","cancel":"","raw":false,"topic":"","name":"","x":2790,"y":3920,"wires":[]},{"id":"4e81bae3.0e1ac4","type":"mysql","z":"9bcfa612.592b38","mydb":"d7c7e5cb.50c878","name":"","x":3010,"y":2460,"wires":[["b0f3060c.bd83f8"]]},{"id":"b60493f0.9ff0a","type":"function","z":"6862f897.ee8958","name":"tempalert","func":"global.set(\"tempalert\",msg.payload);","outputs":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2560,"y":2040,"wires":[]},{"id":"b32dac97.9ec62","type":"function","z":"6862f897.ee8958","name":"humalert","func":"global.set(\"humalert\",msg.payload);","outputs":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2560,"y":2080,"wires":[]},{"id":"706dfceb.191464","type":"function","z":"9bcfa612.592b38","name":"GET DATA","func":"query = \"SELECT * FROM CONFIG ORDER BY CONFIG.ID DESC LIMIT 1;\"\nmsg1 = {topic: query};\nreturn msg1;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2250,"y":3400,"wires":[["e74ca220.1a435"]]},{"id":"b9ad06f6.20c158","type":"inject","z":"9bcfa612.592b38","name":"","props":[{"p":"payload"}],"repeat":"","crontab":"","once":true,"onceDelay":"20","topic":"","payload":"","payloadType":"date","x":2070,"y":3400,"wires":[["706dfceb.191464"]]},{"id":"e032bc54.04124","type":"function","z":"9bcfa612.592b38","name":"recover user data after reboot","func":"payload=msg.payload;\nstatus=payload[0].CTRL_STATUS;\nd=global.get(\"gDateTime\");\n\nif(status==\"ACTIVE\"){\n    global.set(\"status\", payload[0].STATUS);\n    global.set(\"crop\", payload[0].CROP);\n    global.set(\"trial\", payload[0].TRIAL);\n    global.set(\"location\", payload[0].LOCATION);\n    global.set(\"author\", payload[0].AUTHOR);\n    global.set(\"email\", payload[0].EMAIL);\n    global.set(\"ccEmail\", \"ccemail\");\n    global.set(\"bccEmail\", \"bccemail\");\n    global.set(\"phone\", payload[0].PHONE);\n    global.set(\"status\",payload[0].CTRL_STATUS);\n    fans_trefs = payload[0].FANS_TREFS;\n    fans_trefs = JSON.parse(fans_trefs);\n    global.set(\"fanl1\",fans_trefs.fanl1);global.set(\"fanl2\",fans_trefs.fanl2);\n    global.set(\"fanr3\",fans_trefs.fanr3);global.set(\"fanr4\",fans_trefs.fanr4);\n    global.set(\"fRef1\", payload[0].TREF1);\n    global.set(\"fRef2\", payload[0].TREF2);\n    global.set(\"fRef3\", payload[0].TREF3);\n    global.set(\"tempalert\", payload[0].TEMPALERT);\n    global.set(\"humalert\", payload[0].HUMALERT);\n    connect_coolsys = payload[0].CONNECT_COOLSYS;\n    connect_coolsys = JSON.parse(connect_coolsys);\n    global.set(\"temp2humstate\",connect_coolsys);//Connect the cooling system with the temp control or let it manually\n    global.set(\"Csprog\",payload[0].COOL_SYS);//schedule\n    global.set(\"cooling_state\",payload[0].COOL_SYS_STATE);//when manually is activated the cooling system\n    //global.set(\"fRef\", payload[0].FREF);\n    global.set(\"temp_flag\",1);\n    //\n    global.set(\"auto_restart\",false);\n    subject=payload[0].LOCATION + \": requires your attention\";\n    message=\"The system power off due to electrical fail, please check the settings tab in the web app\";\n    msg = { /*from: \"iot@cgiar.org\",*/\n            to: payload[0].EMAIL, \n            cc: global.get(\"ccEmail\"), \n            bcc: global.get(\"bccEmail\"), \n            topic : subject, \n            payload : message,\n            text: subject+message+d};\n    msg1 = {payload : status};\n    return [msg,msg1];\n}else{\n    global.set(\"temp_flag\",0);\n    msg1 = {payload : status};\n    return [null,msg1];\n}\n ","outputs":2,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2730,"y":3400,"wires":[["192075ae.8daf6a"],["7879f6e7.cb8fb8","cacdebab.c6fdf8"]]},{"id":"50218014.2c0b","type":"ui_text_input","z":"6862f897.ee8958","name":"","label":"Temperature °C","tooltip":"","group":"ae8d2d62.65cff","order":1,"width":0,"height":0,"passthru":true,"mode":"number","delay":"0","topic":"","topicType":"str","x":2380,"y":2040,"wires":[["b60493f0.9ff0a"]]},{"id":"5bfa77d8.762c98","type":"ui_text_input","z":"6862f897.ee8958","name":"","label":"Humidity %","tooltip":"","group":"ae8d2d62.65cff","order":3,"width":0,"height":0,"passthru":true,"mode":"number","delay":"0","topic":"","topicType":"str","x":2370,"y":2080,"wires":[["b32dac97.9ec62"]]},{"id":"7879f6e7.cb8fb8","type":"link out","z":"9bcfa612.592b38","name":"DB_out","links":["2f37f722.97e788","3ea91051.c50d5","4b1eca11.815424","511ef2d3.67c82c","609c3bd5.1090e4","6f834a23.bc5a84","9e8658dd.a2f188","c4893e09.8ebc7","cd340f42.2fb09","cf76bb74.064588","fcd9c10f.c812e","a63c8ed.f7b3d7"],"x":2955,"y":3340,"wires":[]},{"id":"7b5d82b2.40c72c","type":"function","z":"9bcfa612.592b38","name":"from initialize","func":"//MySQL & CSV file\ndate = global.get(\"gDate\");\ntime = global.get(\"gTime\");\n\n// DATA table\ncrop=global.get(\"crop\");\ntrial=global.get(\"trial\");\nlocation=global.get(\"location\");\nauthor=global.get(\"author\");\nemail=global.get(\"email\");\nphone=global.get(\"phone\");\n\n//Sensor\nsensor=\"sensorAvg\";\ntemp=global.get(\"tempAvg\");\nhum=global.get(\"humAvg\");\ndew=global.get(\"dewAvg\");\n//Alerts\ntempalert=global.get(\"tempalert\");\nhumalert=global.get(\"humalert\");\nfref=global.get(\"fRef\");\n//Insert the data into MySQL database\n//Note to these variables are related to the specific variables and parameters needed in this experiment\n//And includes data from air temp & hum\n//You can change this as well as you need must be the same as the table created in MySQL \n\nquery = \"INSERT INTO DATA (DATE,TIME,CROP,TRIAL,LOCATION,AUTHOR,EMAIL,PHONE,SENSOR,TEMPERATURE,HUMIDITY,DEWPOINT,TEMPALERT,HUMALERT,TREF)\";\nquery = query + \"VALUES ('\" + date + \"','\" + time + \"','\" + crop + \"','\" + trial + \"','\" + location + \"','\" + author + \"','\" + email + \"','\" + phone + \"','\";\nquery = query + sensor + \"','\" + temp + \"','\" + hum + \"','\" + dew + \"','\";\nquery = query + tempalert + \"','\" + humalert + \"','\" + fref + \"');\";\n\ncsv = (`Date: ${date}, Time: ${time}, Crop: ${crop}, Trial: ${trial}, Location: ${location}, Author: ${author}, Email: ${email}, Phone: ${phone}, Tref: ${fref}\nDATE,TIME,CROP,TRIAL,LOCATION.AUTHOR,EMAIL,PHONE,SENSOR,TEMPERATURE,HUMIDITY,DEWPOINT,TEMPALERT,HUMALERT`);\n\ncsv2 = (`${date}, ${time}, ${sensor}, ${temp}, ${hum}, ${dew}, ${tempalert}, ${humalert}`);\n\n\nsubject = location + \": New trial initialized\";\nmessage = (`Settings: \nCrop: ${crop}\nTrial: ${trial}\nDate: ${date}\nTime: ${time}\nLocation: ${location}\nAuthor: ${author}\nEmail: ${email}\nPhone: ${phone}\nTemperature Alert: ${tempalert} °C\nHumidity Alert: ${humalert} %\n`);\n        \nsubject1 = location + \": trial updated\";\nmessage1 = (`Settings: \nCrop: ${crop}\nTrial: ${trial}\nDate: ${date}\nTime: ${time}\nLocation: ${location}\nAuthor: ${author}\nEmail: ${email}\nPhone: ${phone}\nTemperature Alert: ${tempalert} °C\nHumidity Alert: ${humalert} %\n`);\n\nsubject2 = location + \": trial finalized\";\nmessage2 = (`Bye ${author}, thanks for using CIAT-IoT initiatives (Dpineda).`);\n\nif (msg.payload==\"ACTIVE\") {\n    msg1 = {/*from : \"noreply@gmail.com\",*/ to : email, cc: ccEmail, bcc: bccEmail, topic : subject, payload : message, text: location +\"\\n\"+ message+d};\n    msg2 = {topic : query};\n    msg3 = {payload : csv};\n    //Telegram\n    msg4={payload:{    \n    //uncomment and add telegram node if you want to send it \n    //\"chatId\":,\n        \"type\": \"message\",\n        \"content\": location +\"\\n\"+ message+d}\n    };\n    return [msg1,msg2,msg3,msg4];\n}else if (msg.payload==\"UPDATE\") {\n    msg4 = {/*from : \"noreply@gmail.com\",*/ to : email, cc: ccEmail, bcc: bccEmail, topic : subject1, payload : message1, text: location +\"\\n\"+ message1+d};\n    msg5 = {topic : query};\n    msg6 = {payload : csv2};\n    msg4={payload:{    \n    //uncomment and add telegram node if you want to send it \n    //\"chatId\":,\n        \"type\": \"message\",\n        \"content\": location +\"\\n\"+ message1+d}\n    };\n    return [msg1,msg2,msg3,msg4];\n}else if (msg.payload==\"STOP\") {\n    msg7 = {/*from : \"noreply@gmail.com\",*/ to : email, cc: ccEmail, bcc: bccEmail, topic : subject2, payload : message2, text: location +\"\\n\"+ message2+d};\n    msg8 = {topic : query};\n    global.set(\"crop\", crop);\n    global.set(\"trial\", trial);\n    global.set(\"location\", location);\n    global.set(\"author\", author);\n    global.set(\"email\", email);\n    global.set(\"ccEmail\", \"put your cc email here\");\n    global.set(\"bccEmail\", \"put your bcc email here\");\n    global.set(\"phone\", \"set your phone here\");\n    //----------------------------------------------------------\n    global.set(\"fl1_tr1\",true);\n    global.set(\"fl1_tr2\",true);\n    global.set(\"fl1_tr3\",true);\n    fanl1 = [{\"title\":\"TempRef1\",\"isChecked\":true},\n    {\"title\":\"TempRef2\",\"isChecked\":true},\n    {\"title\":\"TempRef3\",\"isChecked\":true}]\n    global.set(\"fanl1\",fanl1);\n    \n    global.set(\"fl2_tr1\",true);\n    global.set(\"fl2_tr2\",true);\n    global.set(\"fl2_tr3\",true);\n    fanl2 = [{\"title\":\"TempRef1\",\"isChecked\":true},\n    {\"title\":\"TempRef2\",\"isChecked\":true},\n    {\"title\":\"TempRef3\",\"isChecked\":true}]\n    global.set(\"fanl2\",fanl2);\n    \n        global.set(\"fr3_tr1\",true);\n    global.set(\"fr3_tr2\",true);\n    global.set(\"fr3_tr3\",true);\n    fanr3 = [{\"title\":\"TempRef1\",\"isChecked\":true},\n    {\"title\":\"TempRef2\",\"isChecked\":true},\n    {\"title\":\"TempRef3\",\"isChecked\":true}]\n    global.set(\"fanr3\",fanr3);\n    \n    global.set(\"fr4_tr1\",true);\n    global.set(\"fr4_tr2\",true);\n    global.set(\"fr4_tr3\",true);\n    fanr4 = [{\"title\":\"TempRef1\",\"isChecked\":true},\n    {\"title\":\"TempRef2\",\"isChecked\":true},\n    {\"title\":\"TempRef3\",\"isChecked\":true}]\n    global.set(\"fanr4\",fanr4);\n    //-----------------------------------------------------------\n    global.set(\"fRef1\", 30);\n    global.set(\"fRef2\", 25);\n    global.set(\"fRef3\", 20);\n    global.set(\"tempalert\", 40);\n    global.set(\"humalert\", 60);\n    global.set(\"temp2humstate\",false);//Connect the cooling system with the temp control or let it manually\n    global.set(\"Csprog\",'{\"timers\":[],\"settings\":{}}');//schedule\n    global.set(\"cooling_state\",false);//when manually is activated the cooling system\n\n    //\n    msg4={payload:{    \n    //uncomment and add telegram node if you want to send it \n    //\"chatId\":,\n        \"type\": \"message\",\n        \"content\": subject2 +\"\\n\"+ message2+d}\n    };\n    return [msg1,msg2,null,msg4];\n}else{\n    return [null,null,null];\n}","outputs":4,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2270,"y":2100,"wires":[["192075ae.8daf6a"],["4e81bae3.0e1ac4"],["d6e54600.11f788"],["a1b421c.ac1c6e"]]},{"id":"c489a58f.9716f8","type":"link in","z":"9bcfa612.592b38","name":"running_in","links":["8d587392.32f9e"],"x":2035,"y":2100,"wires":[["7b5d82b2.40c72c","21193967.9d50b6"]]},{"id":"2f37f722.97e788","type":"link in","z":"6862f897.ee8958","name":"running_in","links":["7879f6e7.cb8fb8","8d587392.32f9e"],"x":2055,"y":2060,"wires":[["9097a8b8.078918"]]},{"id":"cf76bb74.064588","type":"link in","z":"359ed2dc.ceea6e","name":"vent_in","links":["7879f6e7.cb8fb8","8d587392.32f9e"],"x":2175,"y":2300,"wires":[["f5f2cd14.2edc5","3cc0c22b.4e2f2e","398c3cb4.0fb274","bc105f72.fd362"]]},{"id":"682a689e.d78cd8","type":"ui_text_input","z":"98e3ec9b.ecb6a","name":"Trial","label":"Trial Name (your experiment)","tooltip":"","group":"fa135d2d.aa085","order":2,"width":0,"height":0,"passthru":true,"mode":"text","delay":"0","topic":"Trial","x":2310,"y":2040,"wires":[["b7dafb72.16ee88"]]},{"id":"7e795bfc.a257e4","type":"ui_text_input","z":"98e3ec9b.ecb6a","name":"Location","label":"Location (greenhouse name)","tooltip":"","group":"fa135d2d.aa085","order":3,"width":0,"height":0,"passthru":true,"mode":"text","delay":"0","topic":"Location","x":2320,"y":2080,"wires":[["3d92561e.db101a"]]},{"id":"80eb752d.efaf78","type":"ui_text_input","z":"98e3ec9b.ecb6a","name":"Author","label":"Author (your name)","tooltip":"","group":"fa135d2d.aa085","order":4,"width":0,"height":0,"passthru":true,"mode":"text","delay":"0","topic":"Author","x":2310,"y":2120,"wires":[["ad2a864f.17b188"]]},{"id":"9710b4d3.6eba18","type":"ui_text_input","z":"98e3ec9b.ecb6a","name":"Email","label":"Email (@cgiar/gmail)","tooltip":"","group":"fa135d2d.aa085","order":5,"width":0,"height":0,"passthru":true,"mode":"email","delay":"0","topic":"Email","x":2310,"y":2160,"wires":[["875dbe30.42ee5"]]},{"id":"8a797d3b.7af4b","type":"ui_text_input","z":"98e3ec9b.ecb6a","name":"Phone","label":"Phone (+57)","tooltip":"(Max. 10 Numbers)","group":"fa135d2d.aa085","order":7,"width":0,"height":0,"passthru":true,"mode":"tel","delay":"0","topic":"Phone","x":2310,"y":2200,"wires":[["1dcd0c70.567514"]]},{"id":"8544e530.d4ffa8","type":"comment","z":"98e3ec9b.ecb6a","name":"Experiment","info":"","x":2390,"y":1960,"wires":[]},{"id":"b7dafb72.16ee88","type":"function","z":"98e3ec9b.ecb6a","name":"set new trial","func":"//Set experiments'name\nglobal.set(\"trial\", msg.payload);","outputs":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2470,"y":2040,"wires":[]},{"id":"3d92561e.db101a","type":"function","z":"98e3ec9b.ecb6a","name":"set new location","func":"//set the location of the experiment (greenhouse name)\nglobal.set(\"location\", msg.payload);","outputs":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2480,"y":2080,"wires":[]},{"id":"ad2a864f.17b188","type":"function","z":"98e3ec9b.ecb6a","name":"set new author","func":"//set author or user\nglobal.set(\"author\", msg.payload);","outputs":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2480,"y":2120,"wires":[]},{"id":"875dbe30.42ee5","type":"function","z":"98e3ec9b.ecb6a","name":"set new email","func":"//set the email where alerts will be sent\nglobal.set(\"email\", msg.payload);\nglobal.set(\"ccEmail\", \"your cc email\");\nglobal.set(\"bccEmail\", \"your bcc email\");","outputs":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2480,"y":2160,"wires":[]},{"id":"1dcd0c70.567514","type":"function","z":"98e3ec9b.ecb6a","name":"set new phone","func":"//send phone in case of want telegram alerts\nif(msg.payload.length==10){\n    global.set(\"phone\", msg.payload);\n}else{\n    global.set(\"phone\", 0);\n    msg = {payload : \"Please insert a valid 10 digits telephone number\"};\n    return msg;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2480,"y":2200,"wires":[["a42e4f23.6b0e7"]]},{"id":"4149852c.f3b2ac","type":"function","z":"98e3ec9b.ecb6a","name":"update data","func":"//AFter unexpected reboot the system must be initialized with previously \n//parameters set by user, this information is extracted from\n//MySQL directly\nif(msg.payload){\n    crop=global.get(\"crop\");\n    trial=global.get(\"trial\");\n    location=global.get(\"location\");\n    author=global.get(\"author\");\n    email=global.get(\"email\");\n    phone=global.get(\"phone\");\n    \n    //msg\n    msg0 = {payload: crop};\n    msg1 = {payload: trial};\n    msg2 = {payload: location};\n    msg3 = {payload: author};\n    msg4 = {payload: email};\n    msg5 = {payload: phone};\n    \n    return [msg0,msg1,msg2,msg3,msg4,msg5];\n}","outputs":6,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2130,"y":2100,"wires":[["3170639d.d7550c"],["682a689e.d78cd8"],["7e795bfc.a257e4"],["80eb752d.efaf78"],["9710b4d3.6eba18"],["8a797d3b.7af4b"]]},{"id":"3ea91051.c50d5","type":"link in","z":"98e3ec9b.ecb6a","name":"exp_in","links":["7879f6e7.cb8fb8","8d587392.32f9e"],"x":1995,"y":2100,"wires":[["4149852c.f3b2ac"]]},{"id":"f5f2cd14.2edc5","type":"function","z":"359ed2dc.ceea6e","name":"update data","func":"if(msg.payload){\n    fRef=global.get(\"fRef\");\n    msg1 = {payload: fRef};\n    return [msg1];\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2430,"y":2300,"wires":[[]]},{"id":"9097a8b8.078918","type":"function","z":"6862f897.ee8958","name":"update data","func":"tempalert=global.get(\"tempalert\");\nhumalert=global.get(\"humalert\");\n\nif(msg.payload){\n    msg1 = {payload: tempalert};\n    msg2 = {payload: humalert};\n    return [msg1,msg2];\n}","outputs":2,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2190,"y":2060,"wires":[["50218014.2c0b"],["5bfa77d8.762c98"]]},{"id":"12c324d2.fd023b","type":"function","z":"6862f897.ee8958","name":"TriggerTempAlarm","func":"status = global.get(\"status\");\ntempalert = global.get(\"tempalert\");\ntemp=global.get(\"tempAvg\");\n\ntemp_alarm=context.get(\"temp_alarm\");\nif(typeof temp_alarm===undefined)\ntemp_alarm=false;\n\nif (temp>tempalert && !temp_alarm && status==\"ACTIVE\"){\n    temp_alarm=true;    //msg.alarm=1;\n    context.set(\"temp_alarm\",temp_alarm);\n    msg1 = {payload : temp, alarm : 1};\n    return msg1;\n}\nif (temp<tempalert-1 && temp_alarm && status==\"ACTIVE\"){\n    temp_alarm=false;    //msg.alarm=0;\n    context.set(\"temp_alarm\",temp_alarm);\n    msg1 = {payload : temp, alarm : 0};\n    return msg1;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2330,"y":2160,"wires":[["1d8b225f.f971ae"]]},{"id":"1d8b225f.f971ae","type":"function","z":"6862f897.ee8958","name":"email Temp","func":"temp=msg.payload;\nd=global.get(\"gDateTime\");\nlocation=global.get(\"location\");\n//author=global.get(\"author\");\nemail=global.get(\"email\");\nmessage=\"\";\n\nif(msg.alarm){\n    subject=location+\": High Temperature Alarm\";\n    message=\" High Temperature Alarm. \";\n}\nelse{\n    subject=location+\": Temperature Alarm Reset\";\n    message=\" Temperature now normal. \";\n} \n\nmsg1 = {//from : \"noreply@gmail.com\",\n        to : email, \n        cc: global.get(\"ccEmail\"), \n        bcc: global.get(\"bccEmail\"), \n        topic : subject, \n        payload : message+temp+\"°C. \"+d,\n        text: location+\": \"+message+temp+\"°C. \"+d\n};\n\nmsg2={payload:{    \n    //uncomment and add telegram node if you want to send it \n    //\"chatId\": ,\n    \"type\": \"message\",\n    \"content\": location+\": \"+message+temp+\"°C. \"+d}\n};\nreturn [msg1,msg2];","outputs":2,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2510,"y":2160,"wires":[["b343d31c.c478b","ef149141.862d6"],["b19d13da.8363d"]]},{"id":"1d72b225.57f35e","type":"inject","z":"6862f897.ee8958","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"1","crontab":"","once":true,"onceDelay":"5","topic":"","payload":"","payloadType":"date","x":2130,"y":2160,"wires":[["12c324d2.fd023b","d678d466.91a158"]]},{"id":"8f854b1f.6a30e8","type":"function","z":"359ed2dc.ceea6e","name":"STOP","func":"if(msg.topic == \"stopFan\"){\n    if (msg.payload == \"STOP\") {\n        global.set(\"fan_flag\",false);    //fan_flag=false;\n        global.set(\"fState\", \"OFF\");\n        global.set(\"fRef\", 100);\n        msg1 = {payload : \"0\"};\n        msg2 = {payload : \"OFF\" };\n        return [msg1,msg2];\n    }    \n}","outputs":2,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2650,"y":2260,"wires":[[],["f5f2cd14.2edc5"]]},{"id":"4ef4e9b8.b7bec8","type":"ui_button","z":"359ed2dc.ceea6e","name":"STOP","group":"7b3878b4.914658","order":6,"width":8,"height":1,"passthru":false,"label":"STOP","tooltip":"","color":"white","bgcolor":"#FF0000","icon":"","payload":"Really stop fan?","payloadType":"str","topic":"","x":2210,"y":2260,"wires":[["8a19de97.461f5"]]},{"id":"8a19de97.461f5","type":"ui_toast","z":"359ed2dc.ceea6e","position":"dialog","displayTime":"3","highlight":"","sendall":false,"outputs":1,"ok":"STOP","cancel":"Cancel","raw":false,"topic":"stopFan","name":"confirm","x":2440,"y":2260,"wires":[["8f854b1f.6a30e8"]]},{"id":"6f557558.00eadc","type":"ui_toast","z":"9bcfa612.592b38","position":"dialog","displayTime":"3","highlight":"","sendall":true,"outputs":1,"ok":"OK","cancel":"","raw":false,"topic":"Can not be deleted","name":"","x":2770,"y":3860,"wires":[[]]},{"id":"d678d466.91a158","type":"function","z":"6862f897.ee8958","name":"TriggerHumAlarm","func":"status = global.get(\"status\");\nhumalert = global.get(\"humalert\");\nhum=global.get(\"humAvg\");\n\nhum_alarm=context.get(\"hum_alarm\");\nif(typeof hum_alarm===undefined)\nhum_alarm=false;\n\nif (hum>humalert && !hum_alarm && status==\"ACTIVE\"){\n    hum_alarm=true;    //msg.alarm=1;\n    context.set(\"hum_alarm\",hum_alarm);\n    msg1 = {payload : hum, alarm : 1};\n    return msg1;\n}\nif (hum<humalert-1 && hum_alarm && status==\"ACTIVE\"){\n    hum_alarm=false;    //msg.alarm=0;\n    context.set(\"hum_alarm\",hum_alarm);\n    msg1 = {payload : hum, alarm : 0};\n    return msg1;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2330,"y":2200,"wires":[["e29e2eb7.85081"]]},{"id":"e29e2eb7.85081","type":"function","z":"6862f897.ee8958","name":"email Hum","func":"hum=msg.payload;\nd=global.get(\"gDateTime\");\nlocation=global.get(\"location\");\n//author=global.get(\"author\");\nemail=global.get(\"email\");\nmessage=\"\";\n\nif(msg.alarm){\n    subject=location+\": High Humidity Alarm\";\n    message=\" High Humidity Alarm. \";\n}\nelse{\n    subject=location+\": Humidity Alarm Reset\";\n    message=\" Humidity now normal. \";\n} \n\nmsg1 = {//from : \"noreply@gmail.com\",\n        to : email, \n        cc: global.get(\"ccEmail\"), \n        bcc: global.get(\"bccEmail\"), \n        topic : subject, \n        payload : message+hum+\"°C. \"+d,\n        text: location+\": \"+message+hum+\"%. \"+d\n};\n\nmsg2={payload:{    \n    //uncomment and add telegram node if you want to send it \n    //\"chatId\":,\n    \"type\": \"message\",\n    \"content\": location+\": \"+message+hum+\"%. \"+d}\n};\nreturn [msg1,msg2];","outputs":2,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2510,"y":2200,"wires":[["b343d31c.c478b","ef149141.862d6"],["b19d13da.8363d"]]},{"id":"a42e4f23.6b0e7","type":"ui_toast","z":"98e3ec9b.ecb6a","position":"dialog","displayTime":"3","highlight":"","sendall":true,"outputs":1,"ok":"OK","cancel":"","raw":false,"topic":"","name":"","x":2650,"y":2200,"wires":[[]]},{"id":"cacdebab.c6fdf8","type":"function","z":"9bcfa612.592b38","name":"Initialize fields","func":"//INFO table\nstatus=global.get(\"status\");\n\nif (status===undefined){\n    global.set(\"status\", undefined);\n    global.set(\"crop\", \"TEST\");\n    global.set(\"trial\", \"TEST\");\n    global.set(\"location\", \"TEST\");\n    global.set(\"author\", \"TEST\");\n    global.set(\"email\", \"test@test\");\n    global.set(\"ccEmail\", \"ccemail\");\n    global.set(\"bccEmail\", \"bccemail\");\n    //----------------------------------------------------------\n    global.set(\"fl1_tr1\",true);\n    global.set(\"fl1_tr2\",true);\n    global.set(\"fl1_tr3\",true);\n    fanl1 = [{\"title\":\"TempRef1\",\"isChecked\":true},\n    {\"title\":\"TempRef2\",\"isChecked\":true},\n    {\"title\":\"TempRef3\",\"isChecked\":true}]\n    global.set(\"fanl1\",fanl1);\n    \n    global.set(\"fl2_tr1\",true);\n    global.set(\"fl2_tr2\",true);\n    global.set(\"fl2_tr3\",true);\n    fanl2 = [{\"title\":\"TempRef1\",\"isChecked\":true},\n    {\"title\":\"TempRef2\",\"isChecked\":true},\n    {\"title\":\"TempRef3\",\"isChecked\":true}]\n    global.set(\"fanl2\",fanl2);\n    \n        global.set(\"fr3_tr1\",true);\n    global.set(\"fr3_tr2\",true);\n    global.set(\"fr3_tr3\",true);\n    fanr3 = [{\"title\":\"TempRef1\",\"isChecked\":true},\n    {\"title\":\"TempRef2\",\"isChecked\":true},\n    {\"title\":\"TempRef3\",\"isChecked\":true}]\n    global.set(\"fanr3\",fanr3);\n    \n    global.set(\"fr4_tr1\",true);\n    global.set(\"fr4_tr2\",true);\n    global.set(\"fr4_tr3\",true);\n    fanr4 = [{\"title\":\"TempRef1\",\"isChecked\":true},\n    {\"title\":\"TempRef2\",\"isChecked\":true},\n    {\"title\":\"TempRef3\",\"isChecked\":true}]\n    global.set(\"fanr4\",fanr4);\n    //-----------------------------------------------------------\n    global.set(\"fRef1\", 30);\n    global.set(\"fRef2\", 25);\n    global.set(\"fRef3\", 20);\n    global.set(\"tempalert\", 40);\n    global.set(\"humalert\", 60);\n    global.set(\"temp2humstate\",false);//Connect the cooling system with the temp control or let it manually\n    global.set(\"Csprog\",{\"timers\":[],\"settings\":{}});//schedule\n    global.set(\"cooling_state\",false);//when manually is activated the cooling system\n\n}","outputs":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":3020,"y":3480,"wires":[]},{"id":"3170639d.d7550c","type":"ui_text_input","z":"98e3ec9b.ecb6a","name":"Crop","label":"Crop (program)","tooltip":"","group":"fa135d2d.aa085","order":1,"width":0,"height":0,"passthru":true,"mode":"text","delay":"0","topic":"Crop","x":2310,"y":2000,"wires":[["28b5012e.cccc1e"]]},{"id":"28b5012e.cccc1e","type":"function","z":"98e3ec9b.ecb6a","name":"set new crop","func":"//Set information over the plants in the experiment\nglobal.set(\"crop\", msg.payload);","outputs":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2470,"y":2000,"wires":[]},{"id":"3caa3a4b.a1fde6","type":"function","z":"9bcfa612.592b38","name":"Get","func":"date = global.get(\"gDate\");\ntime = global.get(\"gTime\");\n\n//DATA table\ncrop=global.get(\"crop\");\ntrial=global.get(\"trial\");\nstatus=global.get(\"status\");\nlocation=global.get(\"location\");\nauthor=global.get(\"author\");\nemail=global.get(\"email\");\nccEmail=global.get(\"ccEmail\");\nbccEmail=global.get(\"bccEmail\");\nphone=global.get(\"phone\");\n//Ventilation\nfan=\"fan\";\nfState=global.get(\"fState\");\nfRef=global.get(\"fRef\");\n//Sensor\nsensor=\"average\";\ntemp=global.get(\"tempAvg\");\nhum=global.get(\"humAvg\");\ndew=global.get(\"dewAvg\");\n//Alerts\ntempalert=global.get(\"tempalert\");\nhumalert=global.get(\"humalert\");\n\nquery = (`Status: ${status}\nCrop: ${crop}\nTrial: ${trial}\nDate: ${date}\nTime: ${time}\nLocation: ${location}\nAuthor: ${author}\nEmail: ${email}\nccEmail: ${ccEmail}\nbccEmail: ${bccEmail}\nPhone: ${phone}\nfState: ${fState}\nfRef: ${fRef} °C\nSensor: ${sensor}\nTemperature: ${temp} °C\nHumidity: ${hum} %\nDew: ${dew} °C\nTemperature Alert: ${tempalert} °C\nHumidity Alert: ${humalert} %\n`);\n\nif(msg.payload){\n    msg1 = {payload : query};\n    return msg1;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2270,"y":2040,"wires":[["dc035ca5.3bb23"]]},{"id":"b222fb4c.c97158","type":"inject","z":"9bcfa612.592b38","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":2100,"y":2040,"wires":[["3caa3a4b.a1fde6"]]},{"id":"dc035ca5.3bb23","type":"debug","z":"9bcfa612.592b38","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":2490,"y":2040,"wires":[]},{"id":"67fd5814.519458","type":"function","z":"9bcfa612.592b38","name":"Store interval","func":"date = new Date();\nhours = date.getHours();\nminutes = \"0\" + date.getMinutes();\nseconds = \"0\" + date.getSeconds();\n\n// Will display time in 10:30:23 format\n//var formattedTime = hours + ':' + minutes.substr(-2) + ':' + seconds.substr(-2);\nfTime = minutes.substr(-2) + ':' + seconds.substr(-2);\n//Data will be saved every 10 minutes\nif (fTime == \"00:00\" || fTime == \"10:00\" || fTime == \"20:00\" || fTime == \"30:00\" || fTime == \"40:00\" || fTime == \"50:00\"){\n    msg1 = {payload: \"push\"};\n    return msg1;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2090,"y":2380,"wires":[["fb110d43.e318e","42ee9be8.8e1a64","1c6e2e69.ed4af2","e7b0f572.792e78","e619783b.a9a468","8b28201d.18986","e0004a10.b1c948","5d4b7a6d.690014","2b6a732d.16d14c","3c0a9ff8.25fc4","3c9ef764.57a168","84e75cf8.f9e6c","75a1dcf8.982434","a0ff28a3.d2a108","3b72ffdd.1d4f","5424d99f.fe6178","bd4857a4.7f4458","3289ddb8.97c442","fb7328e9.6a56f8","2f2f51ce.7c514e"]]},{"id":"9672745b.81e798","type":"inject","z":"9bcfa612.592b38","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"1","crontab":"","once":true,"onceDelay":"0.5","topic":"","payload":"time","payloadType":"str","x":1870,"y":2380,"wires":[["67fd5814.519458"]]},{"id":"138e8762.3405f9","type":"link out","z":"359ed2dc.ceea6e","name":"fanState_out","links":["2970a48.890a45c"],"x":2615,"y":2000,"wires":[]},{"id":"18c32414.9c804c","type":"function","z":"359ed2dc.ceea6e","name":"TriggerFanControl","func":"d=global.get(\"gDateTime\");\nstatus=global.get(\"status\");\nlocation=global.get(\"location\");\nauthor=global.get(\"author\");\nemail=global.get(\"email\");\n//fRef=global.get(\"fRef\");\nfRef=msg.payload;\ntemp=global.get(\"tempAvg\");\ncool_s = global.get(\"cooling_state\");\nfan_flag=global.get(\"fan_flag\");\nif(typeof fan_flag===undefined)\nfan_flag=false;\n\ncoolingconnect=global.get(\"temp2hum\");\n//four fan/extractor selector\nfl1s = global.get(\"fl1_state\");\nfl2s = global.get(\"fl2_state\");\nfr3s = global.get(\"fr3_state\");\nfr4s = global.get(\"fr4_state\");\n//-----------------------------------\n//the extractors will be turned on if temperature is 1°C above from reference in that period of time\n//otherwise will be turned off\nif (temp>=fRef+1.0 && /*!fan_flag &&*/ status==\"ACTIVE\"){\n    global.set(\"fan_flag\", true);   //fan_flag=true;\n    global.set(\"fState\", \"ON\");    //fState=\"ON\";\n    if(coolingconnect==true){global.set(\"cState\", 1);}    //cState=\"ON\";\n    msg1 = {payload: \"ON\"};   //msg.alarm=1;\n    msg3 = {payload: \"1\"};\n    msg2 = {//from : \"noreply@gmail.com\", \n            to : email, \n            cc: global.get(\"ccEmail\"), \n            bcc: global.get(\"bccEmail\"), \n            topic : location + \": New Fan State\",\n            payload : \"Fan activated.\",\n            text: location+ \": Fan activated. \"+d};\n    msg4={payload:{    \n    //uncomment and add telegram node if you want to send it \n    //\"chatId\":,\n        \"type\": \"message\",\n        \"content\": location+ \": Fan activated. \"+d}\n    };\n    //the nex line is for use the extractors defined by user to be used with the current temp reference\n    //since user selected in dashboard if every extractor work with every tref  (day,night,step)\n    //then, the control action will use or not that specific extractor to \n    //increase the temperature\n    if(fl1s == true){msg5 = {payload: \"1\"};global.set(\"fl1cs\",\"ON\");}else{msg5 = {payload: \"0\"};global.set(\"fl1cs\",\"OFF\");}\n    if(fl2s == true){msg6 = {payload: \"1\"};global.set(\"fl2cs\",\"ON\");}else{msg6 = {payload: \"0\"};global.set(\"fl2cs\",\"OFF\");}\n    if(fr3s == true){msg7 = {payload: \"1\"};global.set(\"fr3cs\",\"ON\");}else{msg7 = {payload: \"0\"};global.set(\"fr3cs\",\"OFF\");}\n    if(fr4s == true){msg8 = {payload: \"1\"};global.set(\"fr4cs\",\"ON\");}else{msg8 = {payload: \"0\"};global.set(\"fr4cs\",\"OFF\");}\n    return [msg1,msg2,msg3,msg4,msg5,msg6,msg7,msg8];\n}\nif (temp<fRef /*&& fan_flag*/ && status==\"ACTIVE\"){\n    global.set(\"fan_flag\", false);    //fan_flag=false;\n    global.set(\"fState\", \"OFF\");    //fState=\"OFF\";\n    if(coolingconnect==true){global.set(\"cState\", 0);}  \n    msg1 = {payload: \"OFF\"};   //msg.alarm=0;\n    msg3 = {payload: \"0\"};\n    msg2 = {//from : \"noreply@gmail.com\", \n            to : email, \n            cc: global.get(\"ccEmail\"), \n            bcc: global.get(\"bccEmail\"), \n            topic : location + \": New Fan State\",\n            payload : \"Fan deactivated.\",\n            text: location+ \": Fan deactivated. \"+d};\n    msg4={payload:{    \n    //uncomment and add telegram node if you want to send it \n    //\"chatId\":,\n        \"type\": \"message\",\n        \"content\": location+ \": Fan deactivated. \"+d}\n    };\n    //the nex line is for use the extractors defined by user to be used with the current temp reference\n    //since user selected in dashboard if every extractor work with every tref  (day,night,step)\n    //then, the control action will use or not that specific extractor to \n    //decrease the temperature\n    msg5 = {payload: \"0\"};global.set(\"fl1cs\",\"OFF\");msg6 = {payload: \"0\"};global.set(\"fl2cs\",\"OFF\");\n    msg7 = {payload: \"0\"};global.set(\"fr3cs\",\"OFF\");msg8 = {payload: \"0\"};global.set(\"fr4cs\",\"OFF\");\n    return [msg1,msg2,msg3,msg4,msg5,msg6,msg7,msg8];\n}else if(status !==\"ACTIVE\"  || msg.payload==\"STOP\"){\n    global.set(\"fan_flag\", true);   //fan_flag=true;\n    global.set(\"fState\", \"ON\");    //fState=\"ON\";\n    msg1 = {payload: \"ON\"};   //msg.alarm=1;\n    if(coolingconnect==true){global.set(\"cState\", 0);}  \n    msg3 = {payload: \"1\"};\n    msg2 = {//from : \"noreply@gmail.com\", \n            to : email, \n            cc: global.get(\"ccEmail\"), \n            bcc: global.get(\"bccEmail\"), \n            topic : location + \": New Fan State\",\n            payload : \"Fan activated.\",\n            text: location+ \": Fan activated while manual setting. \"+d};\n    msg4={payload:{    \n        //uncomment and add telegram node if you want to send it \n        //\"chatId\":,\"type\": \"message\",\n        \"content\": location+ \": Fan activated while manual setting. \"+d}\n    };\n    if(temp>=fRef+1){\n    msg5 = {payload: \"1\"};msg6 = {payload: \"1\"};//turn on four extractors\n    msg7 = {payload: \"1\"};msg8 = {payload: \"1\"};\n    global.set(\"fl1cs\",\"ON\");global.set(\"fl2cs\",\"ON\");\n    global.set(\"fr3cs\",\"ON\");global.set(\"fr4cs\",\"ON\");\n    }else if(temp<fRef-1){\n    msg5 = {payload: \"0\"};msg6 = {payload: \"0\"};//turn off four extractors\n    msg7 = {payload: \"0\"};msg8 = {payload: \"0\"};\n    global.set(\"fl1cs\",\"OFF\");global.set(\"fl2cs\",\"OFF\");\n    global.set(\"fr3cs\",\"OFF\");global.set(\"fr4cs\",\"OFF\");\n    }else{\n    msg5 = {payload: \"1\"};msg6 = {payload: \"1\"};//turn on four extractors\n    msg7 = {payload: \"1\"};msg8 = {payload: \"1\"};\n    }\n    return [msg1,msg2,msg3,msg4,msg5,msg6,msg7,msg8];\n}","outputs":8,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2410,"y":2080,"wires":[["138e8762.3405f9","5e9ea3ca.4d1abc"],["fd9525.1e305ad8","3c2d6b43.48b534"],["2146f122.b46b8e"],["e494b7e.0037e48"],["a1409743.727978"],["66c79a0e.21e484"],["bad68f87.10b36"],["2e6a13e5.c8667c"]]},{"id":"9e60dd2a.bc971","type":"function","z":"fd37fbb3.4259f8","name":"","func":"//Calculate dew point avg & vpd\n\ndew1=global.get(\"dew1\");dew10=global.get(\"dew10\");\ndew2=global.get(\"dew2\");dew11=global.get(\"dew11\");\ndew3=global.get(\"dew3\");dew12=global.get(\"dew12\");\ndew4=global.get(\"dew4\");dew13=global.get(\"dew13\");\ndew5=global.get(\"dew5\");dew14=global.get(\"dew14\");\ndew6=global.get(\"dew6\");dew15=global.get(\"dew15\");\ndew7=global.get(\"dew7\");dew16=global.get(\"dew16\");\ndew8=global.get(\"dew8\");dew17=global.get(\"dew17\");\ndew9=global.get(\"dew9\");dew18=global.get(\"dew18\");\ndew=(dew1+dew2+dew3+dew4+dew5+dew6+dew7+dew8+dew9+dew10+dew11+dew12+dew13+dew14+dew15+dew16+dew17+dew18)/18;\ndew=dew.toFixed(1);\nglobal.set(\"dewAvg\", dew);\n\npayload=msg.payload;\ntemp=payload.temp;\nhum=payload.hum;\n\ntmax = 35;\ntmin = 24;\nesat_tmax = 0.6108 * Math.exp(17.27 * tmax / (tmax + 237.3));\nesat_tmin = 0.6108 * Math.exp(17.27 * tmin / (tmin + 237.3))\nesat_tmean = (esat_tmax + esat_tmin)/2\neact_tmean = hum / 100 * esat_tmean\nvpd_tmean = esat_tmean-eact_tmean\nvpd_tmean = vpd_tmean.toFixed(5);\nglobal.set(\"vpd\", vpd_tmean);\n\nmsg1 = {topic:\"Temperature\", payload:temp};\nmsg2 = {topic:\"Humidity\", payload:hum};\nmsg3 = {topic:\"VPD\", payload:vpd_tmean};\n\nreturn [msg1,msg2,msg3];","outputs":3,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2260,"y":1180,"wires":[["511158d7.ae4fe8","ae2aa133.f20f1","ea278e22.dbdb2","4cbedffa.4b5a1"],["265cc1a7.613a8e","c7c0f709.aae878"],["15288358.88ce2d","e71ee7a8.260ad8"]]},{"id":"a40e2845.b715e8","type":"inject","z":"fd37fbb3.4259f8","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"30","crontab":"","once":true,"onceDelay":"30","topic":"","payload":"","payloadType":"date","x":1730,"y":1140,"wires":[["d28528df.515658"]]},{"id":"511158d7.ae4fe8","type":"ui_text","z":"fd37fbb3.4259f8","group":"b1990e72.3758d","order":1,"width":8,"height":1,"name":"T_SENSOR","label":"T","format":"{{msg.payload}} °C","layout":"row-center","x":2590,"y":1000,"wires":[]},{"id":"265cc1a7.613a8e","type":"ui_text","z":"fd37fbb3.4259f8","group":"b1990e72.3758d","order":3,"width":8,"height":1,"name":"H_SENSOR","label":"H","format":"{{msg.payload}} %","layout":"row-center","x":2590,"y":1080,"wires":[]},{"id":"61da762d.cdcf68","type":"comment","z":"fd37fbb3.4259f8","name":"SENSOR AVERAGE","info":"","x":2290,"y":1060,"wires":[]},{"id":"b1f691ed.2e14e","type":"function","z":"9bcfa612.592b38","name":"Global Date&Time","func":"d = new Date();\ndate = d.getDate() + \" \" + (d.getMonth() + 1) + \" \" + d.getFullYear();\ntime = d.toLocaleTimeString('en-US', { hour12: false });\nday = d.getDay();\n\nglobal.set(\"gDay\", day);\nglobal.set(\"gTime\", time);\nglobal.set(\"gDate\", date);\nglobal.set(\"gDateTime\", date+\"_\"+time);","outputs":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2310,"y":2000,"wires":[]},{"id":"ea95f275.88652","type":"inject","z":"9bcfa612.592b38","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"1","crontab":"","once":true,"onceDelay":"1","topic":"","payload":"","payloadType":"date","x":2110,"y":2000,"wires":[["b1f691ed.2e14e"]]},{"id":"ea278e22.dbdb2","type":"link out","z":"fd37fbb3.4259f8","name":"sensorAverage_timestamp_out","links":["5be58081.f4728","d75f9df0.7c154"],"x":2475,"y":1240,"wires":[]},{"id":"d75f9df0.7c154","type":"link in","z":"359ed2dc.ceea6e","name":"sensorAverage_timestamp_in","links":["8d587392.32f9e","ea278e22.dbdb2"],"x":2015,"y":2080,"wires":[["cd98931b.78f64"]]},{"id":"b343d31c.c478b","type":"link out","z":"6862f897.ee8958","name":"Email_Alarms_out","links":["f03a5128.5c217"],"x":2675,"y":2140,"wires":[]},{"id":"f03a5128.5c217","type":"link in","z":"9bcfa612.592b38","name":"Email_Alarms_in","links":["b343d31c.c478b"],"x":2855,"y":2260,"wires":[["192075ae.8daf6a"]]},{"id":"c7c0f709.aae878","type":"ui_chart","z":"fd37fbb3.4259f8","name":"H_SENSOR","group":"b1990e72.3758d","order":4,"width":8,"height":4,"label":"","chartType":"line","legend":"true","xformat":"HH:mm:ss","interpolate":"linear","nodata":"","dot":false,"ymin":"","ymax":"","removeOlder":"24","removeOlderPoints":"","removeOlderUnit":"3600","cutout":0,"useOneColor":false,"useUTC":false,"colors":["#1f77b3","#ec760d","#aec7e8","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"outputs":1,"useDifferentColor":false,"x":2590,"y":1120,"wires":[[]]},{"id":"ae2aa133.f20f1","type":"ui_chart","z":"fd37fbb3.4259f8","name":"T_SENSOR","group":"b1990e72.3758d","order":2,"width":8,"height":4,"label":"","chartType":"line","legend":"true","xformat":"HH:mm:ss","interpolate":"linear","nodata":"","dot":false,"ymin":"","ymax":"","removeOlder":"24","removeOlderPoints":"","removeOlderUnit":"3600","cutout":0,"useOneColor":false,"useUTC":false,"colors":["#ff7f0e","#1f77b4","#aec7e8","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"outputs":1,"useDifferentColor":false,"x":2590,"y":1040,"wires":[[]]},{"id":"fae7b615.1ce1c8","type":"comment","z":"fd37fbb3.4259f8","name":"SENSOR4","info":"","x":1900,"y":1700,"wires":[]},{"id":"fafcac7.f43ed5","type":"function","z":"fd37fbb3.4259f8","name":"Sensor4Data","func":"payload=msg.payload;\nn=payload.includes(\"Temperature\");\nlocation=global.get(\"location\");\nemail=global.get(\"email\");\nd=global.get(\"gDateTime\");\nif(n === true){\ntemp = JSON.parse(payload).SI7021.Temperature;\nhum = JSON.parse(payload).SI7021.Humidity;\ndew = JSON.parse(payload).SI7021.DewPoint;\n}else{temp =0;hum =0;dew=0;}\n\nif (n!==false && temp!==null){\n    //temp = JSON.parse(payload).SI7021.Temperature;\n    //hum = JSON.parse(payload).SI7021.Humidity;\n    //dew = JSON.parse(payload).SI7021.DewPoint;\n    //if(temp!==null){\n        global.set(\"temp4\",temp);\n        global.set(\"hum4\",hum);\n        global.set(\"dew4\",dew);\n        global.set(\"s4Flag\", false);\n        \n        msg1 = {topic: \"Temperature4\", payload: temp};\n        msg2 = {topic: \"Humidity4\", payload: hum};\n        \n        return [msg1,msg2,null,null];\n    //}\n}else if (payload==\"sensor4Fail\" || temp===null){\n    global.set(\"s4Flag\", true);\n    //global.set(\"temp4\",30);\n    //global.set(\"hum4\",0);\n    global.set(\"dew4\",0);\n    msg1 = {//from : \"noreply@gmail.com\",\n            to : email, \n            cc: global.get(\"ccEmail\"), \n            bcc: global.get(\"bccEmail\"), \n            topic : location + \": Sensor Fail\", \n            payload : \"Reading Failed!. Sensor 4 offline.\",\n            text: location+ \": Reading Failed!. Sensor 4 offline. \"+d\n    };\n    msg2={payload:{\n        //uncomment if you want send telegram message\n        //\"chatId\": \"your telegram chatId number must be integer\",\n        \"type\": \"message\",\n        \"content\": location+ \": Reading Failed!. Sensor 4 offline. \"+d}\n    };\n    return [null,null,msg1,msg2];\n}else{\n    return null;\n}","outputs":4,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1890,"y":1740,"wires":[["7abf7618.738898","4ba55b02.0bdc54"],["a6487ef0.24c91","51f38d08.14dca4"],["a105c791.117138"],["7ade7b6c.ee0904"]]},{"id":"7abf7618.738898","type":"ui_text","z":"fd37fbb3.4259f8","group":"61c2c538.32dfbc","order":13,"width":2,"height":1,"name":"T_SENSOR4","label":"T4","format":"{{msg.payload}} °C","layout":"col-center","x":2070,"y":1680,"wires":[]},{"id":"a6487ef0.24c91","type":"ui_text","z":"fd37fbb3.4259f8","group":"61c2c538.32dfbc","order":29,"width":2,"height":1,"name":"H_SENSOR4","label":"H4","format":"{{msg.payload}} %","layout":"col-center","x":2080,"y":1760,"wires":[]},{"id":"3160090f.f03eb6","type":"comment","z":"fd37fbb3.4259f8","name":"SENSOR5","info":"","x":1900,"y":1820,"wires":[]},{"id":"49995189.0e516","type":"function","z":"fd37fbb3.4259f8","name":"Sensor5Data","func":"payload=msg.payload;\nn=payload.includes(\"Temperature\");\nlocation=global.get(\"location\");\nemail=global.get(\"email\");\nd=global.get(\"gDateTime\");\n\nif(n === true){\ntemp = JSON.parse(payload).SI7021.Temperature;\nhum = JSON.parse(payload).SI7021.Humidity;\ndew = JSON.parse(payload).SI7021.DewPoint;\n}else{temp =0;hum =0;dew=0;}\n\nif (n!==false && temp!==null){\n    //temp = JSON.parse(payload).SI7021.Temperature;\n    //hum = JSON.parse(payload).SI7021.Humidity;\n    //dew = JSON.parse(payload).SI7021.DewPoint;\n    //if(temp!==null){\n        global.set(\"temp5\",temp);\n        global.set(\"hum5\",hum);\n        global.set(\"dew5\",dew);\n        global.set(\"s5Flag\", false);\n        \n        msg1 = {topic: \"Temperature5\", payload: temp};\n        msg2 = {topic: \"Humidity5\", payload: hum};\n        \n        return [msg1,msg2,null,null];\n    //}\n}else if (payload==\"sensor5Fail\" || temp===null){\n    global.set(\"s5Flag\", true);\n    //global.set(\"temp5\",30);\n    //global.set(\"hum5\",0);\n    global.set(\"dew5\",0);\n    msg1 = {//from : \"noreply@gmail.com\",\n            to : email, \n            cc: global.get(\"ccEmail\"), \n            bcc: global.get(\"bccEmail\"), \n            topic : location + \": Sensor Fail\", \n            payload : \"Reading Failed!. Sensor 5 offline.\",\n            text: location+ \": Reading Failed!. Sensor 5 offline. \"+d\n    };\n    msg2={payload:{\n        //uncomment if you want send telegram message\n        //\"chatId\": \"your telegram chatId number must be integer\",\n        \"type\": \"message\",\n        \"content\": location+ \": Reading Failed!. Sensor 5 offline. \"+d}\n    };\n    return [null,null,msg1,msg2];\n}else{\n    return null;\n}","outputs":4,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1890,"y":1860,"wires":[["4dc28a3d.c7e404","4ba55b02.0bdc54"],["1a860f1a.851231","51f38d08.14dca4"],["a105c791.117138"],["7ade7b6c.ee0904"]]},{"id":"4dc28a3d.c7e404","type":"ui_text","z":"fd37fbb3.4259f8","group":"61c2c538.32dfbc","order":8,"width":2,"height":1,"name":"T_SENSOR5","label":"T5","format":"{{msg.payload}} °C","layout":"col-center","x":2110,"y":1820,"wires":[]},{"id":"1a860f1a.851231","type":"ui_text","z":"fd37fbb3.4259f8","group":"61c2c538.32dfbc","order":24,"width":2,"height":1,"name":"H_SENSOR5","label":"H5","format":"{{msg.payload}} %","layout":"col-center","x":2120,"y":1900,"wires":[]},{"id":"d29737fa.e352d8","type":"comment","z":"fd37fbb3.4259f8","name":"SENSOR6","info":"","x":1900,"y":1940,"wires":[]},{"id":"a1f54f09.fbcb1","type":"function","z":"fd37fbb3.4259f8","name":"Sensor6Data","func":"payload=msg.payload;\nn=payload.includes(\"Temperature\");\nlocation=global.get(\"location\");\nemail=global.get(\"email\");\nd=global.get(\"gDateTime\");\n\n\nif(n === true){\ntemp = JSON.parse(payload).SI7021.Temperature;\nhum = JSON.parse(payload).SI7021.Humidity;\ndew = JSON.parse(payload).SI7021.DewPoint;\n}else{temp =0;hum =0;dew=0;}\n\nif (n!==false && temp!==null){\n    //temp = JSON.parse(payload).SI7021.Temperature;\n    //hum = JSON.parse(payload).SI7021.Humidity;\n    //dew = JSON.parse(payload).SI7021.DewPoint;\n    //if(temp!==null){\n        global.set(\"temp6\",temp);\n        global.set(\"hum6\",hum);\n        global.set(\"dew6\",dew);\n        global.set(\"s6Flag\", false);\n        \n        msg1 = {topic: \"Temperature6\", payload: temp};\n        msg2 = {topic: \"Humidity6\", payload: hum};\n        \n        return [msg1,msg2,null,null];\n    //}\n}else if (payload==\"sensor6Fail\" || temp===null){\n    global.set(\"s6Flag\", true);\n    //global.set(\"temp6\",30);\n    //global.set(\"hum6\",0);\n    global.set(\"dew6\",0);\n    msg1 = {//from : \"noreply@gmail.com\",\n            to : email, \n            cc: global.get(\"ccEmail\"), \n            bcc: global.get(\"bccEmail\"), \n            topic : location + \": Sensor Fail\", \n            payload : \"Reading Failed!. Sensor 6 offline.\",\n            text: location+ \": Reading Failed!. Sensor 6 offline. \"+d\n    };\n    msg2={payload:{\n        //uncomment if you want send telegram message\n        //\"chatId\": \"your telegram chatId number must be integer\",\n        \"type\": \"message\",\n        \"content\": location+ \": Reading Failed!. Sensor 6 offline. \"+d}\n    };\n    return [null,null,msg1,msg2];\n}else{\n    return null;\n}","outputs":4,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1890,"y":1980,"wires":[["27cc21f7.2d490e","4ba55b02.0bdc54"],["516f6b87.4cdbb4","51f38d08.14dca4"],["a105c791.117138"],["7ade7b6c.ee0904"]]},{"id":"27cc21f7.2d490e","type":"ui_text","z":"fd37fbb3.4259f8","group":"61c2c538.32dfbc","order":3,"width":2,"height":1,"name":"T_SENSOR6","label":"T6","format":"{{msg.payload}} °C","layout":"col-center","x":2110,"y":1940,"wires":[]},{"id":"516f6b87.4cdbb4","type":"ui_text","z":"fd37fbb3.4259f8","group":"61c2c538.32dfbc","order":19,"width":2,"height":1,"name":"H_SENSOR6","label":"H6","format":"{{msg.payload}} %","layout":"col-center","x":2120,"y":2020,"wires":[]},{"id":"d7ef21d6.2ff41","type":"function","z":"fd37fbb3.4259f8","name":"Sensor1Data","func":"//Get data from sensor and check if fails or not\n//\npayload=msg.payload;\nn=payload.includes(\"Temperature\");\nlocation=global.get(\"location\");\nemail=global.get(\"email\");\nd=global.get(\"gDateTime\");\nif(n === true){\ntemp = JSON.parse(payload).SI7021.Temperature;\nhum = JSON.parse(payload).SI7021.Humidity;\ndew = JSON.parse(payload).SI7021.DewPoint;\n}else{temp =0;hum =0;dew=0;}\n\nif (n!==false && temp!==null){\n        global.set(\"temp1\",temp);\n        global.set(\"hum1\",hum);\n        global.set(\"dew1\",dew);\n        global.set(\"s1Flag\", false);\n        \n        msg1 = {topic: \"Temperature1\", payload: temp};\n        msg2 = {topic: \"Humidity1\", payload: hum};\n        \n        return [msg1,msg2,null,null];\n    //}\n}else if (payload==\"sensor1Fail\" || temp===null){\n    global.set(\"s1Flag\", true);\n    //global.set(\"temp1\",30);\n    //global.set(\"hum1\",0);\n    global.set(\"dew1\",0);\n    msg1 = {//from : \"noreply@gmail.com\",\n            to : email, \n            cc: global.get(\"ccEmail\"), \n            bcc: global.get(\"bccEmail\"), \n            topic : location + \": Sensor Fail\", \n            payload : \"Reading Failed!. Sensor 1 offline.\",\n            text: location+ \": Reading Failed!. Sensor 1 offline. \"+d\n    };\n    msg2={payload:{\n        //uncomment if you want send telegram message\n        //\"chatId\": \"your telegram chatId number must be integer\",\n        \"type\": \"message\",\n        \"content\": location+ \": Reading Failed!. Sensor 1 offline. \"+d}\n    };\n    return [null,null,msg1,msg2];\n}else{\n    return null;\n}","outputs":4,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1890,"y":1340,"wires":[["4317216c.e2834","4ba55b02.0bdc54"],["6470997f.e87eb8","51f38d08.14dca4"],["a105c791.117138"],["7ade7b6c.ee0904"]]},{"id":"4317216c.e2834","type":"ui_text","z":"fd37fbb3.4259f8","group":"61c2c538.32dfbc","order":11,"width":2,"height":1,"name":"T_SENSOR1","label":"T1","format":"{{msg.payload}} °C","layout":"col-center","x":2070,"y":1300,"wires":[]},{"id":"6470997f.e87eb8","type":"ui_text","z":"fd37fbb3.4259f8","group":"61c2c538.32dfbc","order":27,"width":2,"height":1,"name":"H_SENSOR1","label":"H1","format":"{{msg.payload}} %","layout":"col-center","x":2080,"y":1380,"wires":[]},{"id":"10220716.578959","type":"comment","z":"fd37fbb3.4259f8","name":"SENSOR2 (19)","info":"","x":1920,"y":1420,"wires":[]},{"id":"ff76d941.946df8","type":"function","z":"fd37fbb3.4259f8","name":"Sensor2Data","func":"payload=msg.payload;\nn=payload.includes(\"Temperature\");\nlocation=global.get(\"location\");\nemail=global.get(\"email\");\nd=global.get(\"gDateTime\");\nif(n === true){\ntemp = JSON.parse(payload).SI7021.Temperature;\nhum = JSON.parse(payload).SI7021.Humidity;\ndew = JSON.parse(payload).SI7021.DewPoint;\n}else{temp =0;hum =0;dew=0;}\n\nif (n!==false && temp!==null){\n    //temp = JSON.parse(payload).SI7021.Temperature;\n    //hum = JSON.parse(payload).SI7021.Humidity;\n    //dew = JSON.parse(payload).SI7021.DewPoint;\n    //if(temp!==null){\n        global.set(\"temp2\",temp);\n        global.set(\"hum2\",hum);\n        global.set(\"dew2\",dew);\n        global.set(\"s2Flag\", false);\n        \n        msg1 = {topic: \"Temperature2\", payload: temp};\n        msg2 = {topic: \"Humidity2\", payload: hum};\n        \n        return [msg1,msg2,null,null];\n    //}\n}else if (payload==\"sensor2Fail\" || temp===null){\n    global.set(\"s2Flag\", true);\n    //global.set(\"temp2\",30);\n    //global.set(\"hum2\",0);\n    global.set(\"dew2\",0);\n    msg1 = {//from : \"noreply@gmail.com\",\n            to : email, \n            cc: global.get(\"ccEmail\"), \n            bcc: global.get(\"bccEmail\"), \n            topic : location + \": Sensor Fail\", \n            payload : \"Reading Failed!. Sensor 2 offline.\",\n            text: location+ \": Reading Failed!. Sensor 2 offline. \"+d\n    };\n    msg2={payload:{\n        //uncomment if you want send telegram message\n        //\"chatId\": \"your telegram chatId number must be integer\",\n        \"type\": \"message\",\n        \"content\": location+ \": Reading Failed!. Sensor 2 offline. \"+d}\n    };\n    return [null,null,msg1,msg2];\n}else{\n    return null;\n}","outputs":4,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1890,"y":1480,"wires":[["642b3e36.efca5","4ba55b02.0bdc54"],["5c782a16.f094f4","51f38d08.14dca4"],["a105c791.117138"],["7ade7b6c.ee0904"]]},{"id":"642b3e36.efca5","type":"ui_text","z":"fd37fbb3.4259f8","group":"61c2c538.32dfbc","order":6,"width":2,"height":1,"name":"T_SENSOR2","label":"T2","format":"{{msg.payload}} °C","layout":"col-center","x":2110,"y":1440,"wires":[]},{"id":"5c782a16.f094f4","type":"ui_text","z":"fd37fbb3.4259f8","group":"61c2c538.32dfbc","order":22,"width":2,"height":1,"name":"H_SENSOR2","label":"H2","format":"{{msg.payload}} %","layout":"col-center","x":2120,"y":1520,"wires":[]},{"id":"1e28941c.0e26cc","type":"comment","z":"fd37fbb3.4259f8","name":"SENSOR9","info":"","x":1920,"y":2340,"wires":[]},{"id":"a49a6f41.1fb0e","type":"function","z":"fd37fbb3.4259f8","name":"Sensor3Data","func":"payload=msg.payload;\nn=payload.includes(\"Temperature\");\nlocation=global.get(\"location\");\nemail=global.get(\"email\");\nd=global.get(\"gDateTime\");\nif(n === true){\ntemp = JSON.parse(payload).SI7021.Temperature;\nhum = JSON.parse(payload).SI7021.Humidity;\ndew = JSON.parse(payload).SI7021.DewPoint;\n}else{temp =0;hum =0;dew=0;}\n\nif (n!==false && temp!==null){\n    //temp = JSON.parse(payload).SI7021.Temperature;\n    //hum = JSON.parse(payload).SI7021.Humidity;\n    //dew = JSON.parse(payload).SI7021.DewPoint;\n    //if(temp!==null){\n        global.set(\"temp3\",temp);\n        global.set(\"hum3\",hum);\n        global.set(\"dew3\",dew);\n        global.set(\"s3Flag\", false);\n        \n        msg1 = {topic: \"Temperature3\", payload: temp};\n        msg2 = {topic: \"Humidity3\", payload: hum};\n        \n        return [msg1,msg2,null,null];\n    //}\n}else if (payload==\"sensor3Fail\" || temp===null){\n    global.set(\"s3Flag\", true);\n    //global.set(\"temp3\",30);\n    //global.set(\"hum3\",0);\n    global.set(\"dew3\",0);\n    msg1 = {//from : \"noreply@gmail.com\",\n            to : email, \n            cc: global.get(\"ccEmail\"), \n            bcc: global.get(\"bccEmail\"), \n            topic : location + \": Sensor Fail\", \n            payload : \"Reading Failed!. Sensor 3 offline.\",\n            text: location+ \": Reading Failed!. Sensor 3 offline. \"+d\n    };\n    msg2={payload:{\n        //uncomment if you want send telegram message\n        //\"chatId\": \"your telegram chatId number must be integer\",\n        \"type\": \"message\",\n        \"content\": location+ \": Reading Failed!. Sensor 3 offline. \"+d}\n    };\n    return [null,null,msg1,msg2];\n}else{\n    return null;\n}","outputs":4,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1890,"y":1600,"wires":[["22ed20ca.30ad8","4ba55b02.0bdc54"],["580a785e.6385e8","51f38d08.14dca4"],["a105c791.117138"],["7ade7b6c.ee0904"]]},{"id":"22ed20ca.30ad8","type":"ui_text","z":"fd37fbb3.4259f8","group":"61c2c538.32dfbc","order":1,"width":2,"height":1,"name":"T_SENSOR3","label":"T3","format":"{{msg.payload}} °C","layout":"col-center","x":2110,"y":1560,"wires":[]},{"id":"580a785e.6385e8","type":"ui_text","z":"fd37fbb3.4259f8","group":"61c2c538.32dfbc","order":17,"width":2,"height":1,"name":"H_SENSOR3","label":"H3","format":"{{msg.payload}} %","layout":"col-center","x":2120,"y":1640,"wires":[]},{"id":"9fd69143.b0cb8","type":"function","z":"fd37fbb3.4259f8","name":"Sensor7Data","func":"payload=msg.payload;\nn=payload.includes(\"Temperature\");\nlocation=global.get(\"location\");\nemail=global.get(\"email\");\nd=global.get(\"gDateTime\");\n\nif(n === true){\ntemp = JSON.parse(payload).SI7021.Temperature;\nhum = JSON.parse(payload).SI7021.Humidity;\ndew = JSON.parse(payload).SI7021.DewPoint;\n}else{temp =0;hum =0;dew=0;}\n\nif (n!==false && temp!==null){\n    //temp = JSON.parse(payload).SI7021.Temperature;\n    //hum = JSON.parse(payload).SI7021.Humidity;\n    //dew = JSON.parse(payload).SI7021.DewPoint;\n    //if(temp!==null){\n        global.set(\"temp7\",temp);\n        global.set(\"hum7\",hum);\n        global.set(\"dew7\",dew);\n        global.set(\"s7Flag\", false);\n        \n        msg1 = {topic: \"Temperature7\", payload: temp};\n        msg2 = {topic: \"Humidity7\", payload: hum};\n        \n        return [msg1,msg2,null,null];\n    //}\n}else if (payload==\"sensor7Fail\" || temp===null){\n    global.set(\"s7Flag\", true);\n    //global.set(\"temp7\",30);\n    //global.set(\"hum7\",0);\n    global.set(\"dew7\",0);\n    msg1 = {//from : \"noreply@gmail.com\",\n            to : email, \n            cc: global.get(\"ccEmail\"), \n            bcc: global.get(\"bccEmail\"), \n            topic : location + \": Sensor Fail\", \n            payload : \"Reading Failed!. Sensor 7 offline.\",\n            text: location+ \": Reading Failed!. Sensor 7 offline. \"+d\n    };\n    msg2={payload:{\n        //uncomment if you want send telegram message\n        //\"chatId\": \"your telegram chatId number must be integer\",\n        \"type\": \"message\",\n        \"content\": location+ \": Reading Failed!. Sensor 7 offline. \"+d}\n    };\n    return [null,null,msg1,msg2];\n}else{\n    return null;\n}","outputs":4,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1890,"y":2100,"wires":[["506b4d3.dc2cfb4","4ba55b02.0bdc54"],["a8178610.209df8","51f38d08.14dca4"],["a105c791.117138"],["7ade7b6c.ee0904"]]},{"id":"506b4d3.dc2cfb4","type":"ui_text","z":"fd37fbb3.4259f8","group":"61c2c538.32dfbc","order":15,"width":2,"height":1,"name":"T_SENSOR7","label":"T7","format":"{{msg.payload}} °C","layout":"col-center","x":2090,"y":2060,"wires":[]},{"id":"a8178610.209df8","type":"ui_text","z":"fd37fbb3.4259f8","group":"61c2c538.32dfbc","order":31,"width":2,"height":1,"name":"H_SENSOR7","label":"H7","format":"{{msg.payload}} %","layout":"col-center","x":2100,"y":2140,"wires":[]},{"id":"ba19bfbb.68e37","type":"comment","z":"fd37fbb3.4259f8","name":"SENSOR8","info":"","x":1880,"y":2180,"wires":[]},{"id":"8d743407.a2ee68","type":"function","z":"fd37fbb3.4259f8","name":"Sensor8Data","func":"payload=msg.payload;\nn=payload.includes(\"Temperature\");\nlocation=global.get(\"location\");\nemail=global.get(\"email\");\nd=global.get(\"gDateTime\");\n\nif(n === true){\ntemp = JSON.parse(payload).SI7021.Temperature;\nhum = JSON.parse(payload).SI7021.Humidity;\ndew = JSON.parse(payload).SI7021.DewPoint;\n}else{temp =0;hum =0;dew=0;}\n    \nif (n!==false && temp!==null){\n    //temp = JSON.parse(payload).SI7021.Temperature;\n    //hum = JSON.parse(payload).SI7021.Humidity;\n    //dew = JSON.parse(payload).SI7021.DewPoint;\n    //if(temp!==null){\n        global.set(\"temp8\",temp);\n        global.set(\"hum8\",hum);\n        global.set(\"dew8\",dew);\n        global.set(\"s8Flag\", false);\n        \n        msg1 = {topic: \"Temperature8\", payload: temp};\n        msg2 = {topic: \"Humidity8\", payload: hum};\n        \n        return [msg1,msg2,null,null];\n    //}\n}else if (payload==\"sensor8Fail\" || temp===null){\n    global.set(\"s8Flag\", true);\n    //global.set(\"temp8\",30);\n    //global.set(\"hum8\",0);\n    global.set(\"dew8\",0);\n    msg1 = {//from : \"noreply@gmail.com\",\n            to : email, \n            cc: global.get(\"ccEmail\"), \n            bcc: global.get(\"bccEmail\"), \n            topic : location + \": Sensor Fail\", \n            payload : \"Reading Failed!. Sensor 8 offline.\",\n            text: location+ \": Reading Failed!. Sensor 8 offline. \"+d\n    };\n    msg2={payload:{\n        //uncomment if you want send telegram message\n        //\"chatId\": \"your telegram chatId number must be integer\",\n        \"type\": \"message\",\n        \"content\": location+ \": Reading Failed!. Sensor 8 offline. \"+d}\n    };\n    return [null,null,msg1,msg2];\n}else{\n    return null;\n}","outputs":4,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1890,"y":2240,"wires":[["32ef8cdc.af6fa4","4ba55b02.0bdc54"],["f678cc29.ed5b6","51f38d08.14dca4"],["a105c791.117138"],["7ade7b6c.ee0904"]]},{"id":"32ef8cdc.af6fa4","type":"ui_text","z":"fd37fbb3.4259f8","group":"61c2c538.32dfbc","order":10,"width":2,"height":1,"name":"T_SENSOR8","label":"T8","format":"{{msg.payload}} °C","layout":"col-center","x":2130,"y":2200,"wires":[]},{"id":"f678cc29.ed5b6","type":"ui_text","z":"fd37fbb3.4259f8","group":"61c2c538.32dfbc","order":26,"width":2,"height":1,"name":"H_SENSOR8","label":"H8","format":"{{msg.payload}} %","layout":"col-center","x":2140,"y":2280,"wires":[]},{"id":"a2bcf764.bf4cf8","type":"comment","z":"fd37fbb3.4259f8","name":"SENSOR3","info":"","x":1880,"y":1540,"wires":[]},{"id":"1b49f683.af82f9","type":"function","z":"fd37fbb3.4259f8","name":"Sensor9Data","func":"payload=msg.payload;\nn=payload.includes(\"Temperature\");\nlocation=global.get(\"location\");\nemail=global.get(\"email\");\nd=global.get(\"gDateTime\");\n\nif(n === true){\ntemp = JSON.parse(payload).SI7021.Temperature;\nhum = JSON.parse(payload).SI7021.Humidity;\ndew = JSON.parse(payload).SI7021.DewPoint;\n}else{temp =0;hum =0;dew=0;}\n    \nif (n!==false && temp!==null){\n    //temp = JSON.parse(payload).SI7021.Temperature;\n    //hum = JSON.parse(payload).SI7021.Humidity;\n    //dew = JSON.parse(payload).SI7021.DewPoint;\n    //if(temp!==null){\n        global.set(\"temp9\",temp);\n        global.set(\"hum9\",hum);\n        global.set(\"dew9\",dew);\n        global.set(\"s9Flag\", false);\n        \n        msg1 = {topic: \"Temperature9\", payload: temp};\n        msg2 = {topic: \"Humidity9\", payload: hum};\n        \n        return [msg1,msg2,null,null];\n    //}\n}else if (payload==\"sensor9Fail\" || temp===null){\n    global.set(\"s9Flag\", true);\n    //global.set(\"temp9\",30);\n    //global.set(\"hum9\",0);\n    global.set(\"dew9\",0);\n    msg1 = {//from : \"noreply@gmail.com\",\n            to : email, \n            cc: global.get(\"ccEmail\"), \n            bcc: global.get(\"bccEmail\"), \n            topic : location + \": Sensor Fail\", \n            payload : \"Reading Failed!. Sensor 9 offline.\",\n            text: location+ \": Reading Failed!. Sensor 9 offline. \"+d\n    };\n    msg2={payload:{\n        //uncomment if you want send telegram message\n        //\"chatId\": \"your telegram chatId number must be integer\",\n        \"type\": \"message\",\n        \"content\": location+ \": Reading Failed!. Sensor 9 offline. \"+d}\n    };\n    return [null,null,msg1,msg2];\n}else{\n    return null;\n}","outputs":4,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1890,"y":2380,"wires":[["66005101.0759f","4ba55b02.0bdc54"],["4f6889a9.24fb88","51f38d08.14dca4"],["a105c791.117138"],["7ade7b6c.ee0904"]]},{"id":"66005101.0759f","type":"ui_text","z":"fd37fbb3.4259f8","group":"61c2c538.32dfbc","order":5,"width":2,"height":1,"name":"T_SENSOR9","label":"T9","format":"{{msg.payload}} °C","layout":"col-center","x":2130,"y":2340,"wires":[]},{"id":"773ebfa7.62d96","type":"comment","z":"fd37fbb3.4259f8","name":"SENSOR7","info":"","x":1900,"y":2040,"wires":[]},{"id":"4f6889a9.24fb88","type":"ui_text","z":"fd37fbb3.4259f8","group":"61c2c538.32dfbc","order":21,"width":2,"height":1,"name":"H_SENSOR9","label":"H9","format":"{{msg.payload}} %","layout":"col-center","x":2140,"y":2420,"wires":[]},{"id":"ff0ee875.a70148","type":"comment","z":"fd37fbb3.4259f8","name":"SENSOR1","info":"","x":1880,"y":1300,"wires":[]},{"id":"42ee9be8.8e1a64","type":"function","z":"9bcfa612.592b38","name":"DataSensor2","func":"date = global.get(\"gDate\");\ntime = global.get(\"gTime\");\n\n// DATA table\ncrop=global.get(\"crop\");\ntrial=global.get(\"trial\");\nlocation=global.get(\"location\");\nauthor=global.get(\"author\");\nemail=global.get(\"email\");\nphone=global.get(\"phone\");\n\n//Sensor\nsensor=\"sensor2\";\ntemp=global.get(\"temp2\");\nhum=global.get(\"hum2\");\ndew=global.get(\"dew2\");\n//Alerts\ntempalert=global.get(\"tempalert\");\nhumalert=global.get(\"humalert\");\n\nfref=global.get(\"fRef\");\n\nquery = \"INSERT INTO DATA (DATE,TIME,CROP,TRIAL,LOCATION,AUTHOR,EMAIL,PHONE,SENSOR,TEMPERATURE,HUMIDITY,DEWPOINT,TEMPALERT,HUMALERT,TREF)\";\nquery = query + \"VALUES ('\" + date + \"','\" + time + \"','\" + crop + \"','\" + trial + \"','\" + location + \"','\" + author + \"','\" + email + \"','\" + phone + \"','\";\nquery = query + sensor + \"','\" + temp + \"','\" + hum + \"','\" + dew + \"','\";\nquery = query + tempalert + \"','\" + humalert + \"','\" + fref + \"');\";\n\n//ID int auto_increment,DATE varchar(255),TIME varchar(255),CROP varchar(255),TRIAL varchar(255),LOCATION varchar(255),AUTHOR varchar(255),EMAIL varchar(255),PHONE INT,SENSOR varchar(255),TEMPERATURE double,HUMIDITY double,DEWPOINT double,TEMPALERT double,HUMALERT double,TREF double,primary key(ID)\n\n\ncsv = (`${date}, ${time}, ${sensor}, ${temp}, ${hum}, ${dew}, ${tempalert}, ${humalert}, ${fref}`);\n\n//if(status==\"ACTIVE\"){\n//    msg1 = {topic : query, payload: csv};\n//    return msg1;\n//}else{\n    //return null;\n    msg1 = {topic : query, payload: csv};\n    return msg1;\n//}","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2290,"y":2260,"wires":[["4e81bae3.0e1ac4","d6e54600.11f788"]]},{"id":"1c6e2e69.ed4af2","type":"function","z":"9bcfa612.592b38","name":"DataSensor3","func":"date = global.get(\"gDate\");\ntime = global.get(\"gTime\");\n\n// DATA table\ncrop=global.get(\"crop\");\ntrial=global.get(\"trial\");\nlocation=global.get(\"location\");\nauthor=global.get(\"author\");\nemail=global.get(\"email\");\nphone=global.get(\"phone\");\n\n//Sensor\nsensor=\"sensor3\";\ntemp=global.get(\"temp3\");\nhum=global.get(\"hum3\");\ndew=global.get(\"dew3\");\n//Alerts\ntempalert=global.get(\"tempalert\");\nhumalert=global.get(\"humalert\");\n\nfref=global.get(\"fRef\");\n\nquery = \"INSERT INTO DATA (DATE,TIME,CROP,TRIAL,LOCATION,AUTHOR,EMAIL,PHONE,SENSOR,TEMPERATURE,HUMIDITY,DEWPOINT,TEMPALERT,HUMALERT,TREF)\";\nquery = query + \"VALUES ('\" + date + \"','\" + time + \"','\" + crop + \"','\" + trial + \"','\" + location + \"','\" + author + \"','\" + email + \"','\" + phone + \"','\";\nquery = query + sensor + \"','\" + temp + \"','\" + hum + \"','\" + dew + \"','\";\nquery = query + tempalert + \"','\" + humalert + \"','\" + fref + \"');\";\n\n//ID int auto_increment,DATE varchar(255),TIME varchar(255),CROP varchar(255),TRIAL varchar(255),LOCATION varchar(255),AUTHOR varchar(255),EMAIL varchar(255),PHONE INT,SENSOR varchar(255),TEMPERATURE double,HUMIDITY double,DEWPOINT double,TEMPALERT double,HUMALERT double,TREF double,primary key(ID)\n\n\ncsv = (`${date}, ${time}, ${sensor}, ${temp}, ${hum}, ${dew}, ${tempalert}, ${humalert}, ${fref}`);\n//if(status==\"ACTIVE\"){\n//    msg1 = {topic : query, payload: csv};\n//    return msg1;\n//}else{\n    //return null;\n    msg1 = {topic : query, payload: csv};\n    return msg1;\n//}","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2290,"y":2300,"wires":[["4e81bae3.0e1ac4","d6e54600.11f788"]]},{"id":"e7b0f572.792e78","type":"function","z":"9bcfa612.592b38","name":"DataSensor4","func":"date = global.get(\"gDate\");\ntime = global.get(\"gTime\");\n\n// DATA table\ncrop=global.get(\"crop\");\ntrial=global.get(\"trial\");\nlocation=global.get(\"location\");\nauthor=global.get(\"author\");\nemail=global.get(\"email\");\nphone=global.get(\"phone\");\n\n//Sensor\nsensor=\"sensor4\";\ntemp=global.get(\"temp4\");\nhum=global.get(\"hum4\");\ndew=global.get(\"dew4\");\n//Alerts\ntempalert=global.get(\"tempalert\");\nhumalert=global.get(\"humalert\");\n\nfref=global.get(\"fRef\");\n\nquery = \"INSERT INTO DATA (DATE,TIME,CROP,TRIAL,LOCATION,AUTHOR,EMAIL,PHONE,SENSOR,TEMPERATURE,HUMIDITY,DEWPOINT,TEMPALERT,HUMALERT,TREF)\";\nquery = query + \"VALUES ('\" + date + \"','\" + time + \"','\" + crop + \"','\" + trial + \"','\" + location + \"','\" + author + \"','\" + email + \"','\" + phone + \"','\";\nquery = query + sensor + \"','\" + temp + \"','\" + hum + \"','\" + dew + \"','\";\nquery = query + tempalert + \"','\" + humalert + \"','\" + fref + \"');\";\n\n//ID int auto_increment,DATE varchar(255),TIME varchar(255),CROP varchar(255),TRIAL varchar(255),LOCATION varchar(255),AUTHOR varchar(255),EMAIL varchar(255),PHONE INT,SENSOR varchar(255),TEMPERATURE double,HUMIDITY double,DEWPOINT double,TEMPALERT double,HUMALERT double,TREF double,primary key(ID)\n\n\ncsv = (`${date}, ${time}, ${sensor}, ${temp}, ${hum}, ${dew}, ${tempalert}, ${humalert}, ${fref}`);\n//if(status==\"ACTIVE\"){\n//    msg1 = {topic : query, payload: csv};\n//    return msg1;\n//}else{\n    //return null;\n    msg1 = {topic : query, payload: csv};\n    return msg1;\n//}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2290,"y":2340,"wires":[["4e81bae3.0e1ac4","d6e54600.11f788"]]},{"id":"e619783b.a9a468","type":"function","z":"9bcfa612.592b38","name":"DataSensor5","func":"date = global.get(\"gDate\");\ntime = global.get(\"gTime\");\n\n// DATA table\ncrop=global.get(\"crop\");\ntrial=global.get(\"trial\");\nlocation=global.get(\"location\");\nauthor=global.get(\"author\");\nemail=global.get(\"email\");\nphone=global.get(\"phone\");\n\n//Sensor\nsensor=\"sensor5\";\ntemp=global.get(\"temp5\");\nhum=global.get(\"hum5\");\ndew=global.get(\"dew5\");\n//Alerts\ntempalert=global.get(\"tempalert\");\nhumalert=global.get(\"humalert\");\n\nfref=global.get(\"fRef\");\n\nquery = \"INSERT INTO DATA (DATE,TIME,CROP,TRIAL,LOCATION,AUTHOR,EMAIL,PHONE,SENSOR,TEMPERATURE,HUMIDITY,DEWPOINT,TEMPALERT,HUMALERT,TREF)\";\nquery = query + \"VALUES ('\" + date + \"','\" + time + \"','\" + crop + \"','\" + trial + \"','\" + location + \"','\" + author + \"','\" + email + \"','\" + phone + \"','\";\nquery = query + sensor + \"','\" + temp + \"','\" + hum + \"','\" + dew + \"','\";\nquery = query + tempalert + \"','\" + humalert + \"','\" + fref + \"');\";\n\n//ID int auto_increment,DATE varchar(255),TIME varchar(255),CROP varchar(255),TRIAL varchar(255),LOCATION varchar(255),AUTHOR varchar(255),EMAIL varchar(255),PHONE INT,SENSOR varchar(255),TEMPERATURE double,HUMIDITY double,DEWPOINT double,TEMPALERT double,HUMALERT double,TREF double,primary key(ID)\n\n\ncsv = (`${date}, ${time}, ${sensor}, ${temp}, ${hum}, ${dew}, ${tempalert}, ${humalert}, ${fref}`);\n//if(status==\"ACTIVE\"){\n//    msg1 = {topic : query, payload: csv};\n//    return msg1;\n//}else{\n    //return null;\n    msg1 = {topic : query, payload: csv};\n    return msg1;\n//}","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2290,"y":2380,"wires":[["4e81bae3.0e1ac4","d6e54600.11f788"]]},{"id":"8b28201d.18986","type":"function","z":"9bcfa612.592b38","name":"DataSensor6","func":"date = global.get(\"gDate\");\ntime = global.get(\"gTime\");\n\n// DATA table\ncrop=global.get(\"crop\");\ntrial=global.get(\"trial\");\nlocation=global.get(\"location\");\nauthor=global.get(\"author\");\nemail=global.get(\"email\");\nphone=global.get(\"phone\");\n\n//Sensor\nsensor=\"sensor6\";\ntemp=global.get(\"temp6\");\nhum=global.get(\"hum6\");\ndew=global.get(\"dew6\");\n//Alerts\ntempalert=global.get(\"tempalert\");\nhumalert=global.get(\"humalert\");\n\nfref=global.get(\"fRef\");\n\nquery = \"INSERT INTO DATA (DATE,TIME,CROP,TRIAL,LOCATION,AUTHOR,EMAIL,PHONE,SENSOR,TEMPERATURE,HUMIDITY,DEWPOINT,TEMPALERT,HUMALERT,TREF)\";\nquery = query + \"VALUES ('\" + date + \"','\" + time + \"','\" + crop + \"','\" + trial + \"','\" + location + \"','\" + author + \"','\" + email + \"','\" + phone + \"','\";\nquery = query + sensor + \"','\" + temp + \"','\" + hum + \"','\" + dew + \"','\";\nquery = query + tempalert + \"','\" + humalert + \"','\" + fref + \"');\";\n\n//ID int auto_increment,DATE varchar(255),TIME varchar(255),CROP varchar(255),TRIAL varchar(255),LOCATION varchar(255),AUTHOR varchar(255),EMAIL varchar(255),PHONE INT,SENSOR varchar(255),TEMPERATURE double,HUMIDITY double,DEWPOINT double,TEMPALERT double,HUMALERT double,TREF double,primary key(ID)\n\n\ncsv = (`${date}, ${time}, ${sensor}, ${temp}, ${hum}, ${dew}, ${tempalert}, ${humalert}, ${fref}`);\n//if(status==\"ACTIVE\"){\n//    msg1 = {topic : query, payload: csv};\n//    return msg1;\n//}else{\n    //return null;\n    msg1 = {topic : query, payload: csv};\n    return msg1;\n//}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2290,"y":2420,"wires":[["4e81bae3.0e1ac4","d6e54600.11f788"]]},{"id":"e0004a10.b1c948","type":"function","z":"9bcfa612.592b38","name":"DataSensor7","func":"date = global.get(\"gDate\");\ntime = global.get(\"gTime\");\n\n// DATA table\ncrop=global.get(\"crop\");\ntrial=global.get(\"trial\");\nlocation=global.get(\"location\");\nauthor=global.get(\"author\");\nemail=global.get(\"email\");\nphone=global.get(\"phone\");\n\n//Sensor\nsensor=\"sensor7\";\ntemp=global.get(\"temp7\");\nhum=global.get(\"hum7\");\ndew=global.get(\"dew7\");\n//Alerts\ntempalert=global.get(\"tempalert\");\nhumalert=global.get(\"humalert\");\n\nfref=global.get(\"fRef\");\n\nquery = \"INSERT INTO DATA (DATE,TIME,CROP,TRIAL,LOCATION,AUTHOR,EMAIL,PHONE,SENSOR,TEMPERATURE,HUMIDITY,DEWPOINT,TEMPALERT,HUMALERT,TREF)\";\nquery = query + \"VALUES ('\" + date + \"','\" + time + \"','\" + crop + \"','\" + trial + \"','\" + location + \"','\" + author + \"','\" + email + \"','\" + phone + \"','\";\nquery = query + sensor + \"','\" + temp + \"','\" + hum + \"','\" + dew + \"','\";\nquery = query + tempalert + \"','\" + humalert + \"','\" + fref + \"');\";\n\n//ID int auto_increment,DATE varchar(255),TIME varchar(255),CROP varchar(255),TRIAL varchar(255),LOCATION varchar(255),AUTHOR varchar(255),EMAIL varchar(255),PHONE INT,SENSOR varchar(255),TEMPERATURE double,HUMIDITY double,DEWPOINT double,TEMPALERT double,HUMALERT double,TREF double,primary key(ID)\n\n\ncsv = (`${date}, ${time}, ${sensor}, ${temp}, ${hum}, ${dew}, ${tempalert}, ${humalert}, ${fref}`);\n//if(status==\"ACTIVE\"){\n//    msg1 = {topic : query, payload: csv};\n//    return msg1;\n//}else{\n    //return null;\n    msg1 = {topic : query, payload: csv};\n    return msg1;\n//}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2290,"y":2460,"wires":[["d6e54600.11f788","4e81bae3.0e1ac4"]]},{"id":"5d4b7a6d.690014","type":"function","z":"9bcfa612.592b38","name":"DataSensor8","func":"date = global.get(\"gDate\");\ntime = global.get(\"gTime\");\n\n// DATA table\ncrop=global.get(\"crop\");\ntrial=global.get(\"trial\");\nlocation=global.get(\"location\");\nauthor=global.get(\"author\");\nemail=global.get(\"email\");\nphone=global.get(\"phone\");\n\n//Sensor\nsensor=\"sensor8\";\ntemp=global.get(\"temp8\");\nhum=global.get(\"hum8\");\ndew=global.get(\"dew8\");\n//Alerts\ntempalert=global.get(\"tempalert\");\nhumalert=global.get(\"humalert\");\n\nfref=global.get(\"fRef\");\n\nquery = \"INSERT INTO DATA (DATE,TIME,CROP,TRIAL,LOCATION,AUTHOR,EMAIL,PHONE,SENSOR,TEMPERATURE,HUMIDITY,DEWPOINT,TEMPALERT,HUMALERT,TREF)\";\nquery = query + \"VALUES ('\" + date + \"','\" + time + \"','\" + crop + \"','\" + trial + \"','\" + location + \"','\" + author + \"','\" + email + \"','\" + phone + \"','\";\nquery = query + sensor + \"','\" + temp + \"','\" + hum + \"','\" + dew + \"','\";\nquery = query + tempalert + \"','\" + humalert + \"','\" + fref + \"');\";\n\n//ID int auto_increment,DATE varchar(255),TIME varchar(255),CROP varchar(255),TRIAL varchar(255),LOCATION varchar(255),AUTHOR varchar(255),EMAIL varchar(255),PHONE INT,SENSOR varchar(255),TEMPERATURE double,HUMIDITY double,DEWPOINT double,TEMPALERT double,HUMALERT double,TREF double,primary key(ID)\n\n\ncsv = (`${date}, ${time}, ${sensor}, ${temp}, ${hum}, ${dew}, ${tempalert}, ${humalert}, ${fref}`);\n//if(status==\"ACTIVE\"){\n//    msg1 = {topic : query, payload: csv};\n//    return msg1;\n//}else{\n    //return null;\n    msg1 = {topic : query, payload: csv};\n    return msg1;\n//}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2290,"y":2500,"wires":[["d6e54600.11f788","4e81bae3.0e1ac4"]]},{"id":"2b6a732d.16d14c","type":"function","z":"9bcfa612.592b38","name":"DataSensor9","func":"date = global.get(\"gDate\");\ntime = global.get(\"gTime\");\n\n// DATA table\ncrop=global.get(\"crop\");\ntrial=global.get(\"trial\");\nlocation=global.get(\"location\");\nauthor=global.get(\"author\");\nemail=global.get(\"email\");\nphone=global.get(\"phone\");\n\n//Sensor\nsensor=\"sensor9\";\ntemp=global.get(\"temp9\");\nhum=global.get(\"hum9\");\ndew=global.get(\"dew9\");\n//Alerts\ntempalert=global.get(\"tempalert\");\nhumalert=global.get(\"humalert\");\n\nfref=global.get(\"fRef\");\n\nquery = \"INSERT INTO DATA (DATE,TIME,CROP,TRIAL,LOCATION,AUTHOR,EMAIL,PHONE,SENSOR,TEMPERATURE,HUMIDITY,DEWPOINT,TEMPALERT,HUMALERT,TREF)\";\nquery = query + \"VALUES ('\" + date + \"','\" + time + \"','\" + crop + \"','\" + trial + \"','\" + location + \"','\" + author + \"','\" + email + \"','\" + phone + \"','\";\nquery = query + sensor + \"','\" + temp + \"','\" + hum + \"','\" + dew + \"','\";\nquery = query + tempalert + \"','\" + humalert + \"','\" + fref + \"');\";\n\n//ID int auto_increment,DATE varchar(255),TIME varchar(255),CROP varchar(255),TRIAL varchar(255),LOCATION varchar(255),AUTHOR varchar(255),EMAIL varchar(255),PHONE INT,SENSOR varchar(255),TEMPERATURE double,HUMIDITY double,DEWPOINT double,TEMPALERT double,HUMALERT double,TREF double,primary key(ID)\n\n\ncsv = (`${date}, ${time}, ${sensor}, ${temp}, ${hum}, ${dew}, ${tempalert}, ${humalert}, ${fref}`);\n//if(status==\"ACTIVE\"){\n//    msg1 = {topic : query, payload: csv};\n//    return msg1;\n//}else{\n    //return null;\n    msg1 = {topic : query, payload: csv};\n    return msg1;\n//}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2290,"y":2540,"wires":[["d6e54600.11f788","4e81bae3.0e1ac4"]]},{"id":"56aa47d0.f63e08","type":"ui_toast","z":"3bde78f1.198038","position":"dialog","displayTime":"3","highlight":"","sendall":false,"outputs":1,"ok":"START","cancel":"Cancel","raw":false,"topic":"Trial","name":"start","x":2630,"y":2200,"wires":[["592ef4bf.9aebac"]]},{"id":"2f2fe06d.eaf9e","type":"ui_button","z":"3bde78f1.198038","name":"STOP","group":"9f64fbcf.734d68","order":3,"width":3,"height":1,"passthru":false,"label":"STOP","tooltip":"","color":"white","bgcolor":"#FF0000","icon":"","payload":"","payloadType":"str","topic":"stop","x":2230,"y":2280,"wires":[["5e0e2edf.6b822"]]},{"id":"297b1aa2.d38886","type":"ui_toast","z":"3bde78f1.198038","position":"dialog","displayTime":"3","highlight":"","sendall":false,"outputs":1,"ok":"STOP","cancel":"Cancel","raw":false,"topic":"Trial","name":"stop","x":2630,"y":2260,"wires":[["592ef4bf.9aebac"]]},{"id":"592ef4bf.9aebac","type":"function","z":"3bde78f1.198038","name":"Active/Inactive","func":"if (msg.topic == \"Trial\"){\n    if (msg.payload == \"START\") {\n        global.set(\"status\",\"ACTIVE\");\n        msg1={payload: \"ACTIVE\"};\n        return msg1;\n    }\n    else if (msg.payload == \"STOP\") {\n        global.set(\"status\",\"INACTIVE\");\n        msg1 = {payload:\"STOP\"};\n        return msg1;\n    }\n    else if (msg.payload == \"UPDATE\"){\n        msg1 = {payload:\"UPDATE\"};\n        return msg1;\n    }\n    else{\n        return null;\n    }\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2860,"y":2260,"wires":[["1c968cda.6a1f63","8d587392.32f9e"]]},{"id":"1c968cda.6a1f63","type":"ui_text","z":"3bde78f1.198038","group":"9f64fbcf.734d68","order":1,"width":0,"height":0,"name":"","label":"STATUS","format":"{{msg.payload}}","layout":"row-spread","x":3060,"y":2100,"wires":[]},{"id":"8d587392.32f9e","type":"link out","z":"3bde78f1.198038","name":"run_out","links":["10f4e254.0ee3ee","2f37f722.97e788","3ea91051.c50d5","609c3bd5.1090e4","9b051ee5.0d1a5","c489a58f.9716f8","c48b32f3.8e227","cf76bb74.064588","d2f8c6b3.84e048","d75f9df0.7c154","cc155cf8.7b766","fcd9c10f.c812e","4b1eca11.815424","cd340f42.2fb09","f488bbe6.fc7dd8","9e8658dd.a2f188","511ef2d3.67c82c","5be58081.f4728","18138449.dec3dc","bcecb70.8a47748","eff60df8.66a05","670fd907.07cb88","6f834a23.bc5a84","55116620.505df8","c4893e09.8ebc7","a63c8ed.f7b3d7"],"x":3015,"y":2260,"wires":[]},{"id":"c5a293c.1ce337","type":"ui_button","z":"3bde78f1.198038","name":"START","group":"9f64fbcf.734d68","order":2,"width":3,"height":1,"passthru":false,"label":"START","tooltip":"","color":"white","bgcolor":"Green","icon":"","payload":"","payloadType":"str","topic":"start","x":2240,"y":2200,"wires":[["8f53dd93.b1158"]]},{"id":"9fec2f4c.d12f2","type":"ui_button","z":"3bde78f1.198038","name":"UPDATE","group":"9f64fbcf.734d68","order":4,"width":6,"height":1,"passthru":false,"label":"UPDATE CHANGES","tooltip":"","color":"white","bgcolor":"purple","icon":"","payload":"","payloadType":"str","topic":"update","x":2240,"y":2360,"wires":[["b07ed2f2.9c8dc"]]},{"id":"1fcc0ad.4aa97f5","type":"ui_toast","z":"3bde78f1.198038","position":"dialog","displayTime":"3","highlight":"","sendall":true,"outputs":1,"ok":"UPDATE","cancel":"CANCEL","raw":false,"topic":"Trial","name":"update","x":2630,"y":2360,"wires":[["592ef4bf.9aebac"]]},{"id":"18c05450.e810bc","type":"function","z":"3bde78f1.198038","name":"update status","func":"status=global.get(\"status\");\nmsg1 = {payload: status};\nreturn msg1;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2440,"y":2100,"wires":[["1c968cda.6a1f63","5c7b1a5c.fe6e24"]]},{"id":"609c3bd5.1090e4","type":"link in","z":"3bde78f1.198038","name":"irri_in","links":["7879f6e7.cb8fb8","8d587392.32f9e"],"x":2195,"y":2100,"wires":[["18c05450.e810bc"]]},{"id":"8f53dd93.b1158","type":"function","z":"3bde78f1.198038","name":"Check Fields","func":"//INFO table\ncrop=global.get(\"crop\");\ntrial=global.get(\"trial\");\nlocation=global.get(\"location\");\nauthor=global.get(\"author\");\nemail=global.get(\"email\");\nphone=global.get(\"phone\");\n// DATA table\n\n/*\nfRef=global.get(\"fRef\");\n*/\n//\ntempalert=global.get(\"tempalert\");\nhumalert=global.get(\"humalert\");\n\nif (msg.topic == \"start\"){\n    if (trial.length!==0 &&\n        location.length!==0 &&\n        author.length!==0 &&\n        email.length!==0 &&\n        tempalert.length!==0 &&\n        humalert.length!==0)\n        {\n        msg1 = {payload : \"Really start new trial?\"};\n        return [null,msg1];\n            \n    }else{\n        msg1 = {payload : \"Can not be start. Please check empty fields\"};\n        return [msg1,null];\n    }\n}","outputs":2,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2430,"y":2200,"wires":[["be3923fe.bd11"],["56aa47d0.f63e08"]]},{"id":"be3923fe.bd11","type":"ui_toast","z":"3bde78f1.198038","position":"dialog","displayTime":"3","highlight":"","sendall":true,"outputs":1,"ok":"OK","cancel":"","raw":false,"topic":"","name":"","x":2650,"y":2160,"wires":[[]]},{"id":"5e0e2edf.6b822","type":"function","z":"3bde78f1.198038","name":"Check Active","func":"var status = global.get(\"status\");\n\nif (msg.topic == \"stop\"){\n    if (status==\"ACTIVE\"){\n        msg1 = {payload : \"Really stop trial?\"};\n        return [msg1,null];\n    }else{\n        msg1 = {payload : \"Process not initiliazed\"};\n        return [null,msg1];\n    }\n}","outputs":2,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2430,"y":2280,"wires":[["297b1aa2.d38886"],["97561eef.2b716"]]},{"id":"97561eef.2b716","type":"ui_toast","z":"3bde78f1.198038","position":"dialog","displayTime":"3","highlight":"","sendall":true,"outputs":1,"ok":"OK","cancel":"","raw":false,"topic":"","name":"","x":2650,"y":2300,"wires":[[]]},{"id":"b07ed2f2.9c8dc","type":"function","z":"3bde78f1.198038","name":"Check Active","func":"status = global.get(\"status\");\n//INFO table\ncrop=global.get(\"crop\");\ntrial=global.get(\"trial\");\nlocation=global.get(\"location\");\nauthor=global.get(\"author\");\nemail=global.get(\"email\");\nphone=global.get(\"phone\");\n\n//\ntempalert=global.get(\"tempalert\");\nhumalert=global.get(\"humalert\");\n\nif (msg.topic == \"update\" && status==\"ACTIVE\"){\n    if (trial.length!==0 &&\n        location.length!==0 &&\n        author.length!==0 &&\n        email.length!==0 &&\n        tempalert.length!==0 &&\n        humalert.length!==0){\n\n        msg1 = {payload : \"Really update changes\"};\n        return [msg1,null];\n    }else{\n        msg1 = {payload : \"Can not be update. Please check empty fields\"};\n        return [null,msg1];\n    }\n}","outputs":2,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2430,"y":2360,"wires":[["1fcc0ad.4aa97f5"],["817c094d.2831c8"]]},{"id":"817c094d.2831c8","type":"ui_toast","z":"3bde78f1.198038","position":"dialog","displayTime":"3","highlight":"","sendall":true,"outputs":1,"ok":"OK","cancel":"","raw":false,"topic":"","name":"","x":2650,"y":2400,"wires":[[]]},{"id":"5c7b1a5c.fe6e24","type":"function","z":"3bde78f1.198038","name":"button state","func":"status=global.get(\"status\");\nif (status==\"ACTIVE\"){\n    msg1={enabled: false, background: \"transparent\"}\n    msg2={enabled: true}\n    msg3={enabled: true}\n    return [msg1,msg2,msg3];\n}else{\n    msg1={enabled: true}\n    msg2={enabled: false, background: \"transparent\"}\n    msg3={enabled: false, background: \"transparent\"}\n    return [msg1,msg2,msg3];\n}","outputs":3,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2050,"y":2280,"wires":[["c5a293c.1ce337"],["2f2fe06d.eaf9e"],["9fec2f4c.d12f2"]]},{"id":"8f7ca0c8.28119","type":"inject","z":"3bde78f1.198038","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":true,"onceDelay":"1","topic":"","payload":"","payloadType":"date","x":2050,"y":2340,"wires":[["5c7b1a5c.fe6e24"]]},{"id":"fd9525.1e305ad8","type":"ui_toast","z":"359ed2dc.ceea6e","position":"top right","displayTime":"3","highlight":"","sendall":true,"outputs":0,"ok":"OK","cancel":"","raw":false,"topic":"","name":"","x":2530,"y":1880,"wires":[]},{"id":"635aac44.e40c64","type":"inject","z":"fd37fbb3.4259f8","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":true,"onceDelay":0.1,"topic":"","payload":"{\"Time\":\"2021-04-06T20:24:15\",\"SI7021\":{\"Temperature\":31,\"Humidity\":40,\"DewPoint\":20},\"TempUnit\":\"C\"}","payloadType":"str","x":1210,"y":1900,"wires":[["d7ef21d6.2ff41","fafcac7.f43ed5","9fd69143.b0cb8","ff76d941.946df8","49995189.0e516","8d743407.a2ee68","a49a6f41.1fb0e","a1f54f09.fbcb1","1b49f683.af82f9","7ad42aeb.379044","d634139b.19a57","4917fd6d.ff3c04","2bef088c.79aac8","d6c9dc0c.1278c","7b4e94a.74da36c","7c3ae785.daf358","af824f5f.4f7eb","22c41ed9.ab9732"]]},{"id":"15288358.88ce2d","type":"ui_text","z":"fd37fbb3.4259f8","group":"b1990e72.3758d","order":5,"width":8,"height":1,"name":"VPD_SENSOR","label":"VPD","format":"{{msg.payload}} ","layout":"col-center","x":2600,"y":1160,"wires":[]},{"id":"e71ee7a8.260ad8","type":"ui_chart","z":"fd37fbb3.4259f8","name":"VPD_SENSOR","group":"b1990e72.3758d","order":6,"width":8,"height":4,"label":"","chartType":"line","legend":"true","xformat":"HH:mm:ss","interpolate":"linear","nodata":"","dot":false,"ymin":"","ymax":"","removeOlder":"24","removeOlderPoints":"","removeOlderUnit":"3600","cutout":0,"useOneColor":false,"useUTC":false,"colors":["#2ca02c","#ec760d","#aec7e8","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"outputs":1,"useDifferentColor":false,"x":2600,"y":1200,"wires":[[]]},{"id":"ef149141.862d6","type":"ui_toast","z":"6862f897.ee8958","position":"top right","displayTime":"3","highlight":"","sendall":true,"outputs":0,"ok":"OK","cancel":"","raw":false,"topic":"","name":"","x":2750,"y":2180,"wires":[]},{"id":"b19d13da.8363d","type":"link out","z":"6862f897.ee8958","name":"Telegram_Alarms_out","links":["4b347fdf.2d68b"],"x":2675,"y":2220,"wires":[]},{"id":"a105c791.117138","type":"link out","z":"fd37fbb3.4259f8","name":"Email_Sensor_out","links":["b72eacf6.0c9bd"],"x":2495,"y":2120,"wires":[]},{"id":"3c2d6b43.48b534","type":"link out","z":"359ed2dc.ceea6e","name":"Email_Fan_out","links":["cc3204f0.a66dc8"],"x":2615,"y":2080,"wires":[]},{"id":"5a99e160.88d75","type":"inject","z":"359ed2dc.ceea6e","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"1","payloadType":"str","x":2910,"y":1820,"wires":[["a1409743.727978","66c79a0e.21e484","bad68f87.10b36","2e6a13e5.c8667c"]]},{"id":"c662ac93.97f5f","type":"inject","z":"359ed2dc.ceea6e","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":true,"onceDelay":0.1,"topic":"","payload":"0","payloadType":"str","x":2910,"y":1860,"wires":[["a1409743.727978","66c79a0e.21e484","bad68f87.10b36","2e6a13e5.c8667c"]]},{"id":"a1409743.727978","type":"rpi-gpio out","z":"359ed2dc.ceea6e","name":"","pin":"29","set":true,"level":"0","freq":"","out":"out","x":2960,"y":1960,"wires":[]},{"id":"192075ae.8daf6a","type":"e-mail","z":"9bcfa612.592b38","server":"ciatsmtp.ciat.cgiar.org","port":"25","secure":false,"tls":false,"name":"","dname":"","x":3050,"y":2300,"wires":[]},{"id":"5806bdba.aaad74","type":"function","z":"359ed2dc.ceea6e","name":"Get fref from user in dashboard","func":"//remember that fref1 is the temperature during the day\n//the day and nights limits can be change in \"fTime&fRef limits control\" node\nglobal.set(\"fRef1\",msg.payload); \nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2930,"y":2360,"wires":[["61755321.a2514c","4dad6333.f7efbc"]]},{"id":"acdc9535.b56728","type":"ui_text_input","z":"359ed2dc.ceea6e","name":"","label":"TempRef1 (°C)","tooltip":"","group":"b6dea28f.35559","order":2,"width":6,"height":1,"passthru":true,"mode":"number","delay":"0","topic":"fRef1","x":2700,"y":2360,"wires":[["5806bdba.aaad74"]]},{"id":"de9a6377.1a422","type":"function","z":"359ed2dc.ceea6e","name":"Get fref from user in dashboard","func":"//remember that fref2 is the temperature for stteping the temperature\n//change rate and not affect the plants with direct changes\n//the day and nights limits can be change in \"fTime&fRef limits control\" node\n\nglobal.set(\"fRef2\",msg.payload); \nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2930,"y":2400,"wires":[["4654970f.a6bfc8","4dad6333.f7efbc"]]},{"id":"a354006d.fe73b","type":"ui_text_input","z":"359ed2dc.ceea6e","name":"","label":"TempRef2 (°C)","tooltip":"","group":"b6dea28f.35559","order":3,"width":6,"height":1,"passthru":true,"mode":"number","delay":"0","topic":"fRef","x":2700,"y":2400,"wires":[["de9a6377.1a422"]]},{"id":"6f696e37.25155","type":"function","z":"359ed2dc.ceea6e","name":"Get fref from user in dashboard","func":"//remember that fref3 is the temperature during the night\n//the day and nights limits can be change in \"fTime&fRef limits control\" node\n\nglobal.set(\"fRef3\",msg.payload); \nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2930,"y":2440,"wires":[["e0cf878f.fbd0b8","4dad6333.f7efbc"]]},{"id":"ae3de619.136ef8","type":"ui_text_input","z":"359ed2dc.ceea6e","name":"","label":"TempRef3 (°C)","tooltip":"","group":"b6dea28f.35559","order":4,"width":6,"height":1,"passthru":true,"mode":"number","delay":"0","topic":"fRef3","x":2700,"y":2440,"wires":[["6f696e37.25155"]]},{"id":"61755321.a2514c","type":"ui_text","z":"359ed2dc.ceea6e","group":"b6dea28f.35559","order":5,"width":0,"height":0,"name":"fRef1","label":"07:00-18:00 (TempRef1)","format":"{{msg.payload}}","layout":"row-spread","x":3150,"y":2360,"wires":[]},{"id":"4654970f.a6bfc8","type":"ui_text","z":"359ed2dc.ceea6e","group":"b6dea28f.35559","order":6,"width":0,"height":0,"name":"fRef2","label":"18:00-19:30, 06:00-07:00 (TempRef2)","format":"{{msg.payload}}","layout":"row-spread","x":3150,"y":2400,"wires":[]},{"id":"e0cf878f.fbd0b8","type":"ui_text","z":"359ed2dc.ceea6e","group":"b6dea28f.35559","order":7,"width":0,"height":0,"name":"fRef3","label":"19:30-06:00 (TempRef3)","format":"{{msg.payload}}","layout":"row-spread","x":3150,"y":2440,"wires":[]},{"id":"2e1b4283.3f9b2e","type":"inject","z":"359ed2dc.ceea6e","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":true,"onceDelay":0.1,"topic":"","payload":"OFF","payloadType":"str","x":2450,"y":1980,"wires":[[]]},{"id":"3c0a9ff8.25fc4","type":"function","z":"9bcfa612.592b38","name":"Data Sensor Average","func":"date = global.get(\"gDate\");\ntime = global.get(\"gTime\");\n\n// DATA table\ncrop=global.get(\"crop\");\ntrial=global.get(\"trial\");\nlocation=global.get(\"location\");\nauthor=global.get(\"author\");\nemail=global.get(\"email\");\nphone=global.get(\"phone\");\n\n//Sensor\nsensor=\"sensoravg\";\ntemp=global.get(\"tempAvg\");\nhum=global.get(\"humAvg\");\ndew=global.get(\"dewAvg\");\n//Alerts\ntempalert=global.get(\"tempalert\");\nhumalert=global.get(\"humalert\");\n\nfref=global.get(\"fRef\");\n\nquery = \"INSERT INTO DATA (DATE,TIME,CROP,TRIAL,LOCATION,AUTHOR,EMAIL,PHONE,SENSOR,TEMPERATURE,HUMIDITY,DEWPOINT,TEMPALERT,HUMALERT,TREF)\";\nquery = query + \"VALUES ('\" + date + \"','\" + time + \"','\" + crop + \"','\" + trial + \"','\" + location + \"','\" + author + \"','\" + email + \"','\" + phone + \"','\";\nquery = query + sensor + \"','\" + temp + \"','\" + hum + \"','\" + dew + \"','\";\nquery = query + tempalert + \"','\" + humalert + \"','\" + fref + \"');\";\n\n//ID int auto_increment,DATE varchar(255),TIME varchar(255),CROP varchar(255),TRIAL varchar(255),LOCATION varchar(255),AUTHOR varchar(255),EMAIL varchar(255),PHONE INT,SENSOR varchar(255),TEMPERATURE double,HUMIDITY double,DEWPOINT double,TEMPALERT double,HUMALERT double,TREF double,primary key(ID)\n\n\ncsv = (`${date}, ${time}, ${sensor}, ${temp}, ${hum}, ${dew}, ${tempalert}, ${humalert}, ${fref}`);\n//if(status==\"ACTIVE\"){\n//    msg1 = {topic : query, payload: csv};\n//    return msg1;\n//}else{\n    //return null;\n    msg1 = {topic : query, payload: csv};\n    return msg1;\n//}\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2320,"y":2580,"wires":[["4e81bae3.0e1ac4","d6e54600.11f788"]]},{"id":"e494b7e.0037e48","type":"link out","z":"359ed2dc.ceea6e","name":"Telegram_Fan_out","links":["708fb6c.656f248"],"x":2655,"y":2100,"wires":[]},{"id":"f55ad63b.5888a","type":"debug","z":"9bcfa612.592b38","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":2910,"y":1940,"wires":[]},{"id":"b1242d42.93bef","type":"function","z":"9bcfa612.592b38","name":"","func":"msg3={payload: {    \n    //uncomment and add telegram node if you want to send it \n    //\"chatId\":,\n    \"type\": \"message\",\n    \"content\": \"Hello World\"}\n}\nreturn msg3;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2700,"y":1980,"wires":[["f55ad63b.5888a"]]},{"id":"1a603a5a.1a7476","type":"inject","z":"9bcfa612.592b38","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":2550,"y":1980,"wires":[["b1242d42.93bef"]]},{"id":"7ade7b6c.ee0904","type":"link out","z":"fd37fbb3.4259f8","name":"Telegram_Sensor_out","links":["818887eb.6ef47"],"x":2495,"y":1940,"wires":[]},{"id":"84df133f.c2574","type":"comment","z":"fd37fbb3.4259f8","name":"SENSOR13","info":"","x":3130,"y":1700,"wires":[]},{"id":"e02418d6.a31848","type":"function","z":"fd37fbb3.4259f8","name":"Sensor13Data","func":"payload=msg.payload;\nn=payload.includes(\"Temperature\");\nlocation=global.get(\"location\");\nemail=global.get(\"email\");\nd=global.get(\"gDateTime\");\n\nif(n === true){\ntemp = JSON.parse(payload).SI7021.Temperature;\nhum = JSON.parse(payload).SI7021.Humidity;\ndew = JSON.parse(payload).SI7021.DewPoint;\n}else{temp =0;hum =0;dew=0;}\n\nif (n!==false && temp!==null){\n    //temp = JSON.parse(payload).SI7021.Temperature;\n    //hum = JSON.parse(payload).SI7021.Humidity;\n    //dew = JSON.parse(payload).SI7021.DewPoint;\n    //if(temp!==null){\n        global.set(\"temp13\",temp);\n        global.set(\"hum13\",hum);\n        global.set(\"dew13\",dew);\n        global.set(\"s13Flag\", false);\n        \n        msg1 = {topic: \"Temperature13\", payload: temp};\n        msg2 = {topic: \"Humidity13\", payload: hum};\n        \n        return [msg1,msg2,null,null];\n    //}\n}else if (payload==\"sensor13Fail\" || temp===null){\n    global.set(\"s13Flag\", true);\n    //global.set(\"temp13\",30);\n    //global.set(\"hum13\",0);\n    global.set(\"dew13\",0);\n    msg1 = {//from : \"noreply@gmail.com\",\n            to : email, \n            cc: global.get(\"ccEmail\"), \n            bcc: global.get(\"bccEmail\"), \n            topic : location + \": Sensor Fail\", \n            payload : \"Reading Failed!. Sensor 13 offline.\",\n            text: location+ \": Reading Failed!. Sensor 13 offline. \"+d\n    };\n    msg2={payload:{\n        //uncomment if you want send telegram message\n        //\"chatId\": \"your telegram chatId number must be integer\",\n        \"type\": \"message\",\n        \"content\": location+ \": Reading Failed!. Sensor 13 offline. \"+d}\n    };\n    return [null,null,msg1,msg2];\n}else{\n    return null;\n}","outputs":4,"noerr":0,"initialize":"","finalize":"","libs":[],"x":3120,"y":1740,"wires":[["c95a1d11.8d0cf","3ade866d.eac8ba"],["6b7d5808.795298","be9f7999.fa62a8"],["412197f6.1b6308","d69bfbd2.b2f3c8"],["fa32aedb.16df7"]]},{"id":"c95a1d11.8d0cf","type":"ui_text","z":"fd37fbb3.4259f8","group":"c32e4918.a723a8","order":13,"width":2,"height":1,"name":"T_SENSOR13","label":"T13","format":"{{msg.payload}} °C","layout":"col-center","x":3340,"y":1700,"wires":[]},{"id":"6b7d5808.795298","type":"ui_text","z":"fd37fbb3.4259f8","group":"c32e4918.a723a8","order":29,"width":2,"height":1,"name":"H_SENSOR13","label":"H13","format":"{{msg.payload}} %","layout":"col-center","x":3340,"y":1780,"wires":[]},{"id":"eb72ec92.c07e2","type":"comment","z":"fd37fbb3.4259f8","name":"SENSOR14","info":"","x":3130,"y":1820,"wires":[]},{"id":"993f81b6.d3e13","type":"function","z":"fd37fbb3.4259f8","name":"Sensor14Data","func":"payload=msg.payload;\nn=payload.includes(\"Temperature\");\nlocation=global.get(\"location\");\nemail=global.get(\"email\");\nd=global.get(\"gDateTime\");\n\nif(n === true){\ntemp = JSON.parse(payload).SI7021.Temperature;\nhum = JSON.parse(payload).SI7021.Humidity;\ndew = JSON.parse(payload).SI7021.DewPoint;\n}else{temp =0;hum =0;dew=0;}\n\nif (n!==false && temp!==null){\n    //temp = JSON.parse(payload).SI7021.Temperature;\n    //hum = JSON.parse(payload).SI7021.Humidity;\n    //dew = JSON.parse(payload).SI7021.DewPoint;\n    //if(temp!==null){\n        global.set(\"temp14\",temp);\n        global.set(\"hum14\",hum);\n        global.set(\"dew14\",dew);\n        global.set(\"s14Flag\", false);\n        \n        msg1 = {topic: \"Temperature14\", payload: temp};\n        msg2 = {topic: \"Humidity14\", payload: hum};\n        \n        return [msg1,msg2,null,null];\n    //}\n}else if (payload==\"sensor14Fail\" || temp===null){\n    global.set(\"s14Flag\", true);\n    //global.set(\"temp14\",30);\n    //global.set(\"hum14\",0);\n    global.set(\"dew14\",0);\n    msg1 = {//from : \"noreply@gmail.com\",\n            to : email, \n            cc: global.get(\"ccEmail\"), \n            bcc: global.get(\"bccEmail\"), \n            topic : location + \": Sensor Fail\", \n            payload : \"Reading Failed!. Sensor 14 offline.\",\n            text: location+ \": Reading Failed!. Sensor 14 offline. \"+d\n    };\n    msg2={payload:{\n        //uncomment if you want send telegram message\n        //\"chatId\": \"your telegram chatId number must be integer\",\n        \"type\": \"message\",\n        \"content\": location+ \": Reading Failed!. Sensor 14 offline. \"+d}\n    };\n    return [null,null,msg1,msg2];\n}else{\n    return null;\n}","outputs":4,"noerr":0,"initialize":"","finalize":"","libs":[],"x":3120,"y":1860,"wires":[["fc35a9e4.dbfe78","3ade866d.eac8ba"],["be3639ab.0ceae8","be9f7999.fa62a8"],["412197f6.1b6308","d69bfbd2.b2f3c8"],["fa32aedb.16df7"]]},{"id":"fc35a9e4.dbfe78","type":"ui_text","z":"fd37fbb3.4259f8","group":"c32e4918.a723a8","order":8,"width":2,"height":1,"name":"T_SENSOR14","label":"T14","format":"{{msg.payload}} °C","layout":"col-center","x":3340,"y":1820,"wires":[]},{"id":"be3639ab.0ceae8","type":"ui_text","z":"fd37fbb3.4259f8","group":"c32e4918.a723a8","order":24,"width":2,"height":1,"name":"H_SENSOR14","label":"H14","format":"{{msg.payload}} %","layout":"col-center","x":3340,"y":1900,"wires":[]},{"id":"21f6a4c8.c8349c","type":"comment","z":"fd37fbb3.4259f8","name":"SENSOR15","info":"","x":3130,"y":1940,"wires":[]},{"id":"b325ac7c.02b56","type":"function","z":"fd37fbb3.4259f8","name":"Sensor15Data","func":"payload=msg.payload;\nn=payload.includes(\"Temperature\");\nlocation=global.get(\"location\");\nemail=global.get(\"email\");\nd=global.get(\"gDateTime\");\n\nif(n === true){\ntemp = JSON.parse(payload).SI7021.Temperature;\nhum = JSON.parse(payload).SI7021.Humidity;\ndew = JSON.parse(payload).SI7021.DewPoint;\n}else{temp =0;hum =0;dew=0;}\n\nif (n!==false && temp!==null){\n    //temp = JSON.parse(payload).SI7021.Temperature;\n    //hum = JSON.parse(payload).SI7021.Humidity;\n    //dew = JSON.parse(payload).SI7021.DewPoint;\n    //if(temp!==null){\n        global.set(\"temp15\",temp);\n        global.set(\"hum15\",hum);\n        global.set(\"dew15\",dew);\n        global.set(\"s15Flag\", false);\n        \n        msg1 = {topic: \"Temperature15\", payload: temp};\n        msg2 = {topic: \"Humidity15\", payload: hum};\n        \n        return [msg1,msg2,null,null];\n    //}\n}else if (payload==\"sensor15Fail\" || temp===null){\n    global.set(\"s15Flag\", true);\n    //global.set(\"temp15\",30);\n    //global.set(\"hum15\",0);\n    global.set(\"dew15\",0);\n    msg1 = {//from : \"noreply@gmail.com\",\n            to : email, \n            cc: global.get(\"ccEmail\"), \n            bcc: global.get(\"bccEmail\"), \n            topic : location + \": Sensor Fail\", \n            payload : \"Reading Failed!. Sensor 15 offline.\",\n            text: location+ \": Reading Failed!. Sensor 15 offline. \"+d\n    };\n    msg2={payload:{\n        //uncomment if you want send telegram message\n        //\"chatId\": \"your telegram chatId number must be integer\",\n        \"type\": \"message\",\n        \"content\": location+ \": Reading Failed!. Sensor 15 offline. \"+d}\n    };\n    return [null,null,msg1,msg2];\n}else{\n    return null;\n}","outputs":4,"noerr":0,"initialize":"","finalize":"","libs":[],"x":3120,"y":1980,"wires":[["1688bb8a.ec34e4","3ade866d.eac8ba"],["64209024.a43ff","be9f7999.fa62a8"],["412197f6.1b6308","d69bfbd2.b2f3c8"],["fa32aedb.16df7"]]},{"id":"1688bb8a.ec34e4","type":"ui_text","z":"fd37fbb3.4259f8","group":"c32e4918.a723a8","order":3,"width":2,"height":1,"name":"T_SENSOR15","label":"T15","format":"{{msg.payload}} °C","layout":"col-center","x":3340,"y":1940,"wires":[]},{"id":"64209024.a43ff","type":"ui_text","z":"fd37fbb3.4259f8","group":"c32e4918.a723a8","order":19,"width":2,"height":1,"name":"H_SENSOR15","label":"H15","format":"{{msg.payload}} %","layout":"col-center","x":3340,"y":2020,"wires":[]},{"id":"6c5ad644.ee14e8","type":"function","z":"fd37fbb3.4259f8","name":"Sensor10Data","func":"payload=msg.payload;\nn=payload.includes(\"Temperature\");\nlocation=global.get(\"location\");\nemail=global.get(\"email\");\nd=global.get(\"gDateTime\");\n\nif(n === true){\ntemp = JSON.parse(payload).SI7021.Temperature;\nhum = JSON.parse(payload).SI7021.Humidity;\ndew = JSON.parse(payload).SI7021.DewPoint;\n}else{temp =0;hum =0;dew=0;}\n\nif (n!==false && temp!==null){\n    //temp = JSON.parse(payload).SI7021.Temperature;\n    //hum = JSON.parse(payload).SI7021.Humidity;\n    //dew = JSON.parse(payload).SI7021.DewPoint;\n    //if(temp!==null){\n        global.set(\"temp10\",temp);\n        global.set(\"hum10\",hum);\n        global.set(\"dew10\",dew);\n        global.set(\"s10Flag\", false);\n        \n        msg1 = {topic: \"Temperature10\", payload: temp};\n        msg2 = {topic: \"Humidity10\", payload: hum};\n        \n        return [msg1,msg2,null,null];\n    //}\n}else if (payload==\"sensor10Fail\" || temp===null){\n    global.set(\"s10Flag\", true);\n    //global.set(\"temp10\",30);\n    //global.set(\"hum10\",0);\n    global.set(\"dew10\",0);\n    msg1 = {//from : \"noreply@gmail.com\",\n            to : email, \n            cc: global.get(\"ccEmail\"), \n            bcc: global.get(\"bccEmail\"), \n            topic : location + \": Sensor Fail\", \n            payload : \"Reading Failed!. Sensor 10 offline.\",\n            text: location+ \": Reading Failed!. Sensor 10 offline. \"+d\n    };\n    msg2={payload:{\n        //uncomment if you want send telegram message\n        //\"chatId\": \"your telegram chatId number must be integer\",\n        \"type\": \"message\",\n        \"content\": location+ \": Reading Failed!. Sensor 10 offline. \"+d}\n    };\n    return [null,null,msg1,msg2];\n}else{\n    return null;\n}","outputs":4,"noerr":0,"initialize":"","finalize":"","libs":[],"x":3120,"y":1360,"wires":[["dee04163.74bfd","3ade866d.eac8ba"],["2f91dbf.118c124","be9f7999.fa62a8"],["412197f6.1b6308","d69bfbd2.b2f3c8"],["fa32aedb.16df7"]]},{"id":"dee04163.74bfd","type":"ui_text","z":"fd37fbb3.4259f8","group":"c32e4918.a723a8","order":11,"width":2,"height":1,"name":"T_SENSOR10","label":"T10","format":"{{msg.payload}} °C","layout":"col-center","x":3340,"y":1320,"wires":[]},{"id":"2f91dbf.118c124","type":"ui_text","z":"fd37fbb3.4259f8","group":"c32e4918.a723a8","order":27,"width":2,"height":1,"name":"H_SENSOR10","label":"H10","format":"{{msg.payload}} %","layout":"col-center","x":3340,"y":1400,"wires":[]},{"id":"b63b7af.e9a7388","type":"comment","z":"fd37fbb3.4259f8","name":"SENSOR11","info":"","x":3130,"y":1440,"wires":[]},{"id":"3186b872.033fc8","type":"function","z":"fd37fbb3.4259f8","name":"Sensor11Data","func":"payload=msg.payload;\nn=payload.includes(\"Temperature\");\nlocation=global.get(\"location\");\nemail=global.get(\"email\");\nd=global.get(\"gDateTime\");\n\nif(n === true){\ntemp = JSON.parse(payload).SI7021.Temperature;\nhum = JSON.parse(payload).SI7021.Humidity;\ndew = JSON.parse(payload).SI7021.DewPoint;\n}else{temp =0;hum =0;dew=0;}\n\nif (n!==false && temp!==null){\n    //temp = JSON.parse(payload).SI7021.Temperature;\n    //hum = JSON.parse(payload).SI7021.Humidity;\n    //dew = JSON.parse(payload).SI7021.DewPoint;\n    //if(temp!==null){\n        global.set(\"temp11\",temp);\n        global.set(\"hum11\",hum);\n        global.set(\"dew11\",dew);\n        global.set(\"s11Flag\", false);\n        \n        msg1 = {topic: \"Temperature11\", payload: temp};\n        msg2 = {topic: \"Humidity11\", payload: hum};\n        \n        return [msg1,msg2,null,null];\n    //}\n}else if (payload==\"sensor11Fail\" || temp===null){\n    global.set(\"s11Flag\", true);\n    //global.set(\"temp11\",30);\n    //global.set(\"hum11\",0);\n    global.set(\"dew11\",0);\n    msg1 = {//from : \"noreply@gmail.com\",\n            to : email, \n            cc: global.get(\"ccEmail\"), \n            bcc: global.get(\"bccEmail\"), \n            topic : location + \": Sensor Fail\", \n            payload : \"Reading Failed!. Sensor 11 offline.\",\n            text: location+ \": Reading Failed!. Sensor 11 offline. \"+d\n    };\n    msg2={payload:{\n        //uncomment if you want send telegram message\n        //\"chatId\": \"your telegram chatId number must be integer\",\n        \"type\": \"message\",\n        \"content\": location+ \": Reading Failed!. Sensor 11 offline. \"+d}\n    };\n    return [null,null,msg1,msg2];\n}else{\n    return null;\n}","outputs":4,"noerr":0,"initialize":"","finalize":"","libs":[],"x":3120,"y":1480,"wires":[["54695c25.524a54","3ade866d.eac8ba"],["520ee2e4.64547c","be9f7999.fa62a8"],["412197f6.1b6308","d69bfbd2.b2f3c8"],["fa32aedb.16df7"]]},{"id":"54695c25.524a54","type":"ui_text","z":"fd37fbb3.4259f8","group":"c32e4918.a723a8","order":6,"width":2,"height":1,"name":"T_SENSOR11","label":"T11","format":"{{msg.payload}} °C","layout":"col-center","x":3340,"y":1440,"wires":[]},{"id":"520ee2e4.64547c","type":"ui_text","z":"fd37fbb3.4259f8","group":"c32e4918.a723a8","order":22,"width":2,"height":1,"name":"H_SENSOR11","label":"H11","format":"{{msg.payload}} %","layout":"col-center","x":3340,"y":1520,"wires":[]},{"id":"e70771c2.da90d","type":"comment","z":"fd37fbb3.4259f8","name":"SENSOR18","info":"","x":3150,"y":2300,"wires":[]},{"id":"97c3e4aa.374fb8","type":"function","z":"fd37fbb3.4259f8","name":"Sensor12Data","func":"payload=msg.payload;\nn=payload.includes(\"Temperature\");\nlocation=global.get(\"location\");\nemail=global.get(\"email\");\nd=global.get(\"gDateTime\");\n\nif(n === true){\ntemp = JSON.parse(payload).SI7021.Temperature;\nhum = JSON.parse(payload).SI7021.Humidity;\ndew = JSON.parse(payload).SI7021.DewPoint;\n}else{temp =0;hum =0;dew=0;}\n\nif (n!==false && temp!==null){\n    //temp = JSON.parse(payload).SI7021.Temperature;\n    //hum = JSON.parse(payload).SI7021.Humidity;\n    //dew = JSON.parse(payload).SI7021.DewPoint;\n    //if(temp!==null){\n        global.set(\"temp12\",temp);\n        global.set(\"hum12\",hum);\n        global.set(\"dew12\",dew);\n        global.set(\"s12Flag\", false);\n        \n        msg1 = {topic: \"Temperature12\", payload: temp};\n        msg2 = {topic: \"Humidity12\", payload: hum};\n        \n        return [msg1,msg2,null,null];\n    //}\n}else if (payload==\"sensor12Fail\" || temp===null){\n    global.set(\"s12Flag\", true);\n    //global.set(\"temp12\",30);\n    //global.set(\"hum12\",0);\n    global.set(\"dew12\",0);\n    msg1 = {//from : \"noreply@gmail.com\",\n            to : email, \n            cc: global.get(\"ccEmail\"), \n            bcc: global.get(\"bccEmail\"), \n            topic : location + \": Sensor Fail\", \n            payload : \"Reading Failed!. Sensor 12 offline.\",\n            text: location+ \": Reading Failed!. Sensor 12 offline. \"+d\n    };\n    msg2={payload:{\n        //uncomment if you want send telegram message\n        //\"chatId\": \"your telegram chatId number must be integer\",\n        \"type\": \"message\",\n        \"content\": location+ \": Reading Failed!. Sensor 12 offline. \"+d}\n    };\n    return [null,null,msg1,msg2];\n}else{\n    return null;\n}","outputs":4,"noerr":0,"initialize":"","finalize":"","libs":[],"x":3120,"y":1620,"wires":[["92dbe80.de01a18","3ade866d.eac8ba"],["815b5a53.5570c8","be9f7999.fa62a8"],["412197f6.1b6308","d69bfbd2.b2f3c8"],["fa32aedb.16df7"]]},{"id":"92dbe80.de01a18","type":"ui_text","z":"fd37fbb3.4259f8","group":"c32e4918.a723a8","order":1,"width":2,"height":1,"name":"T_SENSOR12","label":"T12","format":"{{msg.payload}} °C","layout":"col-center","x":3340,"y":1580,"wires":[]},{"id":"815b5a53.5570c8","type":"ui_text","z":"fd37fbb3.4259f8","group":"c32e4918.a723a8","order":17,"width":2,"height":1,"name":"H_SENSOR12","label":"H12","format":"{{msg.payload}} %","layout":"col-center","x":3340,"y":1660,"wires":[]},{"id":"f7e5d6aa.31efd8","type":"function","z":"fd37fbb3.4259f8","name":"Sensor16Data","func":"payload=msg.payload;\nn=payload.includes(\"Temperature\");\nlocation=global.get(\"location\");\nemail=global.get(\"email\");\nd=global.get(\"gDateTime\");\n\nif(n === true){\ntemp = JSON.parse(payload).SI7021.Temperature;\nhum = JSON.parse(payload).SI7021.Humidity;\ndew = JSON.parse(payload).SI7021.DewPoint;\n}else{temp =0;hum =0;dew=0;}\n\nif (n!==false && temp!==null){\n    //temp = JSON.parse(payload).SI7021.Temperature;\n    //hum = JSON.parse(payload).SI7021.Humidity;\n    //dew = JSON.parse(payload).SI7021.DewPoint;\n    //if(temp!==null){\n        global.set(\"temp16\",temp);\n        global.set(\"hum16\",hum);\n        global.set(\"dew16\",dew);\n        global.set(\"s16Flag\", false);\n        \n        msg1 = {topic: \"Temperature16\", payload: temp};\n        msg2 = {topic: \"Humidity16\", payload: hum};\n        \n        return [msg1,msg2,null,null];\n    //}\n}else if (payload==\"sensor16Fail\" || temp===null){\n    global.set(\"s16Flag\", true);\n    //global.set(\"temp16\",30);\n    //global.set(\"hum16\",0);\n    global.set(\"dew16\",0);\n    msg1 = {//from : \"noreply@gmail.com\",\n            to : email, \n            cc: global.get(\"ccEmail\"), \n            bcc: global.get(\"bccEmail\"), \n            topic : location + \": Sensor Fail\", \n            payload : \"Reading Failed!. Sensor 16 offline.\",\n            text: location+ \": Reading Failed!. Sensor 16 offline. \"+d\n    };\n    msg2={payload:{\n        //uncomment if you want send telegram message\n        //\"chatId\": \"your telegram chatId number must be integer\",\n        \"type\": \"message\",\n        \"content\": location+ \": Reading Failed!. Sensor 16 offline. \"+d}\n    };\n    return [null,null,msg1,msg2];\n}else{\n    return null;\n}","outputs":4,"noerr":0,"initialize":"","finalize":"","libs":[],"x":3120,"y":2100,"wires":[["658855eb.a8f41c","3ade866d.eac8ba"],["5c43c2bc.e6826c","be9f7999.fa62a8"],["412197f6.1b6308","d69bfbd2.b2f3c8"],["fa32aedb.16df7"]]},{"id":"658855eb.a8f41c","type":"ui_text","z":"fd37fbb3.4259f8","group":"c32e4918.a723a8","order":15,"width":2,"height":1,"name":"T_SENSOR16","label":"T16","format":"{{msg.payload}} °C","layout":"col-center","x":3340,"y":2060,"wires":[]},{"id":"5c43c2bc.e6826c","type":"ui_text","z":"fd37fbb3.4259f8","group":"c32e4918.a723a8","order":31,"width":2,"height":1,"name":"H_SENSOR16","label":"H16","format":"{{msg.payload}} %","layout":"col-center","x":3340,"y":2140,"wires":[]},{"id":"e3fb07b4.7d1d18","type":"comment","z":"fd37fbb3.4259f8","name":"SENSOR17","info":"","x":3130,"y":2180,"wires":[]},{"id":"c253190c.28d3c8","type":"function","z":"fd37fbb3.4259f8","name":"Sensor17Data","func":"payload=msg.payload;\nn=payload.includes(\"Temperature\");\nlocation=global.get(\"location\");\nemail=global.get(\"email\");\nd=global.get(\"gDateTime\");\n\nif(n === true){\ntemp = JSON.parse(payload).SI7021.Temperature;\nhum = JSON.parse(payload).SI7021.Humidity;\ndew = JSON.parse(payload).SI7021.DewPoint;\n}else{temp =0;hum =0;dew=0;}\n\nif (n!==false && temp!==null){\n    //temp = JSON.parse(payload).SI7021.Temperature;\n    //hum = JSON.parse(payload).SI7021.Humidity;\n    //dew = JSON.parse(payload).SI7021.DewPoint;\n    //if(temp!==null){\n        global.set(\"temp17\",temp);\n        global.set(\"hum17\",hum);\n        global.set(\"dew17\",dew);\n        global.set(\"s17Flag\", false);\n        \n        msg1 = {topic: \"Temperature17\", payload: temp};\n        msg2 = {topic: \"Humidity17\", payload: hum};\n        \n        return [msg1,msg2,null,null];\n    //}\n}else if (payload==\"sensor17Fail\" || temp===null){\n    global.set(\"s17Flag\", true);\n    //global.set(\"temp17\",30);\n    //global.set(\"hum17\",0);\n    global.set(\"dew17\",0);\n    msg1 = {//from : \"noreply@gmail.com\",\n            to : email, \n            cc: global.get(\"ccEmail\"), \n            bcc: global.get(\"bccEmail\"), \n            topic : location + \": Sensor Fail\", \n            payload : \"Reading Failed!. Sensor 17 offline.\",\n            text: location+ \": Reading Failed!. Sensor 17 offline. \"+d\n    };\n    msg2={payload:{\n        //uncomment if you want send telegram message\n        //\"chatId\": \"your telegram chatId number must be integer\",\n        \"type\": \"message\",\n        \"content\": location+ \": Reading Failed!. Sensor 17 offline. \"+d}\n    };\n    return [null,null,msg1,msg2];\n}else{\n    return null;\n}","outputs":4,"noerr":0,"initialize":"","finalize":"","libs":[],"x":3120,"y":2220,"wires":[["ca278d7a.3c884","3ade866d.eac8ba"],["8c794feb.4027d","be9f7999.fa62a8"],["412197f6.1b6308","d69bfbd2.b2f3c8"],["fa32aedb.16df7"]]},{"id":"ca278d7a.3c884","type":"ui_text","z":"fd37fbb3.4259f8","group":"c32e4918.a723a8","order":10,"width":2,"height":1,"name":"T_SENSOR17","label":"T17","format":"{{msg.payload}} °C","layout":"col-center","x":3340,"y":2180,"wires":[]},{"id":"8c794feb.4027d","type":"ui_text","z":"fd37fbb3.4259f8","group":"c32e4918.a723a8","order":26,"width":2,"height":1,"name":"H_SENSOR17","label":"H17","format":"{{msg.payload}} %","layout":"col-center","x":3340,"y":2260,"wires":[]},{"id":"5e62a831.1a30a8","type":"comment","z":"fd37fbb3.4259f8","name":"SENSOR12","info":"","x":3110,"y":1560,"wires":[]},{"id":"9a0aa0ed.ff8e","type":"function","z":"fd37fbb3.4259f8","name":"Sensor18Data","func":"payload=msg.payload;\nn=payload.includes(\"Temperature\");\nlocation=global.get(\"location\");\nemail=global.get(\"email\");\nd=global.get(\"gDateTime\");\n\nif(n === true){\ntemp = JSON.parse(payload).SI7021.Temperature;\nhum = JSON.parse(payload).SI7021.Humidity;\ndew = JSON.parse(payload).SI7021.DewPoint;\n}else{temp =0;hum =0;dew=0;}\n\nif (n!==false && temp!==null){\n    //temp = JSON.parse(payload).SI7021.Temperature;\n    //hum = JSON.parse(payload).SI7021.Humidity;\n    //dew = JSON.parse(payload).SI7021.DewPoint;\n    //if(temp!==null){\n        global.set(\"temp18\",temp);\n        global.set(\"hum18\",hum);\n        global.set(\"dew18\",dew);\n        global.set(\"s18Flag\", false);\n        \n        msg1 = {topic: \"Temperature18\", payload: temp};\n        msg2 = {topic: \"Humidity18\", payload: hum};\n        \n        return [msg1,msg2,null,null];\n    //}\n}else if (payload==\"sensor18Fail\" || temp===null){\n    global.set(\"s18Flag\", true);\n    //global.set(\"temp18\",30);\n    //global.set(\"hum18\",0);\n    global.set(\"dew18\",0);\n    msg1 = {//from : \"noreply@gmail.com\",\n            to : email, \n            cc: global.get(\"ccEmail\"), \n            bcc: global.get(\"bccEmail\"), \n            topic : location + \": Sensor Fail\", \n            payload : \"Reading Failed!. Sensor 18 offline.\",\n            text: location+ \": Reading Failed!. Sensor 18 offline. \"+d\n    };\n    msg2={payload:{\n        //uncomment if you want send telegram message\n        //\"chatId\": \"your telegram chatId number must be integer\",\n        \"type\": \"message\",\n        \"content\": location+ \": Reading Failed!. Sensor 18 offline. \"+d}\n    };\n    return [null,null,msg1,msg2];\n}else{\n    return null;\n}","outputs":4,"noerr":0,"initialize":"","finalize":"","libs":[],"x":3140,"y":2340,"wires":[["d24dff8a.39755","3ade866d.eac8ba"],["e85da049.177d","be9f7999.fa62a8"],["412197f6.1b6308","d69bfbd2.b2f3c8"],["fa32aedb.16df7"]]},{"id":"d24dff8a.39755","type":"ui_text","z":"fd37fbb3.4259f8","group":"c32e4918.a723a8","order":5,"width":2,"height":1,"name":"T_SENSOR18","label":"T18","format":"{{msg.payload}} °C","layout":"col-center","x":3360,"y":2300,"wires":[]},{"id":"1e6fd483.a2f40b","type":"comment","z":"fd37fbb3.4259f8","name":"SENSOR16","info":"","x":3110,"y":2040,"wires":[]},{"id":"e85da049.177d","type":"ui_text","z":"fd37fbb3.4259f8","group":"c32e4918.a723a8","order":21,"width":2,"height":1,"name":"H_SENSOR18","label":"H18","format":"{{msg.payload}} %","layout":"col-center","x":3360,"y":2380,"wires":[]},{"id":"70b35d0d.91f264","type":"comment","z":"fd37fbb3.4259f8","name":"SENSOR10","info":"","x":3110,"y":1320,"wires":[]},{"id":"412197f6.1b6308","type":"ui_toast","z":"fd37fbb3.4259f8","d":true,"position":"top right","displayTime":"3","highlight":"","sendall":true,"outputs":0,"ok":"OK","cancel":"","raw":false,"topic":"","name":"","x":3810,"y":1780,"wires":[]},{"id":"d69bfbd2.b2f3c8","type":"link out","z":"fd37fbb3.4259f8","name":"Email_Sensor_out","links":["b72eacf6.0c9bd"],"x":3815,"y":1900,"wires":[]},{"id":"fa32aedb.16df7","type":"link out","z":"fd37fbb3.4259f8","name":"Telegram_Sensor_out","links":["818887eb.6ef47"],"x":3815,"y":2080,"wires":[]},{"id":"d28528df.515658","type":"function","z":"fd37fbb3.4259f8","name":"SensorReplaceData","func":"//In case of some sensor fails, it will take data from the other one placed close\ns1Flag=global.get(\"s1Flag\");s10Flag=global.get(\"s10Flag\");\ns2Flag=global.get(\"s2Flag\");s11Flag=global.get(\"s11Flag\");\ns3Flag=global.get(\"s3Flag\");s12Flag=global.get(\"s12Flag\");\ns4Flag=global.get(\"s4Flag\");s13Flag=global.get(\"s13Flag\");\ns5Flag=global.get(\"s5Flag\");s14Flag=global.get(\"s14Flag\");\ns6Flag=global.get(\"s6Flag\");s15Flag=global.get(\"s15Flag\");\ns7Flag=global.get(\"s7Flag\");s16Flag=global.get(\"s16Flag\");\ns8Flag=global.get(\"s8Flag\");s17Flag=global.get(\"s17Flag\");\ns9Flag=global.get(\"s9Flag\");s18Flag=global.get(\"s18Flag\");\ntemp1=global.get(\"temp1\");temp10=global.get(\"temp10\");\ntemp2=global.get(\"temp2\");temp11=global.get(\"temp11\");\ntemp3=global.get(\"temp3\");temp12=global.get(\"temp12\");\ntemp4=global.get(\"temp4\");temp13=global.get(\"temp13\");\ntemp5=global.get(\"temp5\");temp14=global.get(\"temp14\");\ntemp6=global.get(\"temp6\");temp15=global.get(\"temp15\");\ntemp7=global.get(\"temp7\");temp16=global.get(\"temp16\");\ntemp8=global.get(\"temp8\");temp17=global.get(\"temp17\");\ntemp9=global.get(\"temp9\");temp18=global.get(\"temp18\");\n\nhum1=global.get(\"hum1\");hum10=global.get(\"hum10\");\nhum2=global.get(\"hum2\");hum11=global.get(\"hum11\");\nhum3=global.get(\"hum3\");hum12=global.get(\"hum12\");\nhum4=global.get(\"hum4\");hum13=global.get(\"hum13\");\nhum5=global.get(\"hum5\");hum14=global.get(\"hum14\");\nhum6=global.get(\"hum6\");hum15=global.get(\"hum15\");\nhum7=global.get(\"hum7\");hum16=global.get(\"hum16\");\nhum8=global.get(\"hum8\");hum17=global.get(\"hum17\");\nhum9=global.get(\"hum9\");hum18=global.get(\"hum18\");\n\nfref = global.get(\"fRef\");\ntp = global.get(\"fRef\");\ntempCtrl = global.get(\"fRef\");\nglobal.set(\"settctrl\",0);\nif(s1Flag===true && s2Flag===true && s3Flag===true && s4Flag===true && s5Flag===true && s6Flag===true && s7Flag===true && s8Flag===true && s9Flag===true && s10Flag===true && s11Flag===true && s12Flag===true && s13Flag===true && s14Flag===true && s15Flag===true && s16Flag===true&& s17Flag===true && s18Flag===true){ //todos caidos\n    global.set(\"wireless_sstate\",1);\n    if(tempCtrl<0 || tempCtrl===undefined || tempCtrl===null){\n        global.set(\"settctrl\",1);\n        global.set(\"tempAvg\", 40)\n    }else if(tempCtrl>0){\n        global.set(\"temp1\",tp+1);global.set(\"temp10\",tp+1);\n        global.set(\"temp2\",tp+1);global.set(\"temp11\",tp+1);\n        global.set(\"temp3\",tp+1);global.set(\"temp12\",tp+1);\n        global.set(\"temp4\",tp+1);global.set(\"temp13\",tp+1);\n        global.set(\"temp5\",tp+1);global.set(\"temp14\",tp+1);\n        global.set(\"temp6\",tp+1);global.set(\"temp15\",tp+1);\n        global.set(\"temp7\",tp+1);global.set(\"temp16\",tp+1);\n        global.set(\"temp8\",tp+1);global.set(\"temp17\",tp+1);\n        global.set(\"temp9\",tp+1);global.set(\"temp18\",tp+1);\n        global.set(\"hum1\",60);global.set(\"hum10\",60);\n        global.set(\"hum2\",60);global.set(\"hum11\",60);\n        global.set(\"hum3\",60);global.set(\"hum12\",60);\n        global.set(\"hum4\",60);global.set(\"hum13\",60);\n        global.set(\"hum5\",60);global.set(\"hum14\",60);\n        global.set(\"hum6\",60);global.set(\"hum15\",60);\n        global.set(\"hum7\",60);global.set(\"hum16\",60);\n        global.set(\"hum8\",60);global.set(\"hum17\",60);\n        global.set(\"hum9\",60);global.set(\"hum18\",60);\n        //global.set(\"humAvg\",0);\n    }\n}else{\n    global.set(\"wireless_sstate\",0);//estado de sensores\n    if(s1Flag==true || temp1 <1){\n        if(s2Flag!==true){\n            ////temp2=global.get(\"temp2\");\n            global.set(\"temp1\",temp2);\n            global.set(\"hum1\",hum2);\n            temp1=temp2;\n            hum1=hum2;\n        }\n        else if(s3Flag!==true){\n            //temp3=global.get(\"temp3\");\n            global.set(\"temp1\",temp3);\n            global.set(\"hum1\",hum3);\n            temp1=temp3;\n            hum1=hum3;\n        }\n        else if(s4Flag!==true){\n            ////temp4=global.get(\"temp4\");\n            global.set(\"temp1\",temp4);\n            global.set(\"hum1\",hum4);\n            temp1=temp4;\n            hum1=hum4;\n        }\n        else if(s5Flag!==true){\n            ////temp5=global.get(\"temp5\");\n            global.set(\"temp1\",temp5);\n            global.set(\"hum1\",hum5);\n            temp1=temp5;\n            hum1=hum5;\n        }\n        else if(s6Flag==false){\n            ////temp6=global.get(\"temp6\");\n            global.set(\"temp1\",temp6);\n            global.set(\"hum1\",hum6);\n            temp1=temp6;\n            hum1=hum6;\n        }\n        else if(s7Flag!==true){\n            ////temp7=global.get(\"temp7\");\n            global.set(\"temp1\",temp7);\n            global.set(\"hum1\",hum7);\n            temp1=temp7;\n            hum1=hum7;\n        }\n        else if(s8Flag!==true){\n            ////temp8=global.get(\"temp8\");\n            global.set(\"temp1\",temp8);\n            global.set(\"hum1\",hum8);\n            temp1=temp8;\n            hum1=hum8;\n        }\n        else if(s9Flag!==true){\n            ////temp9=global.get(\"temp9\");\n            global.set(\"temp1\",temp9);\n            global.set(\"hum1\",hum9);\n            temp1=temp9;\n            hum1=hum9;\n        }\n        else if(s10Flag!==true){\n            ////temp10=global.get(\"temp10\");\n            global.set(\"temp1\",temp10);\n            global.set(\"hum1\",hum10);\n            temp1=temp10;\n            hum1=hum11;\n        }\n        else if(s11Flag!==true){\n            ////temp11=global.get(\"temp11\");\n            global.set(\"temp1\",temp11);\n            global.set(\"hum1\",hum11);\n            temp1=temp12;\n            hum1=hum12;\n        }\n        else if(s12Flag!==true){\n            ////temp12=global.get(\"temp12\");\n            global.set(\"temp1\",temp12);\n            global.set(\"hum1\",hum12);\n            temp1=temp12;\n            hum1=hum12;\n        }\n        else if(s13Flag!==true){\n            ////temp13=global.get(\"temp13\");\n            global.set(\"temp1\",temp13);\n            global.set(\"hum1\",hum13);\n            temp1=temp13;\n            hum1=hum13;\n        }\n        else if(s14Flag!==true){\n            ////temp14=global.get(\"temp14\");\n            global.set(\"temp1\",temp14);\n            global.set(\"hum1\",hum14);\n            temp1=temp14;\n            hum1=hum14;\n        }\n        else if(s15Flag!==true){\n            ////temp15=global.get(\"temp15\");\n            global.set(\"temp1\",temp15);\n            global.set(\"hum1\",hum15);\n            temp1=temp15;\n            hum1=hum15;\n        }\n        else if(s16Flag==false){\n            ////temp16=global.get(\"temp16\");\n            global.set(\"temp1\",temp16);\n            global.set(\"hum1\",hum16);\n            temp1=temp16;\n            hum1=hum16;\n        }\n        else if(s17Flag!==true){\n            ////temp17=global.get(\"temp17\");\n            global.set(\"temp1\",temp17);\n            global.set(\"hum1\",hum17);\n            temp1=temp17;\n            hum1=hum17;\n        }\n        else if(s18Flag!==true){\n            ////temp18=global.get(\"temp18\");\n            global.set(\"temp1\",temp18);\n            global.set(\"hum1\",hum18);\n            temp1=temp18;\n            hum1=hum18;\n        }\n        \n    }\n    //\n    if(s2Flag===true || temp2 <1){\n        if(s1Flag!=true){\n            ////temp1=global.get(\"temp1\");\n            global.set(\"temp2\",temp1);\n            global.set(\"hum2\",hum1);\n            temp2=temp1;\n            hum2=hum1;\n        }\n        else if(s3Flag!==true){\n            //temp3=global.get(\"temp3\");\n            global.set(\"hum2\",hum3);\n            global.set(\"temp2\",temp3);\n            temp2=temp3;\n            hum2=hum3;\n        }\n        else if(s4Flag!==true){\n            //temp4=global.get(\"temp4\");\n            global.set(\"temp2\",temp4);\n            global.set(\"hum2\",hum4);\n            temp2=temp4;\n            hum2=hum4;\n        }\n        else if(s5Flag!==true){\n            //temp5=global.get(\"temp5\");\n            global.set(\"temp2\",temp5);\n            global.set(\"hum2\",hum5);\n            temp2=temp5;\n            hum2=hum5;\n        }\n        else if(s6Flag!==true){\n            //temp6=global.get(\"temp6\");\n            global.set(\"temp2\",temp6);\n            global.set(\"hum2\",hum6);\n            temp2=temp6;\n            hum2=hum6;\n        }\n        else if(s7Flag!==true){\n            //temp7=global.get(\"temp7\");\n            global.set(\"temp2\",temp7);\n            global.set(\"hum2\",hum7);\n            temp2=temp7;\n            hum2=hum7;\n        }\n        else if(s8Flag!==true){\n            //temp8=global.get(\"temp8\");\n            global.set(\"temp2\",temp8);\n            global.set(\"hum2\",hum8);\n            temp2=temp8;\n            hum2=hum8;\n        }\n        else if(s9Flag!==true){\n            //temp9=global.get(\"temp9\");\n            global.set(\"temp2\",temp9);\n            global.set(\"hum2\",hum9);\n            temp2=temp9;\n            hum2=hum9;\n        }\n        else if(s10Flag!==true){\n            //temp10=global.get(\"temp10\");\n            global.set(\"temp2\",temp10);\n            global.set(\"hum2\",hum10);\n            temp2=temp10;\n            hum2=hum10;\n        }\n        else if(s11Flag!==true){\n            //temp11=global.get(\"temp11\");\n            global.set(\"temp2\",temp11);\n            global.set(\"hum2\",hum11);\n            temp2=temp11;\n            hum2=hum11;\n        }\n        else if(s12Flag!==true){\n            //temp12=global.get(\"temp12\");\n            global.set(\"temp2\",temp12);\n            global.set(\"hum2\",hum12);\n            temp2=temp12;\n            hum2=hum12;\n        }\n        else if(s13Flag!==true){\n            //temp13=global.get(\"temp13\");\n            global.set(\"temp2\",temp13);\n            global.set(\"hum2\",hum13);\n            temp2=temp13;\n            hum2=hum13;\n        }\n        else if(s14Flag!==true){\n            //temp14=global.get(\"temp14\");\n            global.set(\"temp2\",temp14);\n            global.set(\"hum2\",hum14);\n            temp2=temp14;\n            hum2=hum14;\n        }\n        else if(s15Flag!==true){\n            //temp15=global.get(\"temp15\");\n            global.set(\"temp2\",temp15);\n            global.set(\"hum2\",hum15);\n            temp2=temp15;\n            hum2=hum15;\n        }\n        else if(s16Flag!==true){\n            //temp16=global.get(\"temp16\");\n            global.set(\"temp2\",temp16);\n            global.set(\"hum2\",hum16);\n            temp2=temp16;\n            hum2=hum16;\n        }\n        else if(s17Flag!==true){\n            //temp17=global.get(\"temp17\");\n            global.set(\"temp2\",temp17);\n            global.set(\"hum2\",hum17);\n            temp2=temp17;\n            hum2=hum17;\n        }\n        else if(s18Flag!==true){\n            //temp18=global.get(\"temp18\");\n            global.set(\"temp2\",temp18);\n            global.set(\"hum2\",hum18);\n            temp2=temp18;\n            hum2=hum18;\n        }\n    }\n    \n    if(s3Flag===true || temp3 <1){\n        if(s1Flag!==true){\n            //temp1=global.get(\"temp1\");\n            global.set(\"temp3\",temp1);\n            global.set(\"hum3\",hum1);\n            temp3=temp1;\n            hum3=hum1;\n        }\n        else if(s2Flag!==true){\n            //temp2=global.get(\"temp2\");\n            global.set(\"temp3\",temp2);\n            global.set(\"hum3\",hum2);\n            temp3=temp2;\n            hum3=hum2;\n        }\n        else if(s4Flag!==true){\n            //temp4=global.get(\"temp4\");\n            global.set(\"temp3\",temp4);\n            global.set(\"hum3\",hum4);\n            temp3=temp4;\n            hum3=hum4;\n        }\n        else if(s5Flag!==true){\n            //temp5=global.get(\"temp5\");\n            global.set(\"temp3\",temp5);\n            global.set(\"hum3\",hum5);\n            temp3=temp5;\n            hum3=hum5;\n        }\n        else if(s6Flag!==true){\n            //temp6=global.get(\"temp6\");\n            global.set(\"temp3\",temp6);\n            global.set(\"hum3\",hum6);\n            temp3=temp6;\n            hum3=hum6;\n        }\n        else if(s7Flag!==true){\n            //temp7=global.get(\"temp7\");\n            global.set(\"temp3\",temp7);\n            global.set(\"hum3\",hum7);\n            temp3=temp7;\n            hum3=hum7;\n        }\n        else if(s8Flag!==true){\n            //temp8=global.get(\"temp8\");\n            global.set(\"temp3\",temp8);\n            global.set(\"hum3\",hum8);\n            temp3=temp8;\n            hum3=hum8;\n        }\n        else if(s9Flag!==true){\n            //temp9=global.get(\"temp9\");\n            global.set(\"temp3\",temp9);\n            global.set(\"hum3\",hum9);\n            temp3=temp9;\n            hum3=hum9;\n        }\n        else if(s10Flag!==true){\n            //temp10=global.get(\"temp10\");\n            global.set(\"temp3\",temp10);\n            global.set(\"hum3\",hum10);\n            temp3=temp10;\n            hum3=hum10;\n        }\n        else if(s11Flag!==true){\n            //temp11=global.get(\"temp11\");\n            global.set(\"temp3\",temp11);\n            global.set(\"hum3\",hum11);\n            temp3=temp11;\n            hum3=hum11;\n        }\n        else if(s12Flag!==true){\n            //temp12=global.get(\"temp12\");\n            global.set(\"temp3\",temp12);\n            global.set(\"hum3\",hum12);\n            temp3=temp12;\n            hum3=hum12;\n        }\n        else if(s13Flag!==true){\n            //temp13=global.get(\"temp13\");\n            global.set(\"temp3\",temp13);\n            global.set(\"hum3\",hum13);\n            temp3=temp13;\n            hum3=hum13;\n        }\n        else if(s14Flag!==true){\n            //temp14=global.get(\"temp14\");\n            global.set(\"temp3\",temp14);\n            global.set(\"hum3\",hum14);\n            temp3=temp14;\n            hum3=hum14;\n        }\n        else if(s15Flag!==true){\n            //temp15=global.get(\"temp15\");\n            global.set(\"temp3\",temp15);\n            global.set(\"hum3\",hum15);\n            temp3=temp15;\n            hum3=hum15;\n        }\n        else if(s16Flag!==true){\n            //temp16=global.get(\"temp16\");\n            global.set(\"temp3\",temp16);\n            global.set(\"hum3\",hum16);\n            temp3=temp16;\n            hum3=hum16;\n        }\n        else if(s17Flag!==true){\n            //temp17=global.get(\"temp17\");\n            global.set(\"temp3\",temp17);\n            global.set(\"hum3\",hum17);\n            temp3=temp17;\n            hum3=hum17;\n        }\n        else if(s18Flag!==true){\n            //temp18=global.get(\"temp18\");\n            global.set(\"temp3\",temp18);\n            global.set(\"hum3\",hum18);\n            temp3=temp18;\n            hum3=hum18;\n        }\n    }\n    //\n    if(s4Flag===true || temp4 <1){\n        if(s1Flag!==true){\n            //temp1=global.get(\"temp1\");\n            global.set(\"temp4\",temp1);\n            global.set(\"hum4\",hum1);\n            temp4=temp1;\n            hum4=hum1;\n        }\n        else if(s2Flag!==true){\n            //temp2=global.get(\"temp2\");\n            global.set(\"temp4\",temp2);\n            global.set(\"hum4\",hum2);\n            temp4=temp2;\n            hum4=hum2;\n        }\n        else if(s3Flag!==true){\n            //temp3=global.get(\"temp3\");\n            global.set(\"temp4\",temp3);\n            global.set(\"hum4\",hum3);\n            temp4=temp3;\n            hum4=hum3;\n        }\n        else if(s5Flag!==true){\n            //temp5=global.get(\"temp5\");\n            global.set(\"temp4\",temp5);\n            global.set(\"hum4\",hum5);\n            temp4=temp5;\n            hum4=hum5;\n        }\n        else if(s6Flag!==true){\n            //temp6=global.get(\"temp6\");\n            global.set(\"temp4\",temp6);\n            global.set(\"hum4\",hum6);\n            temp4=temp6;\n            hum4=hum6;\n        }\n        else if(s7Flag!==true){\n            //temp7=global.get(\"temp7\");\n            global.set(\"temp4\",temp7);\n            global.set(\"hum4\",hum7);\n            temp4=temp7;\n            hum4=hum7;\n        }\n        else if(s8Flag!==true){\n            //temp8=global.get(\"temp8\");\n            global.set(\"temp4\",temp8);\n            global.set(\"hum4\",hum8);\n            temp4=temp8;\n            hum4=hum8;\n        }\n        else if(s9Flag!==true){\n            //temp9=global.get(\"temp9\");\n            global.set(\"temp4\",temp9);\n            global.set(\"hum4\",hum9);\n            temp4=temp9;\n            hum4=hum9;\n        }\n        else if(s10Flag!==true){\n            //temp10=global.get(\"temp10\");\n            global.set(\"temp4\",temp10);\n            global.set(\"hum4\",hum10);\n            temp4=temp10;\n            hum4=hum10;\n        }\n        else if(s11Flag!==true){\n            //temp11=global.get(\"temp11\");\n            global.set(\"temp4\",temp11);\n            global.set(\"hum4\",hum11);\n            temp4=temp11;\n            hum4=hum11;\n        }\n        else if(s12Flag!==true){\n            //temp12=global.get(\"temp12\");\n            global.set(\"temp4\",temp12);\n            global.set(\"hum4\",hum12);\n            temp4=temp12;\n            hum4=hum12;\n        }\n        else if(s13Flag!==true){\n            //temp13=global.get(\"temp13\");\n            global.set(\"temp4\",temp13);\n            global.set(\"hum4\",hum13);\n            temp4=temp13;\n            hum4=hum13;\n        }\n        else if(s14Flag!==true){\n            //temp14=global.get(\"temp14\");\n            global.set(\"temp4\",temp14);\n            global.set(\"hum4\",hum14);\n            temp4=temp14;\n            hum4=hum14;\n        }\n        else if(s15Flag!==true){\n            //temp15=global.get(\"temp15\");\n            global.set(\"temp4\",temp15);\n            global.set(\"hum4\",hum15);\n            temp4=temp15;\n            hum4=hum15;\n        }\n        else if(s16Flag!==true){\n            //temp16=global.get(\"temp16\");\n            global.set(\"temp4\",temp16);\n            global.set(\"hum4\",hum16);\n            temp4=temp16;\n            hum4=hum16;\n        }\n        else if(s17Flag!==true){\n            //temp17=global.get(\"temp17\");\n            global.set(\"temp4\",temp17);\n            global.set(\"hum4\",hum17);\n            temp4=temp17;\n            hum4=hum17;\n        }\n        else if(s18Flag!==true){\n            //temp18=global.get(\"temp18\");\n            global.set(\"temp4\",temp18);\n            global.set(\"hum4\",hum18);\n            temp4=temp18;\n            hum4=hum18;\n        }\n    }\n    //\n    if(s5Flag===true || temp5 <1){\n        if(s1Flag!==true){\n            //temp1=global.get(\"temp1\");\n            global.set(\"temp5\",temp1);\n            global.set(\"hum5\",hum1);\n            temp5=temp1;\n            hum5=hum1;\n        }\n        else if(s2Flag!==true){\n            //temp2=global.get(\"temp2\");\n            global.set(\"temp5\",temp2);\n            global.set(\"hum5\",hum2);\n            temp5=temp2;\n            hum5=hum2;\n        }\n        else if(s3Flag!==true){\n            //temp3=global.get(\"temp3\");\n            global.set(\"temp5\",temp3);\n            global.set(\"hum5\",hum3);\n            temp5=temp3;\n            hum5=hum3;\n        }\n        else if(s4Flag!==true){\n            //temp4=global.get(\"temp4\");\n            global.set(\"temp5\",temp4);\n            global.set(\"hum5\",hum4);\n            temp5=temp4;\n            hum5=hum4;\n        }\n        else if(s6Flag!==true){\n            //temp6=global.get(\"temp6\");\n            global.set(\"temp5\",temp6);\n            global.set(\"hum5\",hum6);\n            temp5=temp6;\n            hum5=hum6;\n        }\n        else if(s7Flag!==true){\n            //temp7=global.get(\"temp7\");\n            global.set(\"temp5\",temp7);\n            global.set(\"hum5\",hum7);\n            temp5=temp7;\n            hum5=hum7;\n        }\n        else if(s8Flag!==true){\n            //temp8=global.get(\"temp8\");\n            global.set(\"temp5\",temp8);\n            global.set(\"hum5\",hum8);\n            temp5=temp8;\n            hum5=hum8;\n        }\n        else if(s9Flag!==true){\n            //temp9=global.get(\"temp9\");\n            global.set(\"temp5\",temp9);\n            global.set(\"hum5\",hum9);\n            temp5=temp9;\n            hum5=hum9;\n        }\n        else if(s10Flag!==true){\n            //temp10=global.get(\"temp10\");\n            global.set(\"temp5\",temp10);\n            global.set(\"hum5\",hum10);\n            temp5=temp10;\n            hum5=hum10;\n        }\n        else if(s11Flag!==true){\n            //temp11=global.get(\"temp11\");\n            global.set(\"temp5\",temp11);\n            global.set(\"hum5\",hum11);\n            temp5=temp11;\n            hum5=hum11;\n        }\n        else if(s12Flag!==true){\n            //temp12=global.get(\"temp12\");\n            global.set(\"temp5\",temp12);\n            global.set(\"hum5\",hum12);\n            temp5=temp12;\n            hum5=hum12;\n        }\n        else if(s13Flag!==true){\n            //temp13=global.get(\"temp13\");\n            global.set(\"temp5\",temp13);\n            global.set(\"hum5\",hum13);\n            temp5=temp13;\n            hum5=hum13;\n        }\n        else if(s14Flag!==true){\n            //temp14=global.get(\"temp14\");\n            global.set(\"temp5\",temp14);\n            global.set(\"hum5\",hum14);\n            temp5=temp14;\n            hum5=hum14;\n        }\n        else if(s15Flag!==true){\n            //temp15=global.get(\"temp15\");\n            global.set(\"temp5\",temp15);\n            global.set(\"hum5\",hum15);\n            temp5=temp15;\n            hum5=hum15;\n        }\n        else if(s16Flag!==true){\n            //temp16=global.get(\"temp16\");\n            global.set(\"temp5\",temp16);\n            global.set(\"hum5\",hum16);\n            temp5=temp16;\n            hum5=hum16;\n        }\n        else if(s17Flag!==true){\n            //temp17=global.get(\"temp17\");\n            global.set(\"temp5\",temp17);\n            global.set(\"hum5\",hum17);\n            temp5=temp17;\n            hum5=hum17;\n        }\n        else if(s18Flag!==true){\n            //temp18=global.get(\"temp18\");\n            global.set(\"temp5\",temp18);\n            global.set(\"hum5\",hum18);\n            temp5=temp18;\n            hum5=hum18;\n        }\n    }\n    //\n    if(s6Flag===true || temp6 <1){\n        if(s1Flag!==true){\n            //temp1=global.get(\"temp1\");\n            global.set(\"temp6\",temp1);\n            global.set(\"hum6\",hum1);\n            temp6=temp1;\n            hum6=hum1;\n        }\n        else if(s2Flag!==true){\n            //temp2=global.get(\"temp2\");\n            global.set(\"temp6\",temp2);\n            global.set(\"hum6\",hum2);\n            temp6=temp2;\n            hum6=hum2;\n        }\n        else if(s3Flag!==true){\n            //temp3=global.get(\"temp3\");\n            global.set(\"temp6\",temp3);\n            global.set(\"hum6\",hum3);\n            temp6=temp3;\n            hum6=hum3;\n        }\n        else if(s4Flag!==true){\n            //temp4=global.get(\"temp4\");\n            global.set(\"temp6\",temp4);\n            global.set(\"hum6\",hum4);\n            temp6=temp4;\n            hum6=hum4;\n        }\n        else if(s5Flag!==true){\n            //temp5=global.get(\"temp5\");\n            global.set(\"temp6\",temp5);\n            global.set(\"hum6\",hum5);\n            temp6=temp5;\n            hum6=hum5;\n        }\n        else if(s7Flag!==true){\n            //temp7=global.get(\"temp7\");\n            global.set(\"temp6\",temp7);\n            global.set(\"hum6\",hum7);\n            temp6=temp7;\n            hum6=hum7;\n        }\n        else if(s8Flag!==true){\n            //temp8=global.get(\"temp8\");\n            global.set(\"temp6\",temp8);\n            global.set(\"hum6\",hum8);\n            temp6=temp8;\n            hum6=hum8;\n        }\n        else if(s9Flag!==true){\n            //temp9=global.get(\"temp9\");\n            global.set(\"temp6\",temp9);\n            global.set(\"hum6\",hum9);\n            temp6=temp9;\n            hum6=hum9;\n        }\n        else if(s10Flag!==true){\n            //temp10=global.get(\"temp10\");\n            global.set(\"temp6\",temp10);\n            global.set(\"hum6\",hum10);\n            temp6=temp10;\n            hum6=hum10;\n        }\n        else if(s11Flag!==true){\n            //temp11=global.get(\"temp11\");\n            global.set(\"temp6\",temp11);\n            global.set(\"hum6\",hum11);\n            temp6=temp11;\n            hum6=hum11;\n        }\n        else if(s12Flag!==true){\n            //temp12=global.get(\"temp12\");\n            global.set(\"temp6\",temp12);\n            global.set(\"hum6\",hum12);\n            temp6=temp12;\n            hum6=hum12;\n        }\n        else if(s13Flag!==true){\n            //temp13=global.get(\"temp13\");\n            global.set(\"temp6\",temp13);\n            global.set(\"hum6\",hum13);\n            temp6=temp13;\n            hum6=hum13;\n        }\n        else if(s14Flag!==true){\n            //temp14=global.get(\"temp14\");\n            global.set(\"temp6\",temp14);\n            global.set(\"hum6\",hum14);\n            temp6=temp14;\n            hum6=hum14;\n        }\n        else if(s15Flag!==true){\n            //temp15=global.get(\"temp15\");\n            global.set(\"temp6\",temp15);\n            global.set(\"hum6\",hum15);\n            temp6=temp15;\n            hum6=hum15;\n        }\n        else if(s16Flag!==true){\n            //temp16=global.get(\"temp16\");\n            global.set(\"temp6\",temp16);\n            global.set(\"hum6\",hum16);\n            temp6=temp16;\n            hum6=hum16;\n        }\n        else if(s17Flag!==true){\n            //temp17=global.get(\"temp17\");\n            global.set(\"temp6\",temp17);\n            global.set(\"hum6\",hum17);\n            temp6=temp17;\n            hum6=hum17;\n        }\n        else if(s18Flag!==true){\n            //temp18=global.get(\"temp18\");\n            global.set(\"temp6\",temp18);\n            global.set(\"hum6\",hum18);\n            temp6=temp18;\n            hum6=hum18;\n        }\n    }\n    //\n    if(s7Flag===true || temp7 <1){\n        if(s1Flag!==true){\n            //temp1=global.get(\"temp1\");\n            global.set(\"temp7\",temp1);\n            global.set(\"hum7\",hum1);\n            temp7=temp1;\n            hum7=hum1;\n        }\n        else if(s2Flag!==true){\n            //temp2=global.get(\"temp2\");\n            global.set(\"temp7\",temp2);\n            global.set(\"hum7\",hum2);\n            temp7=temp2;\n            hum7=hum2;\n        }\n        else if(s3Flag!==true){\n            //temp3=global.get(\"temp3\");\n            global.set(\"temp7\",temp3);\n            global.set(\"hum7\",hum3);\n            temp7=temp3;\n            hum7=hum3;\n        }\n        else if(s4Flag!==true){\n            //temp4=global.get(\"temp4\");\n            global.set(\"temp7\",temp4);\n            global.set(\"hum7\",hum4);\n            temp7=temp4;\n            hum7=hum4;\n        }\n        else if(s5Flag!==true){\n            //temp5=global.get(\"temp5\");\n            global.set(\"temp7\",temp5);\n            global.set(\"hum7\",hum5);\n            temp7=temp5;\n            hum7=hum5;\n        }\n        else if(s6Flag!==true){\n            //temp6=global.get(\"temp6\");\n            global.set(\"temp7\",temp6);\n            global.set(\"hum7\",hum6);\n            temp7=temp6;\n            hum7=hum6;\n        }\n        else if(s8Flag!==true){\n            //temp8=global.get(\"temp8\");\n            global.set(\"temp7\",temp8);\n            global.set(\"hum7\",hum8);\n            temp7=temp8;\n            hum7=hum8;\n        }\n        else if(s9Flag!==true){\n            //temp9=global.get(\"temp9\");\n            global.set(\"temp7\",temp9);\n            global.set(\"hum7\",hum9);\n            temp7=temp9;\n            hum7=hum9;\n        }\n        else if(s10Flag!==true){\n            //temp10=global.get(\"temp10\");\n            global.set(\"temp7\",temp10);\n            global.set(\"hum7\",hum10);\n            temp7=temp10;\n            hum7=hum10;\n        }\n        else if(s11Flag!==true){\n            //temp11=global.get(\"temp11\");\n            global.set(\"temp7\",temp11);\n            global.set(\"hum7\",hum11);\n            temp7=temp11;\n            hum7=hum11;\n        }\n        else if(s12Flag!==true){\n            //temp12=global.get(\"temp12\");\n            global.set(\"temp7\",temp12);\n            global.set(\"hum7\",hum12);\n            temp7=temp12;\n            hum7=hum12;\n        }\n        else if(s13Flag!==true){\n            //temp13=global.get(\"temp13\");\n            global.set(\"temp7\",temp13);\n            global.set(\"hum7\",hum13);\n            temp7=temp13;\n            hum7=hum13;\n        }\n        else if(s14Flag!==true){\n            //temp14=global.get(\"temp14\");\n            global.set(\"temp7\",temp14);\n            global.set(\"hum7\",hum14);\n            temp7=temp14;\n            hum7=hum14;\n        }\n        else if(s15Flag!==true){\n            //temp15=global.get(\"temp15\");\n            global.set(\"temp7\",temp15);\n            global.set(\"hum7\",hum15);\n            temp7=temp15;\n            hum7=hum15;\n        }\n        else if(s16Flag!==true){\n            //temp16=global.get(\"temp16\");\n            global.set(\"temp7\",temp16);\n            global.set(\"hum7\",hum16);\n            temp7=temp16;\n            hum7=hum16;\n        }\n        else if(s17Flag!==true){\n            //temp17=global.get(\"temp17\");\n            global.set(\"temp7\",temp17);\n            global.set(\"hum7\",hum17);\n            temp7=temp17;\n            hum7=hum17;\n        }\n        else if(s18Flag!==true){\n            //temp18=global.get(\"temp18\");\n            global.set(\"temp7\",temp18);\n            global.set(\"hum7\",hum18);\n            temp7=temp18;\n            hum7=hum18;\n        }\n    }\n    //\n    if(s8Flag===true || temp8 <1){\n        if(s1Flag!==true){\n            //temp1=global.get(\"temp1\");\n            global.set(\"temp8\",temp1);\n            global.set(\"hum8\",hum1);\n            temp8=temp1;\n            hum8=hum1;\n        }\n        else if(s2Flag!==true){\n            //temp2=global.get(\"temp2\");\n            global.set(\"temp8\",temp2);\n            global.set(\"hum8\",hum2);\n            temp8=temp2;\n            hum8=hum2;\n        }\n        else if(s3Flag!==true){\n            //temp3=global.get(\"temp3\");\n            global.set(\"temp8\",temp3);\n            global.set(\"hum8\",hum3);\n            temp8=temp3;\n            hum8=hum3;\n        }\n        else if(s4Flag!==true){\n            //temp4=global.get(\"temp4\");\n            global.set(\"temp8\",temp4);\n            global.set(\"hum8\",hum4);\n            temp8=temp4;\n            hum8=hum4;\n        }\n        else if(s5Flag!==true){\n            //temp5=global.get(\"temp5\");\n            global.set(\"temp8\",temp5);\n            global.set(\"hum8\",hum5);\n            temp8=temp5;\n            hum8=hum5;\n        }\n        else if(s6Flag!==true){\n            //temp6=global.get(\"temp6\");\n            global.set(\"temp8\",temp6);\n            global.set(\"hum8\",hum6);\n            temp8=temp6;\n            hum8=hum6;\n        }\n        else if(s7Flag!==true){\n            //temp7=global.get(\"temp7\");\n            global.set(\"temp8\",temp7);\n            global.set(\"hum8\",hum7);\n            temp8=temp7;\n            hum8=hum7;\n        }\n        else if(s9Flag!==true){\n            //temp9=global.get(\"temp9\");\n            global.set(\"temp8\",temp9);\n            global.set(\"hum8\",hum9);\n            temp8=temp9;\n            hum8=hum9;\n        }\n        else if(s10Flag!==true){\n            //temp10=global.get(\"temp10\");\n            global.set(\"temp8\",temp10);\n            global.set(\"hum8\",hum10);\n            temp8=temp10;\n            hum8=hum10;\n        }\n        else if(s11Flag!==true){\n            //temp11=global.get(\"temp11\");\n            global.set(\"temp8\",temp11);\n            global.set(\"hum8\",hum11);\n            temp8=temp11;\n            hum8=hum11;\n        }\n        else if(s12Flag!==true){\n            //temp12=global.get(\"temp12\");\n            global.set(\"temp8\",temp12);\n            global.set(\"hum8\",hum12);\n            temp8=temp12;\n            hum8=hum12;\n        }\n        else if(s13Flag!==true){\n            //temp13=global.get(\"temp13\");\n            global.set(\"temp8\",temp13);\n            global.set(\"hum8\",hum13);\n            temp8=temp13;\n            hum8=hum13;\n        }\n        else if(s14Flag!==true){\n            //temp14=global.get(\"temp14\");\n            global.set(\"temp8\",temp14);\n            global.set(\"hum8\",hum14);\n            temp8=temp14;\n            hum8=hum14;\n        }\n        else if(s15Flag!==true){\n            //temp15=global.get(\"temp15\");\n            global.set(\"temp8\",temp15);\n            global.set(\"hum8\",hum15);\n            temp8=temp15;\n            hum8=hum15;\n        }\n        else if(s16Flag!==true){\n            //temp16=global.get(\"temp16\");\n            global.set(\"temp8\",temp16);\n            global.set(\"hum8\",hum16);\n            temp8=temp16;\n            hum8=hum16;\n        }\n        else if(s17Flag!==true){\n            //temp17=global.get(\"temp17\");\n            global.set(\"temp8\",temp17);\n            global.set(\"hum8\",hum17);\n            temp8=temp17;\n            hum8=hum17;\n        }\n        else if(s18Flag!==true){\n            //temp18=global.get(\"temp18\");\n            global.set(\"temp8\",temp18);\n            global.set(\"hum8\",hum18);\n            temp8=temp18;\n            hum8=hum18;\n        }\n    }\n    if(s9Flag===true || temp9 <1){\n        if(s1Flag!==true){\n            //temp1=global.get(\"temp1\");\n            global.set(\"temp9\",temp1);\n            global.set(\"hum9\",hum1);\n            temp9=temp1;\n            hum9=hum1;\n        }\n        else if(s2Flag!==true){\n            //temp2=global.get(\"temp2\");\n            global.set(\"temp9\",temp2);\n            global.set(\"hum9\",hum2);\n            temp9=temp2;\n            hum9=hum2;\n        }\n        else if(s3Flag!==true){\n            //temp3=global.get(\"temp3\");\n            global.set(\"temp9\",temp3);\n            global.set(\"hum9\",hum3);\n            temp9=temp3;\n            hum9=hum3;\n        }\n        else if(s4Flag!==true){\n            //temp4=global.get(\"temp4\");\n            global.set(\"temp9\",temp4);\n            global.set(\"hum9\",hum4);\n            temp9=temp4;\n            hum9=hum4;\n        }\n        else if(s5Flag!==true){\n            //temp5=global.get(\"temp5\");\n            global.set(\"temp9\",temp5);\n            global.set(\"hum9\",hum5);\n            temp9=temp5;\n            hum9=hum5;\n        }\n        else if(s6Flag!==true){\n            //temp6=global.get(\"temp6\");\n            global.set(\"temp9\",temp6);\n            global.set(\"hum9\",hum6);\n            temp9=temp6;\n            hum9=hum6;\n        }\n        else if(s7Flag!==true){\n            //temp7=global.get(\"temp7\");\n            global.set(\"temp9\",temp7);\n            global.set(\"hum9\",hum7);\n            temp9=temp7;\n            hum9=hum7;\n        }\n        else if(s8Flag!==true){\n            //temp8=global.get(\"temp8\");\n            global.set(\"temp9\",temp8);\n            global.set(\"hum9\",hum8);\n            temp9=temp8;\n            hum9=hum8;\n        }\n        else if(s10Flag!==true){\n            //temp10=global.get(\"temp10\");\n            global.set(\"temp9\",temp10);\n            global.set(\"hum9\",hum10);\n            temp9=temp10;\n            hum9=hum10;\n        }\n        else if(s11Flag!==true){\n            //temp11=global.get(\"temp11\");\n            global.set(\"temp9\",temp11);\n            global.set(\"hum9\",hum11);\n            temp9=temp11;\n            hum9=hum11;\n        }\n        else if(s12Flag!==true){\n            //temp12=global.get(\"temp12\");\n            global.set(\"temp9\",temp12);\n            global.set(\"hum9\",hum12);\n            temp9=temp12;\n            hum9=hum12;\n        }\n        else if(s13Flag!==true){\n            //temp13=global.get(\"temp13\");\n            global.set(\"temp9\",temp13);\n            global.set(\"hum9\",hum13);\n            temp9=temp13;\n            hum9=hum13;\n        }\n        else if(s14Flag!==true){\n            //temp14=global.get(\"temp14\");\n            global.set(\"temp9\",temp14);\n            global.set(\"hum9\",hum14);\n            temp9=temp14;\n            hum9=hum14;\n        }\n        else if(s15Flag!==true){\n            //temp15=global.get(\"temp15\");\n            global.set(\"temp9\",temp15);\n            global.set(\"hum9\",hum15);\n            temp9=temp15;\n            hum9=hum15;\n        }\n        else if(s16Flag!==true){\n            //temp16=global.get(\"temp16\");\n            global.set(\"temp9\",temp16);\n            global.set(\"hum9\",hum16);\n            temp9=temp16;\n            hum9=hum16;\n        }\n        else if(s17Flag!==true){\n            //temp17=global.get(\"temp17\");\n            global.set(\"temp9\",temp17);\n            global.set(\"hum9\",hum17);\n            temp9=temp17;\n            hum9=hum17;\n        }\n        else if(s18Flag!==true){\n            //temp18=global.get(\"temp18\");\n            global.set(\"temp9\",temp18);\n            global.set(\"hum9\",hum18);\n            temp9=temp18;\n            hum9=hum18;\n        }\n    }\n    if(s10Flag===true || temp10 <20){\n        if(s1Flag!==true){\n            //temp1=global.get(\"temp1\");\n            global.set(\"temp10\",temp1);\n            global.set(\"hum10\",hum1);\n            temp10=temp1;\n            hum10=hum1;\n        }\n        else if(s2Flag!==true){\n            //temp2=global.get(\"temp2\");\n            global.set(\"temp10\",temp2);\n            global.set(\"hum10\",hum2);\n            temp10=temp2;\n            hum10=hum2;\n        }\n        else if(s3Flag!==true){\n            //temp3=global.get(\"temp3\");\n            global.set(\"temp10\",temp3);\n            global.set(\"hum10\",hum3);\n            temp10=temp3;\n            hum10=hum3;\n        }\n        else if(s4Flag!==true){\n            //temp4=global.get(\"temp4\");\n            global.set(\"temp10\",temp4);\n            global.set(\"hum10\",hum4);\n            temp10=temp4;\n            hum10=hum4;\n        }\n        else if(s5Flag!==true){\n            //temp5=global.get(\"temp5\");\n            global.set(\"temp10\",temp5);\n            global.set(\"hum10\",hum5);\n            temp10=temp5;\n            hum10=hum5;\n        }\n        else if(s6Flag!==true){\n            //temp6=global.get(\"temp6\");\n            global.set(\"temp10\",temp6);\n            global.set(\"hum10\",hum6);\n            temp10=temp6;\n            hum10=hum6;\n        }\n        else if(s7Flag!==true){\n            //temp7=global.get(\"temp7\");\n            global.set(\"temp10\",temp7);\n            global.set(\"hum10\",hum7);\n            temp10=temp7;\n            hum10=hum7;\n        }\n        else if(s8Flag!==true){\n            //temp8=global.get(\"temp8\");\n            global.set(\"temp10\",temp8);\n            global.set(\"hum10\",hum8);\n            temp10=temp8;\n            hum10=hum8;\n        }\n        else if(s9Flag!==true){\n            //temp9=global.get(\"temp9\");\n            global.set(\"temp10\",temp9);\n            global.set(\"hum10\",hum9);\n            temp10=temp9;\n            hum10=hum9;\n        }\n        else if(s11Flag!==true){\n            //temp11=global.get(\"temp11\");\n            global.set(\"temp10\",temp11);\n            global.set(\"hum10\",hum11);\n            temp10=temp11;\n            hum10=hum11;\n        }\n        else if(s12Flag!==true){\n            //temp12=global.get(\"temp12\");\n            global.set(\"temp10\",temp12);\n            global.set(\"hum10\",hum12);\n            temp10=temp12;\n            hum10=hum12;\n        }\n        else if(s13Flag!==true){\n            //temp13=global.get(\"temp13\");\n            global.set(\"temp10\",temp13);\n            global.set(\"hum10\",hum13);\n            temp10=temp13;\n            hum10=hum13;\n        }\n        else if(s14Flag!==true){\n            //temp14=global.get(\"temp14\");\n            global.set(\"temp10\",temp14);\n            global.set(\"hum10\",hum14);\n            temp10=temp14;\n            hum10=hum14;\n        }\n        else if(s15Flag!==true){\n            //temp15=global.get(\"temp15\");\n            global.set(\"temp10\",temp15);\n            global.set(\"hum10\",hum15);\n            temp10=temp15;\n            hum10=hum15;\n        }\n        else if(s16Flag!==true){\n            //temp16=global.get(\"temp16\");\n            global.set(\"temp10\",temp16);\n            global.set(\"hum10\",hum16);\n            temp10=temp16;\n            hum10=hum16;\n        }\n        else if(s17Flag!==true){\n            //temp17=global.get(\"temp17\");\n            global.set(\"temp10\",temp17);\n            global.set(\"hum10\",hum17);\n            temp10=temp17;\n            hum10=hum17;\n        }\n        else if(s18Flag!==true){\n            //temp18=global.get(\"temp18\");\n            global.set(\"temp10\",temp18);\n            global.set(\"hum10\",hum18);\n            temp10=temp18;\n            hum10=hum18;\n        }\n    }\n    if(s11Flag===true || temp11 <1){\n        if(s1Flag!==true){\n            //temp1=global.get(\"temp1\");\n            global.set(\"temp11\",temp1);\n            global.set(\"hum11\",hum1);\n            temp11=temp1;\n            hum11=hum1;\n        }\n        else if(s2Flag!==true){\n            //temp2=global.get(\"temp2\");\n            global.set(\"temp11\",temp2);\n            global.set(\"hum11\",hum2);\n            temp11=temp2;\n            hum11=hum2;\n        }\n        else if(s3Flag!==true){\n            //temp3=global.get(\"temp3\");\n            global.set(\"temp11\",temp3);\n            global.set(\"hum11\",hum3);\n            temp11=temp3;\n            hum11=hum3;\n        }\n        else if(s4Flag!==true){\n            //temp4=global.get(\"temp4\");\n            global.set(\"temp11\",temp4);\n            global.set(\"hum11\",hum4);\n            temp11=temp4;\n            hum11=hum4;\n        }\n        else if(s5Flag!==true){\n            //temp5=global.get(\"temp5\");\n            global.set(\"temp11\",temp5);\n            global.set(\"hum11\",hum5);\n            temp11=temp5;\n            hum11=hum5;\n        }\n        else if(s6Flag!==true){\n            //temp6=global.get(\"temp6\");\n            global.set(\"temp11\",temp6);\n            global.set(\"hum11\",hum6);\n            temp11=temp6;\n            hum11=hum6;\n        }\n        else if(s7Flag!==true){\n            //temp7=global.get(\"temp7\");\n            global.set(\"temp11\",temp7);\n            global.set(\"hum11\",hum7);\n            temp11=temp7;\n            hum11=hum7;\n        }\n        else if(s8Flag!==true){\n            //temp8=global.get(\"temp8\");\n            global.set(\"temp11\",temp8);\n            global.set(\"hum11\",hum8);\n            temp11=temp8;\n            hum11=hum8;\n        }\n        else if(s9Flag!==true){\n            //temp9=global.get(\"temp9\");\n            global.set(\"temp11\",temp9);\n            global.set(\"hum11\",hum9);\n            temp11=temp9;\n            hum11=hum9;\n        }\n        else if(s10Flag!==true){\n            //temp10=global.get(\"temp10\");\n            global.set(\"temp11\",temp10);\n            global.set(\"hum11\",hum10);\n            temp11=temp10;\n            hum11=hum10;\n        }\n        else if(s12Flag!==true){\n            //temp12=global.get(\"temp12\");\n            global.set(\"temp11\",temp12);\n            global.set(\"hum11\",hum12);\n            temp11=temp12;\n            hum11=hum12;\n        }\n        else if(s13Flag!==true){\n            //temp13=global.get(\"temp13\");\n            global.set(\"temp11\",temp13);\n            global.set(\"hum11\",hum13);\n            temp11=temp13;\n            hum11=hum13;\n        }\n        else if(s14Flag!==true){\n            //temp14=global.get(\"temp14\");\n            global.set(\"temp11\",temp14);\n            global.set(\"hum11\",hum14);\n            temp11=temp14;\n            hum11=hum14;\n        }\n        else if(s15Flag!==true){\n            //temp15=global.get(\"temp15\");\n            global.set(\"temp11\",temp15);\n            global.set(\"hum11\",hum15);\n            temp11=temp15;\n            hum11=hum15;\n        }\n        else if(s16Flag!==true){\n            //temp16=global.get(\"temp16\");\n            global.set(\"temp11\",temp16);\n            global.set(\"hum11\",hum16);\n            temp11=temp16;\n            hum11=hum16;\n        }\n        else if(s17Flag!==true){\n            //temp17=global.get(\"temp17\");\n            global.set(\"temp11\",temp17);\n            global.set(\"hum11\",hum17);\n            temp11=temp17;\n            hum11=hum17;\n        }\n        else if(s18Flag!==true){\n            //temp18=global.get(\"temp18\");\n            global.set(\"temp11\",temp18);\n            global.set(\"hum11\",hum18);\n            temp11=temp17;\n            hum11=hum17;\n        }\n    }\n    if(s12Flag===true || temp12 <1){\n        if(s1Flag!==true){\n            //temp1=global.get(\"temp1\");\n            global.set(\"temp12\",temp1);\n            global.set(\"hum12\",hum1);\n            temp12=temp1;\n            hum12=hum1;\n        }\n        else if(s2Flag!==true){\n            //temp2=global.get(\"temp2\");\n            global.set(\"temp12\",temp2);\n            global.set(\"hum12\",hum2);\n            temp12=temp2;\n            hum12=hum2;\n        }\n        else if(s3Flag!==true){\n            //temp3=global.get(\"temp3\");\n            global.set(\"temp12\",temp3);\n            global.set(\"hum12\",hum3);\n            temp12=temp3;\n            hum12=hum3;\n        }\n        else if(s4Flag!==true){\n            //temp4=global.get(\"temp4\");\n            global.set(\"temp12\",temp4);\n            global.set(\"hum12\",hum4);\n            temp12=temp4;\n            hum12=hum4;\n        }\n        else if(s5Flag!==true){\n            //temp5=global.get(\"temp5\");\n            global.set(\"temp12\",temp5);\n            global.set(\"hum12\",hum5);\n            temp12=temp5;\n            hum12=hum5;\n        }\n        else if(s6Flag!==true){\n            //temp6=global.get(\"temp6\");\n            global.set(\"temp12\",temp6);\n            global.set(\"hum12\",hum6);\n            temp12=temp6;\n            hum12=hum6;\n        }\n        else if(s7Flag!==true){\n            //temp7=global.get(\"temp7\");\n            global.set(\"temp12\",temp7);\n            global.set(\"hum12\",hum7);\n            temp12=temp7;\n            hum12=hum7;\n        }\n        else if(s8Flag!==true){\n            //temp8=global.get(\"temp8\");\n            global.set(\"temp12\",temp8);\n            global.set(\"hum12\",hum8);\n            temp12=temp8;\n            hum12=hum8;\n        }\n        else if(s9Flag!==true){\n            //temp9=global.get(\"temp9\");\n            global.set(\"temp12\",temp9);\n            global.set(\"hum12\",hum9);\n            temp12=temp9;\n            hum12=hum9;\n        }\n        else if(s10Flag!==true){\n            //temp10=global.get(\"temp10\");\n            global.set(\"temp12\",temp10);\n            global.set(\"hum12\",hum10);\n            temp12=temp10;\n            hum12=hum10;\n        }\n        else if(s11Flag!==true){\n            //temp11=global.get(\"temp11\");\n            global.set(\"temp12\",temp11);\n            global.set(\"hum12\",hum11);\n            temp12=temp11;\n            hum12=hum11;\n        }\n        else if(s13Flag!==true){\n            //temp13=global.get(\"temp13\");\n            global.set(\"temp12\",temp13);\n            global.set(\"hum12\",hum13);\n            temp12=temp13;\n            hum12=hum13;\n        }\n        else if(s14Flag!==true){\n            //temp14=global.get(\"temp14\");\n            global.set(\"temp12\",temp14);\n            global.set(\"hum12\",hum14);\n            temp12=temp14;\n            hum12=hum14;\n        }\n        else if(s15Flag!==true){\n            //temp15=global.get(\"temp15\");\n            global.set(\"temp12\",temp15);\n            global.set(\"hum12\",hum15);\n            temp12=temp2;\n            hum12=hum2;\n        }\n        else if(s16Flag!==true){\n            //temp16=global.get(\"temp16\");\n            global.set(\"temp12\",temp16);\n            global.set(\"hum12\",hum16);\n            temp12=temp16;\n            hum12=hum16;\n        }\n        else if(s17Flag!==true){\n            //temp17=global.get(\"temp17\");\n            global.set(\"temp12\",temp17);\n            global.set(\"hum12\",hum17);\n            temp12=temp17;\n            hum12=hum17;\n        }\n        else if(s18Flag!==true){\n            //temp18=global.get(\"temp18\");\n            global.set(\"temp12\",temp18);\n            global.set(\"hum12\",hum18);\n            temp12=temp18;\n            hum12=hum18;\n        }\n    }\n    if(s13Flag===true || temp13 <1){\n        if(s1Flag!==true){\n            //temp1=global.get(\"temp1\");\n            global.set(\"temp13\",temp1);\n            global.set(\"hum13\",hum1);\n            temp13=temp1;\n            hum13=hum1;\n        }\n        else if(s2Flag!==true){\n            //temp2=global.get(\"temp2\");\n            global.set(\"temp13\",temp2);\n            global.set(\"hum13\",hum2);\n            temp13=temp2;\n            hum13=hum2;\n        }\n        else if(s3Flag!==true){\n            //temp3=global.get(\"temp3\");\n            global.set(\"temp13\",temp3);\n            global.set(\"hum13\",hum3);\n            temp13=temp3;\n            hum13=hum3;\n        }\n        else if(s4Flag!==true){\n            //temp4=global.get(\"temp4\");\n            global.set(\"temp13\",temp4);\n            global.set(\"hum13\",hum4);\n            temp13=temp4;\n            hum13=hum2;\n        }\n        else if(s5Flag!==true){\n            //temp5=global.get(\"temp5\");\n            global.set(\"temp13\",temp5);\n            global.set(\"hum13\",hum5);\n            temp13=temp5;\n            hum13=hum5;\n        }\n        else if(s6Flag!==true){\n            //temp6=global.get(\"temp6\");\n            global.set(\"temp13\",temp6);\n            global.set(\"hum13\",hum6);\n            temp13=temp6;\n            hum13=hum6;\n        }\n        else if(s7Flag!==true){\n            //temp7=global.get(\"temp7\");\n            global.set(\"temp13\",temp7);\n            global.set(\"hum13\",hum7);\n            temp13=temp7;\n            hum13=hum7;\n        }\n        else if(s8Flag!==true){\n            //temp8=global.get(\"temp8\");\n            global.set(\"temp13\",temp8);\n            global.set(\"hum13\",hum8);\n            temp13=temp8;\n            hum13=hum8;\n        }\n        else if(s9Flag!==true){\n            //temp9=global.get(\"temp9\");\n            global.set(\"temp13\",temp9);\n            global.set(\"hum13\",hum9);\n            temp13=temp9;\n            hum13=hum9;\n        }\n        else if(s10Flag!==true){\n            //temp10=global.get(\"temp10\");\n            global.set(\"temp13\",temp10);\n            global.set(\"hum13\",hum10);\n            temp13=temp10;\n            hum13=hum10;\n        }\n        else if(s11Flag!==true){\n            //temp11=global.get(\"temp11\");\n            global.set(\"temp13\",temp11);\n            global.set(\"hum13\",hum11);\n            temp13=temp11;\n            hum13=hum11;\n        }\n        else if(s12Flag!==true){\n            //temp12=global.get(\"temp12\");\n            global.set(\"temp13\",temp12);\n            global.set(\"hum13\",hum12);\n            temp13=temp12;\n            hum13=hum12;\n        }\n        else if(s14Flag!==true){\n            //temp14=global.get(\"temp14\");\n            global.set(\"temp13\",temp14);\n            global.set(\"hum13\",hum14);\n            temp13=temp13;\n            hum13=hum14;\n        }\n        else if(s15Flag!==true){\n            //temp15=global.get(\"temp15\");\n            global.set(\"temp13\",temp15);\n            global.set(\"hum13\",hum15);\n            temp13=temp15;\n            hum13=hum15;\n        }\n        else if(s16Flag!==true){\n            //temp16=global.get(\"temp16\");\n            global.set(\"temp13\",temp16);\n            global.set(\"hum13\",hum16);\n            temp13=temp16;\n            hum13=hum16;\n        }\n        else if(s17Flag!==true){\n            //temp17=global.get(\"temp17\");\n            global.set(\"temp13\",temp17);\n            global.set(\"hum13\",hum17);\n            temp13=temp17;\n            hum13=hum17;\n        }\n        else if(s18Flag!==true){\n            //temp18=global.get(\"temp18\");\n            global.set(\"temp13\",temp18);\n            global.set(\"hum13\",hum18);\n            temp13=temp18;\n            hum13=hum18;\n        }\n    }\n    if(s14Flag===true || temp14 <1){\n        if(s1Flag!==true){\n            //temp1=global.get(\"temp1\");\n            global.set(\"temp14\",temp1);\n            global.set(\"hum14\",hum1);\n            temp14=temp1;\n            hum14=hum1;\n        }\n        else if(s2Flag!==true){\n            //temp2=global.get(\"temp2\");\n            global.set(\"temp14\",temp2);\n            global.set(\"hum14\",hum2);\n            temp14=temp2;\n            hum14=hum2;\n        }\n        else if(s3Flag!==true){\n            //temp3=global.get(\"temp3\");\n            global.set(\"temp14\",temp3);\n            global.set(\"hum14\",hum3);\n            temp14=temp3;\n            hum14=hum3;\n        }\n        else if(s4Flag!==true){\n            //temp4=global.get(\"temp4\");\n            global.set(\"temp14\",temp4);\n            global.set(\"hum14\",hum4);\n            temp14=temp4;\n            hum14=hum4;\n        }\n        else if(s5Flag!==true){\n            //temp5=global.get(\"temp5\");\n            global.set(\"temp14\",temp5);\n            global.set(\"hum14\",hum5);\n            temp14=temp5;\n            hum14=hum5;\n        }\n        else if(s6Flag!==true){\n            //temp6=global.get(\"temp6\");\n            global.set(\"temp14\",temp6);\n            global.set(\"hum14\",hum6);\n            temp14=temp6;\n            hum14=hum6;\n        }\n        else if(s7Flag!==true){\n            //temp7=global.get(\"temp7\");\n            global.set(\"temp14\",temp7);\n            global.set(\"hum14\",hum7);\n            temp14=temp7;\n            hum14=hum7;\n        }\n        else if(s8Flag!==true){\n            //temp8=global.get(\"temp8\");\n            global.set(\"temp14\",temp8);\n            global.set(\"hum14\",hum8);\n            temp14=temp8;\n            hum14=hum8;\n        }\n        else if(s9Flag!==true){\n            //temp9=global.get(\"temp9\");\n            global.set(\"temp14\",temp9);\n            global.set(\"hum14\",hum9);\n            temp14=temp9;\n            hum14=hum9;\n        }\n        else if(s10Flag!==true){\n            //temp10=global.get(\"temp10\");\n            global.set(\"temp14\",temp10);\n            global.set(\"hum14\",hum10);\n            temp14=temp10;\n            hum14=hum10;\n        }\n        else if(s11Flag!==true){\n            //temp11=global.get(\"temp11\");\n            global.set(\"temp14\",temp11);\n            global.set(\"hum14\",hum11);\n            temp14=temp11;\n            hum14=hum11;\n        }\n        else if(s12Flag!==true){\n            //temp12=global.get(\"temp12\");\n            global.set(\"temp14\",temp12);\n            global.set(\"hum14\",hum12);\n            temp14=temp12;\n            hum14=hum12;\n        }\n        else if(s13Flag!==true){\n            //temp13=global.get(\"temp13\");\n            global.set(\"temp14\",temp13);\n            global.set(\"hum14\",hum13);\n            temp14=temp13;\n            hum14=hum13;\n        }\n        else if(s15Flag!==true){\n            //temp15=global.get(\"temp15\");\n            global.set(\"temp14\",temp15);\n            global.set(\"hum14\",hum15);\n            temp14=temp15;\n            hum14=hum15;\n        }\n        else if(s16Flag!==true){\n            //temp16=global.get(\"temp16\");\n            global.set(\"temp14\",temp16);\n            global.set(\"hum14\",hum16);\n            temp14=temp16;\n            hum14=hum16;\n        }\n        else if(s17Flag!==true){\n            //temp17=global.get(\"temp17\");\n            global.set(\"temp14\",temp17);\n            global.set(\"hum14\",hum17);\n            temp14=temp17;\n            hum14=hum17;\n        }\n        else if(s18Flag!==true){\n            //temp18=global.get(\"temp18\");\n            global.set(\"temp14\",temp18);\n            global.set(\"hum14\",hum18);\n            temp14=temp18;\n            hum14=hum18;\n        }\n    }\n    if(s15Flag===true || temp15 <1){\n        if(s1Flag!==true){\n            //temp1=global.get(\"temp1\");\n            global.set(\"temp15\",temp1);\n            global.set(\"hum15\",hum1);\n            temp15=temp1;\n            hum15=hum1;\n        }\n        else if(s2Flag!==true){\n            //temp2=global.get(\"temp2\");\n            global.set(\"temp15\",temp2);\n            global.set(\"hum15\",hum2);\n            temp15=temp2;\n            hum15=hum2;\n        }\n        else if(s3Flag!==true){\n            //temp3=global.get(\"temp3\");\n            global.set(\"temp15\",temp3);\n            global.set(\"hum15\",hum3);\n            temp15=temp3;\n            hum15=hum3;\n        }\n        else if(s4Flag!==true){\n            //temp4=global.get(\"temp4\");\n            global.set(\"temp15\",temp4);\n            global.set(\"hum15\",hum4);\n            temp15=temp4;\n            hum15=hum4;\n        }\n        else if(s5Flag!==true){\n            //temp5=global.get(\"temp5\");\n            global.set(\"temp15\",temp5);\n            global.set(\"hum15\",hum5);\n            temp15=temp5;\n            hum15=hum5;\n        }\n        else if(s6Flag!==true){\n            //temp6=global.get(\"temp6\");\n            global.set(\"temp15\",temp6);\n            global.set(\"hum15\",hum6);\n            temp15=temp6;\n            hum15=hum6;\n        }\n        else if(s7Flag!==true){\n            //temp7=global.get(\"temp7\");\n            global.set(\"temp15\",temp7);\n            global.set(\"hum15\",hum7);\n            temp15=temp7;\n            hum15=hum7;\n        }\n        else if(s8Flag!==true){\n            //temp8=global.get(\"temp8\");\n            global.set(\"temp15\",temp8);\n            global.set(\"hum15\",hum8);\n            temp15=temp8;\n            hum15=hum8;\n        }\n        else if(s9Flag!==true){\n            //temp9=global.get(\"temp9\");\n            global.set(\"temp15\",temp9);\n            global.set(\"hum15\",hum9);\n            temp15=temp9;\n            hum15=hum9;\n        }\n        else if(s10Flag!==true){\n            //temp10=global.get(\"temp10\");\n            global.set(\"temp15\",temp10);\n            global.set(\"hum15\",hum10);\n            temp15=temp10;\n            hum15=hum10;\n        }\n        else if(s11Flag!==true){\n            //temp11=global.get(\"temp11\");\n            global.set(\"temp15\",temp11);\n            global.set(\"hum15\",hum11);\n            temp15=temp11;\n            hum15=hum11;\n        }\n        else if(s12Flag!==true){\n            //temp12=global.get(\"temp12\");\n            global.set(\"temp15\",temp12);\n            global.set(\"hum15\",hum12);\n            temp15=temp12;\n            hum15=hum12;\n        }\n        else if(s13Flag!==true){\n            //temp13=global.get(\"temp13\");\n            global.set(\"temp15\",temp13);\n            global.set(\"hum15\",hum13);\n            temp15=temp13;\n            hum15=hum13;\n        }\n        else if(s14Flag!==true){\n            //temp14=global.get(\"temp14\");\n            global.set(\"temp15\",temp14);\n            global.set(\"hum15\",hum14);\n            temp15=temp14;\n            hum15=hum14;\n        }\n        else if(s16Flag!==true){\n            //temp16=global.get(\"temp16\");\n            global.set(\"temp15\",temp16);\n            global.set(\"hum15\",hum16);\n            temp15=temp15;\n            hum15=hum15;\n        }\n        else if(s17Flag!==true){\n            //temp17=global.get(\"temp17\");\n            global.set(\"temp15\",temp17);\n            global.set(\"hum15\",hum17);\n            temp15=temp17;\n            hum15=hum17;\n        }\n        else if(s18Flag!==true){\n            //temp18=global.get(\"temp18\");\n            global.set(\"temp15\",temp18);\n            global.set(\"hum15\",hum18);\n            temp15=temp18;\n            hum15=hum18;\n        }\n    }\n    if(s16Flag===true || temp16 <1){\n        if(s1Flag!==true){\n            //temp1=global.get(\"temp1\");\n            global.set(\"temp16\",temp1);\n            global.set(\"hum16\",hum1);\n            temp16=temp1;\n            hum16=hum1;\n        }\n        else if(s2Flag!==true){\n            //temp2=global.get(\"temp2\");\n            global.set(\"temp16\",temp2);\n            global.set(\"hum16\",hum2);\n            temp16=temp2;\n            hum16=hum2;\n        }\n        else if(s3Flag!==true){\n            //temp3=global.get(\"temp3\");\n            global.set(\"temp16\",temp3);\n            global.set(\"hum16\",hum3);\n            temp16=temp3;\n            hum16=hum3;\n        }\n        else if(s4Flag!==true){\n            //temp4=global.get(\"temp4\");\n            global.set(\"temp16\",temp4);\n            global.set(\"hum16\",hum4);\n            temp16=temp4;\n            hum16=hum4;\n        }\n        else if(s5Flag!==true){\n            //temp5=global.get(\"temp5\");\n            global.set(\"temp16\",temp5);\n            global.set(\"hum16\",hum5);\n            temp16=temp5;\n            hum16=hum5;\n        }\n        else if(s6Flag!==true){\n            //temp6=global.get(\"temp6\");\n            global.set(\"temp16\",temp6);\n            global.set(\"hum16\",hum6);\n            temp16=temp6;\n            hum16=hum6;\n        }\n        else if(s7Flag!==true){\n            //temp7=global.get(\"temp7\");\n            global.set(\"temp16\",temp7);\n            global.set(\"hum16\",hum7);\n            temp16=temp7;\n            hum16=hum7;\n        }\n        else if(s8Flag!==true){\n            //temp8=global.get(\"temp8\");\n            global.set(\"temp16\",temp8);\n            global.set(\"hum16\",hum8);\n            temp16=temp8;\n            hum16=hum8;\n        }\n        else if(s9Flag!==true){\n            //temp9=global.get(\"temp9\");\n            global.set(\"temp16\",temp9);\n            global.set(\"hum16\",hum9);\n            temp16=temp9;\n            hum16=hum9;\n        }\n        else if(s10Flag!==true){\n            //temp10=global.get(\"temp10\");\n            global.set(\"temp16\",temp10);\n            global.set(\"hum16\",hum10);\n            temp16=temp10;\n            hum16=hum10;\n        }\n        else if(s11Flag!==true){\n            //temp11=global.get(\"temp11\");\n            global.set(\"temp16\",temp11);\n            global.set(\"hum16\",hum11);\n            temp16=temp11;\n            hum16=hum11;\n        }\n        else if(s12Flag!==true){\n            //temp12=global.get(\"temp12\");\n            global.set(\"temp16\",temp12);\n            global.set(\"hum16\",hum12);\n            temp16=temp12;\n            hum16=hum12;\n        }\n        else if(s13Flag!==true){\n            //temp13=global.get(\"temp13\");\n            global.set(\"temp16\",temp13);\n            global.set(\"hum16\",hum13);\n            temp16=temp13;\n            hum16=hum13;\n        }\n        else if(s14Flag!==true){\n            //temp14=global.get(\"temp14\");\n            global.set(\"temp16\",temp14);\n            global.set(\"hum16\",hum14);\n            temp16=temp14;\n            hum16=hum14;\n        }\n        else if(s15Flag!==true){\n            //temp15=global.get(\"temp15\");\n            global.set(\"temp16\",temp15);\n            global.set(\"hum16\",hum15);\n            temp16=temp15;\n            hum16=hum15;\n        }\n        else if(s17Flag!==true){\n            //temp17=global.get(\"temp17\");\n            global.set(\"temp16\",temp17);\n            global.set(\"hum16\",hum17);\n            temp16=temp17;\n            hum16=hum17;\n        }\n        else if(s18Flag!==true){\n            //temp18=global.get(\"temp18\");\n            global.set(\"temp16\",temp18);\n            global.set(\"hum16\",hum18);\n            temp16=temp18;\n            hum16=hum18;\n        }\n    }\n    if(s17Flag===true || temp17 <1){\n        if(s1Flag!==true){\n            //temp1=global.get(\"temp1\");\n            global.set(\"temp17\",temp1);\n            global.set(\"hum17\",hum1);\n            temp17=temp1;\n            hum17=hum1;\n        }\n        else if(s2Flag!==true){\n            //temp2=global.get(\"temp2\");\n            global.set(\"temp17\",temp2);\n            global.set(\"hum17\",hum2);\n            temp17=temp2;\n            hum17=hum2;\n        }\n        else if(s3Flag!==true){\n            //temp3=global.get(\"temp3\");\n            global.set(\"temp17\",temp3);\n            global.set(\"hum17\",hum3);\n            temp17=temp3;\n            hum17=hum3;\n        }\n        else if(s4Flag!==true){\n            //temp4=global.get(\"temp4\");\n            global.set(\"temp17\",temp4);\n            global.set(\"hum17\",hum4);\n            temp17=temp4;\n            hum17=hum4;\n        }\n        else if(s5Flag!==true){\n            //temp5=global.get(\"temp5\");\n            global.set(\"temp17\",temp5);\n            global.set(\"hum17\",hum5);\n            temp17=temp5;\n            hum17=hum5;\n        }\n        else if(s6Flag!==true){\n            //temp6=global.get(\"temp6\");\n            global.set(\"temp17\",temp6);\n            global.set(\"hum17\",hum6);\n            temp17=temp6;\n            hum17=hum6;\n        }\n        else if(s7Flag!==true){\n            //temp7=global.get(\"temp7\");\n            global.set(\"temp17\",temp7);\n            global.set(\"hum17\",hum7);\n            temp17=temp7;\n            hum17=hum7;\n        }\n        else if(s8Flag!==true){\n            //temp8=global.get(\"temp8\");\n            global.set(\"temp17\",temp8);\n            global.set(\"hum17\",hum8);\n            temp17=temp8;\n            hum17=hum8;\n        }\n        else if(s9Flag!==true){\n            //temp9=global.get(\"temp9\");\n            global.set(\"temp17\",temp9);\n            global.set(\"hum17\",hum9);\n            temp17=temp9;\n            hum17=hum9;\n        }\n        else if(s10Flag!==true){\n            //temp10=global.get(\"temp10\");\n            global.set(\"temp17\",temp10);\n            global.set(\"hum17\",hum10);\n            temp17=temp10;\n            hum17=hum10;\n        }\n        else if(s11Flag!==true){\n            //temp11=global.get(\"temp11\");\n            global.set(\"temp17\",temp11);\n            global.set(\"hum17\",hum11);\n            temp17=temp11;\n            hum17=hum11;\n        }\n        else if(s12Flag!==true){\n            //temp12=global.get(\"temp12\");\n            global.set(\"temp17\",temp12);\n            global.set(\"hum17\",hum12);\n            temp17=temp12;\n            hum17=hum12;\n        }\n        else if(s13Flag!==true){\n            //temp13=global.get(\"temp13\");\n            global.set(\"temp17\",temp13);\n            global.set(\"hum17\",hum13);\n            temp17=temp13;\n            hum17=hum13;\n        }\n        else if(s14Flag!==true){\n            //temp14=global.get(\"temp14\");\n            global.set(\"temp17\",temp14);\n            global.set(\"hum17\",hum14);\n            temp17=temp14;\n            hum17=hum14;\n        }\n        else if(s15Flag!==true){\n            //temp15=global.get(\"temp15\");\n            global.set(\"temp17\",temp15);\n            global.set(\"hum17\",hum15);\n            temp17=temp15;\n            hum17=hum15;\n        }\n        else if(s16Flag!==true){\n            //temp16=global.get(\"temp16\");\n            global.set(\"temp17\",temp16);\n            global.set(\"hum17\",hum16);\n            temp17=temp16;\n            hum17=hum16;\n        }\n        else if(s18Flag!==true){\n            //temp18=global.get(\"temp18\");\n            global.set(\"temp17\",temp18);\n            global.set(\"hum17\",hum18);\n            temp17=temp18;\n            hum17=hum18;\n        }\n    }\n    if(s18Flag===true || temp18 <1){\n        if(s1Flag!==true){\n            temp1=global.get(\"temp1\");\n            global.set(\"temp18\",temp1);\n            global.set(\"hum18\",hum1);\n            temp18=temp1;\n            hum18=hum1;\n        }\n        else if(s2Flag!==true){\n            //temp2=global.get(\"temp2\");\n            global.set(\"temp18\",temp2);\n            global.set(\"hum18\",hum2);\n            temp18=temp2;\n            hum18=hum2;\n        }\n        else if(s3Flag!==true){\n            //temp3=global.get(\"temp3\");\n            global.set(\"temp18\",temp3);\n            global.set(\"hum18\",hum3);\n            temp18=temp3;\n            hum18=hum3;\n        }\n        else if(s4Flag!==true){\n            //temp4=global.get(\"temp4\");\n            global.set(\"temp18\",temp4);\n            global.set(\"hum18\",hum4);\n            temp18=temp4;\n            hum18=hum4;\n        }\n        else if(s5Flag!==true){\n            //temp5=global.get(\"temp5\");\n            global.set(\"temp18\",temp5);\n            global.set(\"hum18\",hum5);\n            temp18=temp5;\n            hum18=hum5;\n        }\n        else if(s6Flag!==true){\n            //temp6=global.get(\"temp6\");\n            global.set(\"temp18\",temp6);\n            global.set(\"hum18\",hum6);\n            temp18=temp6;\n            hum18=hum6;\n        }\n        else if(s7Flag!==true){\n            //temp7=global.get(\"temp7\");\n            global.set(\"temp18\",temp7);\n            global.set(\"hum18\",hum7);\n            temp18=temp7;\n            hum18=hum7;\n        }\n        else if(s8Flag!==true){\n            //temp8=global.get(\"temp8\");\n            global.set(\"temp18\",temp8);\n            global.set(\"hum18\",hum8);\n            temp18=temp8;\n            hum18=hum8;\n        }\n        else if(s9Flag!==true){\n            //temp9=global.get(\"temp9\");\n            global.set(\"temp18\",temp9);\n            global.set(\"hum18\",hum9);\n            temp18=temp9;\n            hum18=hum9;\n        }\n        else if(s10Flag!==true){\n            //temp10=global.get(\"temp10\");\n            global.set(\"temp18\",temp10);\n            global.set(\"hum18\",hum10);\n            temp18=temp10;\n            hum18=hum10;\n        }\n        else if(s11Flag!==true){\n            //temp11=global.get(\"temp11\");\n            global.set(\"temp18\",temp11);\n            global.set(\"hum18\",hum11);\n            temp18=temp11;\n            hum18=hum11;\n        }\n        else if(s12Flag!==true){\n            //temp12=global.get(\"temp12\");\n            global.set(\"temp18\",temp12);\n            global.set(\"hum18\",hum12);\n            temp18=temp12;\n            hum18=hum12;\n        }\n        else if(s13Flag!==true){\n            //temp13=global.get(\"temp13\");\n            global.set(\"temp18\",temp13);\n            global.set(\"hum18\",hum13);\n            temp18=temp13;\n            hum18=hum13;\n        }\n        else if(s14Flag!==true){\n            //temp14=global.get(\"temp14\");\n            global.set(\"temp18\",temp14);\n            global.set(\"hum18\",hum14);\n            temp18=temp14;\n            hum18=hum14;\n        }\n        else if(s15Flag!==true){\n            //temp15=global.get(\"temp15\");\n            global.set(\"temp18\",temp15);\n            global.set(\"hum18\",hum15);\n            temp18=temp15;\n            hum18=hum15;\n        }\n        else if(s16Flag!==true){\n            //temp16=global.get(\"temp16\");\n            global.set(\"temp18\",temp16);\n            global.set(\"hum18\",hum16);\n            temp18=temp16;\n            hum18=hum16;\n        }\n        else if(s17Flag!==true){\n            //temp17=global.get(\"temp17\");\n            global.set(\"temp18\",temp17);\n            global.set(\"hum18\",hum17);\n            temp18=temp17;\n            hum18=hum17;\n        }\n    }\n}\ntemp=(temp1+temp2+temp3+temp4+temp5+temp6+temp7+temp8+temp9+temp10+temp11+temp12+temp13+temp14+temp15+temp16+temp17+temp18)/18;\ntemp=temp.toFixed(1);\nglobal.set(\"tempAvg\", temp);\n\nhum=(hum1+hum2+hum3+hum4+hum5+hum6+hum7+hum8+hum9+hum10+hum11+hum12+hum13+hum14+hum15+hum16+hum17+hum18)/18;\nhum=hum.toFixed(1);\nglobal.set(\"humAvg\", hum);\n\nmsg.payload={\"temp\":temp,\"hum\":hum};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1980,"y":1180,"wires":[["9e60dd2a.bc971"]]},{"id":"e9ac18e.c8eade8","type":"inject","z":"fd37fbb3.4259f8","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":true,"onceDelay":0.1,"topic":"","payload":"{\"Time\":\"2021-04-06T20:24:15\",\"SI7021\":{\"Temperature\":31,\"Humidity\":40,\"DewPoint\":20},\"TempUnit\":\"C\"}","payloadType":"str","x":2550,"y":1980,"wires":[["6c5ad644.ee14e8","e02418d6.a31848","f7e5d6aa.31efd8","3186b872.033fc8","993f81b6.d3e13","c253190c.28d3c8","97c3e4aa.374fb8","b325ac7c.02b56","9a0aa0ed.ff8e","d7390872.29f4a8","48a571e6.9d808","c26a6c21.817d3","b0fb3e69.9d95c","b9474ae4.bee098","3a3e029f.a5ab0e","883289e0.58e588","e8df9c32.92e03","51977354.352c1c"]]},{"id":"4ba55b02.0bdc54","type":"ui_chart","z":"fd37fbb3.4259f8","name":"Temperatures","group":"61c2c538.32dfbc","order":16,"width":8,"height":6,"label":"Temperatures °C","chartType":"line","legend":"true","xformat":"HH:mm:ss","interpolate":"linear","nodata":"","dot":false,"ymin":"","ymax":"","removeOlder":"4","removeOlderPoints":"","removeOlderUnit":"3600","cutout":0,"useOneColor":false,"useUTC":false,"colors":["#1f77b4","#680085","#ff7f0e","#2ca02c","#e6d200","#d62728","#ff9896","#000000","#001999"],"outputs":1,"useDifferentColor":false,"x":2480,"y":1600,"wires":[[]]},{"id":"3ade866d.eac8ba","type":"ui_chart","z":"fd37fbb3.4259f8","name":"Temperatures °C","group":"c32e4918.a723a8","order":16,"width":8,"height":6,"label":"Temperatures °C","chartType":"line","legend":"true","xformat":"HH:mm:ss","interpolate":"linear","nodata":"","dot":false,"ymin":"","ymax":"","removeOlder":"4","removeOlderPoints":"","removeOlderUnit":"3600","cutout":0,"useOneColor":false,"useUTC":false,"colors":["#1f77b4","#680085","#ff7f0e","#2ca02c","#e6d200","#d62728","#ff9896","#000000","#001999"],"outputs":1,"useDifferentColor":false,"x":3810,"y":1600,"wires":[[]]},{"id":"be9f7999.fa62a8","type":"ui_chart","z":"fd37fbb3.4259f8","name":"Air Humidity %","group":"c32e4918.a723a8","order":32,"width":8,"height":6,"label":"Air Humidity %","chartType":"line","legend":"true","xformat":"HH:mm:ss","interpolate":"linear","nodata":"","dot":false,"ymin":"","ymax":"","removeOlder":"4","removeOlderPoints":"","removeOlderUnit":"3600","cutout":0,"useOneColor":false,"useUTC":false,"colors":["#1f77b4","#680085","#ff7f0e","#2ca02c","#e6d200","#d62728","#ff9896","#000000","#001999"],"outputs":1,"useDifferentColor":false,"x":3800,"y":1700,"wires":[[]]},{"id":"51f38d08.14dca4","type":"ui_chart","z":"fd37fbb3.4259f8","name":"Air Humidity","group":"61c2c538.32dfbc","order":32,"width":8,"height":6,"label":"Air Humidity %","chartType":"line","legend":"true","xformat":"HH:mm:ss","interpolate":"linear","nodata":"","dot":false,"ymin":"","ymax":"","removeOlder":"4","removeOlderPoints":"","removeOlderUnit":"3600","cutout":0,"useOneColor":false,"useUTC":false,"colors":["#1f77b4","#680085","#ff7f0e","#2ca02c","#e6d200","#d62728","#ff9896","#000000","#001999"],"outputs":1,"useDifferentColor":false,"x":2490,"y":1700,"wires":[[]]},{"id":"ed12d808.8265b8","type":"function","z":"98e3ec9b.ecb6a","name":"","func":"//This is for test if selector was correctly configured\nfl1s = global.get(\"fl1_state\");\nfl1s = global.get(\"fl1_tr1\");\nfl2s = global.get(\"fl2_state\");\nfr3s = global.get(\"fr3_state\");\nfr4s = global.get(\"fr4_state\");\n\nfl2 = global.get(\"fanl2\");\n    title=fl2[2].isChecked;\n    if(title === \"TempRef1\"){\n        tr1state=fl2.isChecked;\n        //global.set(\"fl1_tr1\",tr1state);\n    }\n    \nobject=global.get(\"temp2humstate\");\nf=global.get(\"temp2hum\");\n\nfl1=global.get(\"fl1cs\");\nmsg.payload=fl1;\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2370,"y":3120,"wires":[["bd6d8d61.517f5"]]},{"id":"e0f825d1.921ef8","type":"inject","z":"98e3ec9b.ecb6a","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":2090,"y":3160,"wires":[["ed12d808.8265b8"]]},{"id":"bd6d8d61.517f5","type":"debug","z":"98e3ec9b.ecb6a","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":2600,"y":3180,"wires":[]},{"id":"2146f122.b46b8e","type":"debug","z":"359ed2dc.ceea6e","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":2690,"y":1940,"wires":[]},{"id":"66c79a0e.21e484","type":"rpi-gpio out","z":"359ed2dc.ceea6e","name":"","pin":"31","set":true,"level":"0","freq":"","out":"out","x":2960,"y":2020,"wires":[]},{"id":"bad68f87.10b36","type":"rpi-gpio out","z":"359ed2dc.ceea6e","name":"","pin":"33","set":true,"level":"0","freq":"","out":"out","x":2960,"y":2080,"wires":[]},{"id":"2e6a13e5.c8667c","type":"rpi-gpio out","z":"359ed2dc.ceea6e","name":"","pin":"36","set":true,"level":"0","freq":"","out":"out","x":2960,"y":2140,"wires":[]},{"id":"c2d98c64.baea","type":"function","z":"359ed2dc.ceea6e","name":"Intialize cooler selector box","func":"\nstatus=global.get(\"status\");\nif (status==\"ACTIVE\"){\n    msg={enabled: false, background: \"transparent\", payload:global.get(\"temp2humstate\")}\n    connect = global.get(\"temp2humstate\");\n    global.set(\"temp2hum\",connect[0].isChecked);\n    return msg;\n}else{\n    msg={enabled: true, payload:global.get(\"temp2humstate\")}\n    return msg;\n}\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2440,"y":2760,"wires":[["f8ccee5f.ad5aa","aca1866f.4206c8"]]},{"id":"15c61a7b.21e2d6","type":"inject","z":"359ed2dc.ceea6e","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":true,"onceDelay":"5","topic":"","payload":"","payloadType":"date","x":2110,"y":2700,"wires":[["dbd02f1.0e804d","bbb1de15.83319","6fb98b4b.f0b004"]]},{"id":"42c43f60.5ab74","type":"debug","z":"359ed2dc.ceea6e","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":3110,"y":2700,"wires":[]},{"id":"d912a0c6.5b47","type":"function","z":"359ed2dc.ceea6e","name":"Save into database","func":"//This function will save into database the selection set by user in\n//dashboard\nfr4 = msg.payload;\ntemp2hum=fr4.isChecked;\nglobal.set(\"temp2hum\",temp2hum);\ntemp2hums = [{\"title\":\"Connect Cooling System ? (T+3)\",\"isChecked\":temp2hum}]\nglobal.set(\"temp2humstate\",temp2hums);\nmsg.payload = temp2hums;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2910,"y":2700,"wires":[["42c43f60.5ab74","1a558da4.043e82"]]},{"id":"aca1866f.4206c8","type":"debug","z":"359ed2dc.ceea6e","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":2830,"y":2760,"wires":[]},{"id":"dbd02f1.0e804d","type":"function","z":"359ed2dc.ceea6e","name":"","func":"    //Cooling System\n    global.set(\"temp2hum\",true);\n    temp2hum = [{\"title\":\"Connect Cooling System ? (T+3)\",\"isChecked\":true}]\n    global.set(\"temp2humstate\",temp2hum);\n    global.set(\"auto_restart\",true);\n    msg.payload = temp2hum;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2500,"y":2700,"wires":[["f8ccee5f.ad5aa"]]},{"id":"16c80095.a07d0f","type":"inject","z":"359ed2dc.ceea6e","d":true,"name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"60","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":2070,"y":2760,"wires":[["c2d98c64.baea"]]},{"id":"970a1816.cc7a48","type":"debug","z":"359ed2dc.ceea6e","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":2770,"y":2840,"wires":[]},{"id":"42b24a28.199614","type":"debug","z":"359ed2dc.ceea6e","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":2870,"y":2940,"wires":[]},{"id":"41d7878a.72e1f8","type":"comment","z":"359ed2dc.ceea6e","name":"Cooling System","info":"","x":2590,"y":2840,"wires":[]},{"id":"c9507dff.bcbfa","type":"rpi-gpio out","z":"359ed2dc.ceea6e","name":"","pin":"35","set":true,"level":"0","freq":"","out":"out","x":3240,"y":2860,"wires":[]},{"id":"c47bb076.a795b","type":"rpi-gpio out","z":"359ed2dc.ceea6e","name":"","pin":"38","set":true,"level":"0","freq":"","out":"out","x":3240,"y":2920,"wires":[]},{"id":"6cdbb6c4.742018","type":"rpi-gpio out","z":"359ed2dc.ceea6e","name":"","pin":"40","set":true,"level":"0","freq":"","out":"out","x":3240,"y":2980,"wires":[]},{"id":"c57ceedb.f3fb5","type":"rpi-gpio out","z":"359ed2dc.ceea6e","name":"","pin":"37","set":true,"level":"0","freq":"","out":"out","x":3240,"y":3040,"wires":[]},{"id":"f354b637.f2d448","type":"comment","z":"359ed2dc.ceea6e","name":"Cooling Valve","info":"","x":3390,"y":2860,"wires":[]},{"id":"feb27dce.daf14","type":"comment","z":"359ed2dc.ceea6e","name":"2","info":"","x":3370,"y":2920,"wires":[]},{"id":"9fec23c4.d148d","type":"comment","z":"359ed2dc.ceea6e","name":"3","info":"","x":3370,"y":2980,"wires":[]},{"id":"a2de757d.066648","type":"comment","z":"359ed2dc.ceea6e","name":"4","info":"","x":3370,"y":3040,"wires":[]},{"id":"5232725a.20502c","type":"function","z":"359ed2dc.ceea6e","name":"","func":"//Control the pin output in the raspberry to turn on or off\n//the cooling system in based of the schedule set by user\npayload = msg.payload;\nstatus=global.get(\"status\");\nglobal.get(\"cState\");    //cState=\"ON\";\ncnt_cool_tofans=global.get(\"temp2hum\");\nfRef=global.get(\"fRef\");\ntemp=global.get(\"tempAvg\");\n//note to if user selected that cooling system must be work\n//on base of temperature control.\n//the cooling system will be activated if the temperature\n//is 3°C above from reference in that period of time\n//you can change the number 3 for more or less regarding your need\nif ((temp>fRef+3 && cnt_cool_tofans === true && status==\"ACTIVE\") || (payload == true && status==\"ACTIVE\")){\n    msg1 = {payload: 1};   //msg.alarm=1;\n    msg2 = {payload: \"ACTIVATED\"}; \n    global.set(\"cooling_state\",true);\n}else{\n    msg1 = {payload: 0};   //msg.alarm=1;\n    msg2 = {payload: \"DEACTIVATED\"};\n    global.set(\"cooling_state\",false);\n}\nreturn [msg1, msg2];","outputs":2,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2660,"y":2980,"wires":[["42b24a28.199614","9f9de43.4fff218","c9507dff.bcbfa"],["db907026.ffc9d"]]},{"id":"7f70e569.7cbeac","type":"function","z":"359ed2dc.ceea6e","name":"","func":"//Get the programming set by user for the cooler system\np = msg.payload;\nglobal.set(\"Csprog\",p);//Cooling system programming\nmsg.payload = p;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2540,"y":2940,"wires":[["970a1816.cc7a48"]]},{"id":"bbb1de15.83319","type":"function","z":"359ed2dc.ceea6e","name":"","func":"//Set initial state to the cooling system in false till\n//information be obtained from MySQL or set by user in dashboard\nmsg.payload='{\"timers\":[],\"settings\":{}}';\nglobal.set(\"cooling_state\",false);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2140,"y":2960,"wires":[["c6165ea8.9b2a9","e5858568.975478"]]},{"id":"f6d2645b.6304b8","type":"function","z":"359ed2dc.ceea6e","name":"Intialize cooler scheduler in dashboard","func":"//get programming of the scheduler to cooler system\n//be used based on defined by user limits of day and time\n//this can be extracted from dashboard or MySQL depending if\n//there is an update in configurations or some unexpected reboot respectively\nstatus=global.get(\"status\");\nif (status==\"ACTIVE\"){\n    prog = global.get(\"Csprog\");\n    if(prog === undefined){\n        global.set(\"Csprog\",{\"timers\":[],\"settings\":{}});\n    }\n    msg.payload=global.get(\"Csprog\");\n    return msg;\n}else if(status!=\"ACTIVE\"){\n    msg.payload = '{\"timers\":[],\"settings\":{}}';\n    return msg;\n}\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2110,"y":3040,"wires":[["c6165ea8.9b2a9","ca2dcb98.a74748"]]},{"id":"6803ce40.cc89b","type":"inject","z":"359ed2dc.ceea6e","d":true,"name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"10","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":1850,"y":3060,"wires":[["f6d2645b.6304b8"]]},{"id":"e5858568.975478","type":"debug","z":"359ed2dc.ceea6e","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":2370,"y":2860,"wires":[]},{"id":"cb4229c6.350c48","type":"debug","z":"359ed2dc.ceea6e","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":2410,"y":2900,"wires":[]},{"id":"d466709b.18c08","type":"inject","z":"359ed2dc.ceea6e","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"1","payloadType":"num","x":3050,"y":2900,"wires":[["c47bb076.a795b","6cdbb6c4.742018","c57ceedb.f3fb5"]]},{"id":"dc8a43b5.5a5e2","type":"inject","z":"359ed2dc.ceea6e","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"0","payloadType":"num","x":3050,"y":2980,"wires":[["c47bb076.a795b","6cdbb6c4.742018","c57ceedb.f3fb5"]]},{"id":"ca2dcb98.a74748","type":"debug","z":"359ed2dc.ceea6e","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":2370,"y":3060,"wires":[]},{"id":"24d95530.b94e7a","type":"ui_switch","z":"359ed2dc.ceea6e","name":"","label":"Manual Activation","tooltip":"","group":"ed07161e.0a9588","order":17,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"","style":"","onvalue":"true","onvalueType":"bool","onicon":"","oncolor":"","offvalue":"false","offvalueType":"bool","officon":"","offcolor":"","x":2410,"y":3120,"wires":[["376989ec.deb256","d7b3614a.23cbb"]]},{"id":"6fb98b4b.f0b004","type":"function","z":"359ed2dc.ceea6e","name":"Initialize the manual activation","func":"msg.payload = false;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2090,"y":3140,"wires":[["24d95530.b94e7a"]]},{"id":"db907026.ffc9d","type":"ui_text","z":"359ed2dc.ceea6e","group":"7b3878b4.914658","order":5,"width":0,"height":0,"name":"","label":"Cooling System State","format":"{{msg.payload}}","layout":"row-spread","x":2860,"y":3000,"wires":[]},{"id":"3cc0c22b.4e2f2e","type":"function","z":"359ed2dc.ceea6e","name":"Get fref from MySQL","func":"msg.payload = global.get(\"fRef1\"); \nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2480,"y":2360,"wires":[["acdc9535.b56728"]]},{"id":"398c3cb4.0fb274","type":"function","z":"359ed2dc.ceea6e","name":"Get fref from MySQL","func":"msg.payload=global.get(\"fRef2\"); \nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2480,"y":2400,"wires":[["a354006d.fe73b"]]},{"id":"bc105f72.fd362","type":"function","z":"359ed2dc.ceea6e","name":"Get fref from MySQL","func":"msg.payload=global.get(\"fRef3\"); \nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2480,"y":2440,"wires":[["ae3de619.136ef8"]]},{"id":"3e342938.04d666","type":"mqtt in","z":"fd37fbb3.4259f8","name":"","topic":"tele/six_last_mac/SENSOR","qos":"2","datatype":"auto","broker":"c628a29f.96a78","nl":false,"rap":false,"x":1610,"y":1700,"wires":[["2bef088c.79aac8","fafcac7.f43ed5"]]},{"id":"8a4918b.ed770e8","type":"mqtt in","z":"fd37fbb3.4259f8","name":"","topic":"tele/six_last_mac/SENSOR","qos":"2","datatype":"auto","broker":"c628a29f.96a78","nl":false,"rap":false,"x":1630,"y":2080,"wires":[["7c3ae785.daf358","9fd69143.b0cb8"]]},{"id":"9ad95e67.75cfe","type":"mqtt in","z":"fd37fbb3.4259f8","name":"","topic":"tele/six_last_mac/SENSOR","qos":"2","datatype":"auto","broker":"c628a29f.96a78","nl":false,"rap":false,"x":1610,"y":1320,"wires":[["7ad42aeb.379044","d7ef21d6.2ff41"]]},{"id":"7ad42aeb.379044","type":"trigger","z":"fd37fbb3.4259f8","name":"","op1":"","op2":"sensor1Fail","op1type":"nul","op2type":"str","duration":"5","extend":true,"overrideDelay":false,"units":"min","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":1630,"y":1360,"wires":[["d7ef21d6.2ff41"]]},{"id":"2bef088c.79aac8","type":"trigger","z":"fd37fbb3.4259f8","name":"","op1":"","op2":"sensor4Fail","op1type":"nul","op2type":"str","duration":"5","extend":true,"overrideDelay":false,"units":"min","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":1630,"y":1740,"wires":[["fafcac7.f43ed5"]]},{"id":"7c3ae785.daf358","type":"trigger","z":"fd37fbb3.4259f8","name":"","op1":"","op2":"sensor7Fail","op1type":"nul","op2type":"str","duration":"5","extend":true,"overrideDelay":false,"units":"min","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":1650,"y":2120,"wires":[["9fd69143.b0cb8"]]},{"id":"af6a73ef.b5129","type":"mqtt in","z":"fd37fbb3.4259f8","name":"","topic":"tele/six_last_mac/SENSOR","qos":"2","datatype":"auto","broker":"c628a29f.96a78","nl":false,"rap":false,"x":1650,"y":1840,"wires":[["d6c9dc0c.1278c","49995189.0e516"]]},{"id":"1e4af592.57bc9a","type":"mqtt in","z":"fd37fbb3.4259f8","name":"","topic":"tele/six_last_mac/SENSOR","qos":"2","datatype":"auto","broker":"c628a29f.96a78","nl":false,"rap":false,"x":1670,"y":2220,"wires":[["af824f5f.4f7eb","8d743407.a2ee68"]]},{"id":"5090769.4ea9f88","type":"mqtt in","z":"fd37fbb3.4259f8","name":"","topic":"tele/six_last_mac/SENSOR","qos":"2","datatype":"auto","broker":"c628a29f.96a78","nl":false,"rap":false,"x":1650,"y":1460,"wires":[["d634139b.19a57","ff76d941.946df8"]]},{"id":"d634139b.19a57","type":"trigger","z":"fd37fbb3.4259f8","name":"","op1":"","op2":"sensor2Fail","op1type":"nul","op2type":"str","duration":"5","extend":true,"overrideDelay":false,"units":"min","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":1670,"y":1500,"wires":[["ff76d941.946df8"]]},{"id":"d6c9dc0c.1278c","type":"trigger","z":"fd37fbb3.4259f8","name":"","op1":"","op2":"sensor5Fail","op1type":"nul","op2type":"str","duration":"5","extend":true,"overrideDelay":false,"units":"min","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":1670,"y":1880,"wires":[["49995189.0e516"]]},{"id":"af824f5f.4f7eb","type":"trigger","z":"fd37fbb3.4259f8","name":"","op1":"","op2":"sensor8Fail","op1type":"nul","op2type":"str","duration":"5","extend":true,"overrideDelay":false,"units":"min","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":1690,"y":2260,"wires":[["8d743407.a2ee68"]]},{"id":"ee76312e.8cc7b","type":"mqtt in","z":"fd37fbb3.4259f8","name":"","topic":"tele/six_last_mac/SENSOR","qos":"2","datatype":"auto","broker":"c628a29f.96a78","nl":false,"rap":false,"x":1650,"y":1980,"wires":[["7b4e94a.74da36c","a1f54f09.fbcb1"]]},{"id":"15aeaaa9.a03985","type":"mqtt in","z":"fd37fbb3.4259f8","name":"","topic":"tele/six_last_mac/SENSOR","qos":"2","datatype":"auto","broker":"c628a29f.96a78","nl":false,"rap":false,"x":1650,"y":2340,"wires":[["22c41ed9.ab9732","1b49f683.af82f9"]]},{"id":"ea1d0223.a1ab9","type":"mqtt in","z":"fd37fbb3.4259f8","name":"","topic":"tele/six_last_mac/SENSOR","qos":"2","datatype":"auto","broker":"c628a29f.96a78","nl":false,"rap":false,"x":1650,"y":1600,"wires":[["4917fd6d.ff3c04","a49a6f41.1fb0e"]]},{"id":"4917fd6d.ff3c04","type":"trigger","z":"fd37fbb3.4259f8","name":"","op1":"","op2":"sensor3Fail","op1type":"nul","op2type":"str","duration":"5","extend":true,"overrideDelay":false,"units":"min","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":1670,"y":1640,"wires":[["a49a6f41.1fb0e"]]},{"id":"7b4e94a.74da36c","type":"trigger","z":"fd37fbb3.4259f8","name":"","op1":"","op2":"sensor6Fail","op1type":"nul","op2type":"str","duration":"5","extend":true,"overrideDelay":false,"units":"min","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":1670,"y":2020,"wires":[["a1f54f09.fbcb1"]]},{"id":"22c41ed9.ab9732","type":"trigger","z":"fd37fbb3.4259f8","name":"","op1":"","op2":"sensor9Fail","op1type":"nul","op2type":"str","duration":"5","extend":true,"overrideDelay":false,"units":"min","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":1670,"y":2380,"wires":[["1b49f683.af82f9"]]},{"id":"ad16a512.cf0648","type":"mqtt in","z":"fd37fbb3.4259f8","name":"","topic":"tele/six_last_mac/SENSOR","qos":"2","datatype":"auto","broker":"c628a29f.96a78","nl":false,"rap":false,"x":2810,"y":1700,"wires":[["b0fb3e69.9d95c","e02418d6.a31848"]]},{"id":"bd5cd523.3360d8","type":"mqtt in","z":"fd37fbb3.4259f8","name":"","topic":"tele/six_last_mac/SENSOR","qos":"2","datatype":"auto","broker":"c628a29f.96a78","nl":false,"rap":false,"x":2810,"y":2060,"wires":[["883289e0.58e588","f7e5d6aa.31efd8"]]},{"id":"53653c87.0b2434","type":"mqtt in","z":"fd37fbb3.4259f8","name":"","topic":"tele/six_last_mac/SENSOR","qos":"2","datatype":"auto","broker":"c628a29f.96a78","nl":false,"rap":false,"x":2810,"y":1320,"wires":[["d7390872.29f4a8","6c5ad644.ee14e8"]]},{"id":"d7390872.29f4a8","type":"trigger","z":"fd37fbb3.4259f8","name":"","op1":"","op2":"sensor10Fail","op1type":"nul","op2type":"str","duration":"5","extend":true,"overrideDelay":false,"units":"min","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":2830,"y":1360,"wires":[["6c5ad644.ee14e8"]]},{"id":"b0fb3e69.9d95c","type":"trigger","z":"fd37fbb3.4259f8","name":"","op1":"","op2":"sensor13Fail","op1type":"nul","op2type":"str","duration":"5","extend":true,"overrideDelay":false,"units":"min","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":2830,"y":1740,"wires":[["e02418d6.a31848"]]},{"id":"883289e0.58e588","type":"trigger","z":"fd37fbb3.4259f8","name":"","op1":"","op2":"sensor16Fail","op1type":"nul","op2type":"str","duration":"5","extend":true,"overrideDelay":false,"units":"min","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":2830,"y":2100,"wires":[["f7e5d6aa.31efd8"]]},{"id":"146dc25a.34658e","type":"mqtt in","z":"fd37fbb3.4259f8","name":"","topic":"tele/six_last_mac/SENSOR","qos":"2","datatype":"auto","broker":"c628a29f.96a78","nl":false,"rap":false,"x":2830,"y":1860,"wires":[["b9474ae4.bee098","993f81b6.d3e13"]]},{"id":"3988734c.75654c","type":"mqtt in","z":"fd37fbb3.4259f8","name":"","topic":"tele/six_last_mac/SENSOR","qos":"2","datatype":"auto","broker":"c628a29f.96a78","nl":false,"rap":false,"x":2830,"y":2220,"wires":[["e8df9c32.92e03","c253190c.28d3c8"]]},{"id":"83de4d5c.f3f71","type":"mqtt in","z":"fd37fbb3.4259f8","name":"","topic":"tele/six_last_mac/SENSOR","qos":"2","datatype":"auto","broker":"c628a29f.96a78","nl":false,"rap":false,"x":2810,"y":1480,"wires":[["48a571e6.9d808","3186b872.033fc8"]]},{"id":"48a571e6.9d808","type":"trigger","z":"fd37fbb3.4259f8","name":"","op1":"","op2":"sensor11Fail","op1type":"nul","op2type":"str","duration":"5","extend":true,"overrideDelay":false,"units":"min","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":2850,"y":1520,"wires":[["3186b872.033fc8"]]},{"id":"b9474ae4.bee098","type":"trigger","z":"fd37fbb3.4259f8","name":"","op1":"","op2":"sensor14Fail","op1type":"nul","op2type":"str","duration":"5","extend":true,"overrideDelay":false,"units":"min","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":2850,"y":1900,"wires":[["993f81b6.d3e13"]]},{"id":"e8df9c32.92e03","type":"trigger","z":"fd37fbb3.4259f8","name":"","op1":"","op2":"sensor17Fail","op1type":"nul","op2type":"str","duration":"5","extend":true,"overrideDelay":false,"units":"min","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":2850,"y":2260,"wires":[["c253190c.28d3c8"]]},{"id":"848bc9aa.a1e348","type":"mqtt in","z":"fd37fbb3.4259f8","name":"","topic":"tele/six_last_mac/SENSOR","qos":"2","datatype":"auto","broker":"c628a29f.96a78","nl":false,"rap":false,"x":2810,"y":1980,"wires":[["3a3e029f.a5ab0e","b325ac7c.02b56"]]},{"id":"65f05613.e27aa8","type":"mqtt in","z":"fd37fbb3.4259f8","name":"","topic":"tele/six_last_mac/SENSOR","qos":"2","datatype":"auto","broker":"c628a29f.96a78","nl":false,"rap":false,"x":2830,"y":2340,"wires":[["51977354.352c1c","9a0aa0ed.ff8e"]]},{"id":"b73ba0ac.c963c","type":"mqtt in","z":"fd37fbb3.4259f8","name":"","topic":"tele/six_last_mac/SENSOR","qos":"2","datatype":"auto","broker":"c628a29f.96a78","nl":false,"rap":false,"x":2810,"y":1620,"wires":[["c26a6c21.817d3","97c3e4aa.374fb8"]]},{"id":"c26a6c21.817d3","type":"trigger","z":"fd37fbb3.4259f8","name":"","op1":"","op2":"sensor12Fail","op1type":"nul","op2type":"str","duration":"5","extend":true,"overrideDelay":false,"units":"min","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":2830,"y":1660,"wires":[["97c3e4aa.374fb8"]]},{"id":"3a3e029f.a5ab0e","type":"trigger","z":"fd37fbb3.4259f8","name":"","op1":"","op2":"sensor15Fail","op1type":"nul","op2type":"str","duration":"5","extend":true,"overrideDelay":false,"units":"min","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":2830,"y":2020,"wires":[["b325ac7c.02b56"]]},{"id":"51977354.352c1c","type":"trigger","z":"fd37fbb3.4259f8","name":"","op1":"","op2":"sensor18Fail","op1type":"nul","op2type":"str","duration":"5","extend":true,"overrideDelay":false,"units":"min","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":2850,"y":2380,"wires":[["9a0aa0ed.ff8e"]]},{"id":"6926f20d.ee2d4c","type":"function","z":"fd37fbb3.4259f8","name":"Initialize sensor state flags","func":"s1Flag=global.get(\"s1Flag\");s10Flag=global.get(\"s10Flag\");\ns2Flag=global.get(\"s2Flag\");s11Flag=global.get(\"s11Flag\");\ns3Flag=global.get(\"s3Flag\");s12Flag=global.get(\"s12Flag\");\ns4Flag=global.get(\"s4Flag\");s13Flag=global.get(\"s13Flag\");\ns5Flag=global.get(\"s5Flag\");s14Flag=global.get(\"s14Flag\");\ns6Flag=global.get(\"s6Flag\");s15Flag=global.get(\"s15Flag\");\ns7Flag=global.get(\"s7Flag\");s16Flag=global.get(\"s16Flag\");\ns8Flag=global.get(\"s8Flag\");s17Flag=global.get(\"s17Flag\");\ns9Flag=global.get(\"s9Flag\");s18Flag=global.get(\"s18Flag\");\ntemp = global.get(\"temp2\");\nmsg.payload = s1Flag;\n//msg.payload = temp;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1820,"y":900,"wires":[["21e974fe.75079c"]]},{"id":"5b7d446c.ae513c","type":"inject","z":"fd37fbb3.4259f8","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":1480,"y":880,"wires":[["6926f20d.ee2d4c"]]},{"id":"21e974fe.75079c","type":"debug","z":"fd37fbb3.4259f8","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":2110,"y":900,"wires":[]},{"id":"cd98931b.78f64","type":"function","z":"359ed2dc.ceea6e","name":"fTime&fRef limits control","func":"//User can set the reference values for temperature control\n//fref1 = Temperature during the day\n//fref2 = Temperature to step change and prevent high gradient rate\n//fref3 = Temperature during the night\ntime=global.get(\"gTime\");   //time=\"08:05:11\"\nhoursMinutes = time.split(/[.:]/);  //3 separated string parts H:M:S\nhours = hoursMinutes[0];    //first part of the string\nminutes = hoursMinutes[1];  //second part of the string\ncTime = `${hours}${minutes}`;    //Current Time\ncTime = parseInt(cTime,10); //Integer val\n\n\nfRef1=global.get(\"fRef1\");\nfRef2=global.get(\"fRef2\");\nfRef3=global.get(\"fRef3\");\n\n//fRef1=30; fRef2=29; fRef3=28;\n\n//The next line is for define the day and night limits\n//between fTime2 and fTime 3 is day\n//between fTime4 and fTime1 is night\n//between fTime1 and fTime2 & fTime3 and fTime4 are the steps,\n//where the temperature should be set in a middle point to do not\n//apply high changes directly to the plants\n\nfTime1=600; fTime2=700; fTime3=1800; fTime4=1930;\n\nif (cTime >= fTime1 && cTime < fTime2){\n    global.set(\"fRef\", fRef2);\n    fl1s = global.get(\"fl1_tr2\");\n    fl2s = global.get(\"fl2_tr2\");\n    fr3s = global.get(\"fr3_tr2\");\n    fr4s = global.get(\"fr4_tr2\");\n    global.set(\"fl1_state\",fl1s);\n    global.set(\"fl2_state\",fl2s);\n    global.set(\"fr3_state\",fr3s);\n    global.set(\"fr4_state\",fr4s);\n    msg1 = {topic: \"fTime1\", payload: fRef2};\n    return msg1;\n}else if (cTime >= fTime2 && cTime < fTime3){\n    global.set(\"fRef\", fRef1);\n    fl1s = global.get(\"fl1_tr1\");\n    fl2s = global.get(\"fl2_tr1\");\n    fr3s = global.get(\"fr3_tr1\");\n    fr4s = global.get(\"fr4_tr1\");\n    global.set(\"fl1_state\",fl1s);\n    global.set(\"fl2_state\",fl2s);\n    global.set(\"fr3_state\",fr3s);\n    global.set(\"fr4_state\",fr4s);\n    msg2 = {topic: \"fTime2\", payload: fRef1};\n    return msg2;\n}else if (cTime >= fTime3 && cTime < fTime4){\n    global.set(\"fRef\", fRef2);\n    fl1s = global.get(\"fl1_tr2\");\n    fl2s = global.get(\"fl2_tr2\");\n    fr3s = global.get(\"fr3_tr2\");\n    fr4s = global.get(\"fr4_tr2\");\n    global.set(\"fl1_state\",fl1s);\n    global.set(\"fl2_state\",fl2s);\n    global.set(\"fr3_state\",fr3s);\n    global.set(\"fr4_state\",fr4s);\n    msg3 = {topic: \"fTime3\", payload: fRef2};\n    return msg3;\n}else if (cTime >= fTime4 || cTime < fTime1){\n    global.set(\"fRef\", fRef3);\n    fl1s = global.get(\"fl1_tr3\");\n    fl2s = global.get(\"fl2_tr3\");\n    fr3s = global.get(\"fr3_tr3\");\n    fr4s = global.get(\"fr4_tr3\");\n    global.set(\"fl1_state\",fl1s);\n    global.set(\"fl2_state\",fl2s);\n    global.set(\"fr3_state\",fr3s);\n    global.set(\"fr4_state\",fr4s);\n    msg4 = {topic: \"fTime4\", payload: fRef3};\n    return msg4;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2170,"y":2080,"wires":[["18c32414.9c804c","91426602.66cff8"]]},{"id":"d9a48616.b56048","type":"inject","z":"359ed2dc.ceea6e","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"60","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":1980,"y":1980,"wires":[["cd98931b.78f64"]]},{"id":"91426602.66cff8","type":"debug","z":"359ed2dc.ceea6e","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":2230,"y":1980,"wires":[]},{"id":"4cbedffa.4b5a1","type":"debug","z":"fd37fbb3.4259f8","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":2270,"y":1100,"wires":[]},{"id":"ef10eac5.3bf0b8","type":"debug","z":"9bcfa612.592b38","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":2620,"y":2260,"wires":[]},{"id":"84e75cf8.f9e6c","type":"function","z":"9bcfa612.592b38","name":"DataSensor10","func":"date = global.get(\"gDate\");\ntime = global.get(\"gTime\");\n\n// DATA table\ncrop=global.get(\"crop\");\ntrial=global.get(\"trial\");\nlocation=global.get(\"location\");\nauthor=global.get(\"author\");\nemail=global.get(\"email\");\nphone=global.get(\"phone\");\n\n//Sensor\nsensor=\"sensor10\";\ntemp=global.get(\"temp10\");\nhum=global.get(\"hum10\");\ndew=global.get(\"dew10\");\n//Alerts\ntempalert=global.get(\"tempalert\");\nhumalert=global.get(\"humalert\");\n\nfref=global.get(\"fRef\");\n\nquery = \"INSERT INTO DATA (DATE,TIME,CROP,TRIAL,LOCATION,AUTHOR,EMAIL,PHONE,SENSOR,TEMPERATURE,HUMIDITY,DEWPOINT,TEMPALERT,HUMALERT,TREF)\";\nquery = query + \"VALUES ('\" + date + \"','\" + time + \"','\" + crop + \"','\" + trial + \"','\" + location + \"','\" + author + \"','\" + email + \"','\" + phone + \"','\";\nquery = query + sensor + \"','\" + temp + \"','\" + hum + \"','\" + dew + \"','\";\nquery = query + tempalert + \"','\" + humalert + \"','\" + fref + \"');\";\n\n//ID int auto_increment,DATE varchar(255),TIME varchar(255),CROP varchar(255),TRIAL varchar(255),LOCATION varchar(255),AUTHOR varchar(255),EMAIL varchar(255),PHONE INT,SENSOR varchar(255),TEMPERATURE double,HUMIDITY double,DEWPOINT double,TEMPALERT double,HUMALERT double,TREF double,primary key(ID)\n\n\ncsv = (`${date}, ${time}, ${sensor}, ${temp}, ${hum}, ${dew}, ${tempalert}, ${humalert}, ${fref}`);\n//if(status==\"ACTIVE\"){\n//    msg1 = {topic : query, payload: csv};\n//    return msg1;\n//}else{\n    //return null;\n    msg1 = {topic : query, payload: csv};\n    return msg1;\n//}","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2300,"y":2620,"wires":[["4e81bae3.0e1ac4","d6e54600.11f788"]]},{"id":"75a1dcf8.982434","type":"function","z":"9bcfa612.592b38","name":"DataSensor11","func":"date = global.get(\"gDate\");\ntime = global.get(\"gTime\");\n\n// DATA table\ncrop=global.get(\"crop\");\ntrial=global.get(\"trial\");\nlocation=global.get(\"location\");\nauthor=global.get(\"author\");\nemail=global.get(\"email\");\nphone=global.get(\"phone\");\n\n//Sensor\nsensor=\"sensor11\";\ntemp=global.get(\"temp11\");\nhum=global.get(\"hum11\");\ndew=global.get(\"dew11\");\n//Alerts\ntempalert=global.get(\"tempalert\");\nhumalert=global.get(\"humalert\");\n\nfref=global.get(\"fRef\");\n\nquery = \"INSERT INTO DATA (DATE,TIME,CROP,TRIAL,LOCATION,AUTHOR,EMAIL,PHONE,SENSOR,TEMPERATURE,HUMIDITY,DEWPOINT,TEMPALERT,HUMALERT,TREF)\";\nquery = query + \"VALUES ('\" + date + \"','\" + time + \"','\" + crop + \"','\" + trial + \"','\" + location + \"','\" + author + \"','\" + email + \"','\" + phone + \"','\";\nquery = query + sensor + \"','\" + temp + \"','\" + hum + \"','\" + dew + \"','\";\nquery = query + tempalert + \"','\" + humalert + \"','\" + fref + \"');\";\n\n//ID int auto_increment,DATE varchar(255),TIME varchar(255),CROP varchar(255),TRIAL varchar(255),LOCATION varchar(255),AUTHOR varchar(255),EMAIL varchar(255),PHONE INT,SENSOR varchar(255),TEMPERATURE double,HUMIDITY double,DEWPOINT double,TEMPALERT double,HUMALERT double,TREF double,primary key(ID)\n\n\ncsv = (`${date}, ${time}, ${sensor}, ${temp}, ${hum}, ${dew}, ${tempalert}, ${humalert}, ${fref}`);\n//if(status==\"ACTIVE\"){\n//    msg1 = {topic : query, payload: csv};\n//    return msg1;\n//}else{\n    //return null;\n    msg1 = {topic : query, payload: csv};\n    return msg1;\n//}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2300,"y":2660,"wires":[["4e81bae3.0e1ac4","d6e54600.11f788"]]},{"id":"a0ff28a3.d2a108","type":"function","z":"9bcfa612.592b38","name":"DataSensor12","func":"date = global.get(\"gDate\");\ntime = global.get(\"gTime\");\n\n// DATA table\ncrop=global.get(\"crop\");\ntrial=global.get(\"trial\");\nlocation=global.get(\"location\");\nauthor=global.get(\"author\");\nemail=global.get(\"email\");\nphone=global.get(\"phone\");\n\n//Sensor\nsensor=\"sensor12\";\ntemp=global.get(\"temp12\");\nhum=global.get(\"hum12\");\ndew=global.get(\"dew12\");\n//Alerts\ntempalert=global.get(\"tempalert\");\nhumalert=global.get(\"humalert\");\n\nfref=global.get(\"fRef\");\n\nquery = \"INSERT INTO DATA (DATE,TIME,CROP,TRIAL,LOCATION,AUTHOR,EMAIL,PHONE,SENSOR,TEMPERATURE,HUMIDITY,DEWPOINT,TEMPALERT,HUMALERT,TREF)\";\nquery = query + \"VALUES ('\" + date + \"','\" + time + \"','\" + crop + \"','\" + trial + \"','\" + location + \"','\" + author + \"','\" + email + \"','\" + phone + \"','\";\nquery = query + sensor + \"','\" + temp + \"','\" + hum + \"','\" + dew + \"','\";\nquery = query + tempalert + \"','\" + humalert + \"','\" + fref + \"');\";\n\n//ID int auto_increment,DATE varchar(255),TIME varchar(255),CROP varchar(255),TRIAL varchar(255),LOCATION varchar(255),AUTHOR varchar(255),EMAIL varchar(255),PHONE INT,SENSOR varchar(255),TEMPERATURE double,HUMIDITY double,DEWPOINT double,TEMPALERT double,HUMALERT double,TREF double,primary key(ID)\n\n\ncsv = (`${date}, ${time}, ${sensor}, ${temp}, ${hum}, ${dew}, ${tempalert}, ${humalert}, ${fref}`);\n//if(status==\"ACTIVE\"){\n//    msg1 = {topic : query, payload: csv};\n//    return msg1;\n//}else{\n    //return null;\n    msg1 = {topic : query, payload: csv};\n    return msg1;\n//}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2300,"y":2700,"wires":[["4e81bae3.0e1ac4","d6e54600.11f788"]]},{"id":"3b72ffdd.1d4f","type":"function","z":"9bcfa612.592b38","name":"DataSensor13","func":"date = global.get(\"gDate\");\ntime = global.get(\"gTime\");\n\n// DATA table\ncrop=global.get(\"crop\");\ntrial=global.get(\"trial\");\nlocation=global.get(\"location\");\nauthor=global.get(\"author\");\nemail=global.get(\"email\");\nphone=global.get(\"phone\");\n\n//Sensor\nsensor=\"sensor13\";\ntemp=global.get(\"temp13\");\nhum=global.get(\"hum13\");\ndew=global.get(\"dew13\");\n//Alerts\ntempalert=global.get(\"tempalert\");\nhumalert=global.get(\"humalert\");\n\nfref=global.get(\"fRef\");\n\nquery = \"INSERT INTO DATA (DATE,TIME,CROP,TRIAL,LOCATION,AUTHOR,EMAIL,PHONE,SENSOR,TEMPERATURE,HUMIDITY,DEWPOINT,TEMPALERT,HUMALERT,TREF)\";\nquery = query + \"VALUES ('\" + date + \"','\" + time + \"','\" + crop + \"','\" + trial + \"','\" + location + \"','\" + author + \"','\" + email + \"','\" + phone + \"','\";\nquery = query + sensor + \"','\" + temp + \"','\" + hum + \"','\" + dew + \"','\";\nquery = query + tempalert + \"','\" + humalert + \"','\" + fref + \"');\";\n\n//ID int auto_increment,DATE varchar(255),TIME varchar(255),CROP varchar(255),TRIAL varchar(255),LOCATION varchar(255),AUTHOR varchar(255),EMAIL varchar(255),PHONE INT,SENSOR varchar(255),TEMPERATURE double,HUMIDITY double,DEWPOINT double,TEMPALERT double,HUMALERT double,TREF double,primary key(ID)\n\n\ncsv = (`${date}, ${time}, ${sensor}, ${temp}, ${hum}, ${dew}, ${tempalert}, ${humalert}, ${fref}`);\n//if(status==\"ACTIVE\"){\n//    msg1 = {topic : query, payload: csv};\n//    return msg1;\n//}else{\n    //return null;\n    msg1 = {topic : query, payload: csv};\n    return msg1;\n//}","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2300,"y":2740,"wires":[["4e81bae3.0e1ac4","d6e54600.11f788"]]},{"id":"5424d99f.fe6178","type":"function","z":"9bcfa612.592b38","name":"DataSensor14","func":"date = global.get(\"gDate\");\ntime = global.get(\"gTime\");\n\n// DATA table\ncrop=global.get(\"crop\");\ntrial=global.get(\"trial\");\nlocation=global.get(\"location\");\nauthor=global.get(\"author\");\nemail=global.get(\"email\");\nphone=global.get(\"phone\");\n\n//Sensor\nsensor=\"sensor14\";\ntemp=global.get(\"temp14\");\nhum=global.get(\"hum14\");\ndew=global.get(\"dew14\");\n//Alerts\ntempalert=global.get(\"tempalert\");\nhumalert=global.get(\"humalert\");\n\nfref=global.get(\"fRef\");\n\nquery = \"INSERT INTO DATA (DATE,TIME,CROP,TRIAL,LOCATION,AUTHOR,EMAIL,PHONE,SENSOR,TEMPERATURE,HUMIDITY,DEWPOINT,TEMPALERT,HUMALERT,TREF)\";\nquery = query + \"VALUES ('\" + date + \"','\" + time + \"','\" + crop + \"','\" + trial + \"','\" + location + \"','\" + author + \"','\" + email + \"','\" + phone + \"','\";\nquery = query + sensor + \"','\" + temp + \"','\" + hum + \"','\" + dew + \"','\";\nquery = query + tempalert + \"','\" + humalert + \"','\" + fref + \"');\";\n\n//ID int auto_increment,DATE varchar(255),TIME varchar(255),CROP varchar(255),TRIAL varchar(255),LOCATION varchar(255),AUTHOR varchar(255),EMAIL varchar(255),PHONE INT,SENSOR varchar(255),TEMPERATURE double,HUMIDITY double,DEWPOINT double,TEMPALERT double,HUMALERT double,TREF double,primary key(ID)\n\n\ncsv = (`${date}, ${time}, ${sensor}, ${temp}, ${hum}, ${dew}, ${tempalert}, ${humalert}, ${fref}`);\n//if(status==\"ACTIVE\"){\n//    msg1 = {topic : query, payload: csv};\n//    return msg1;\n//}else{\n    //return null;\n    msg1 = {topic : query, payload: csv};\n    return msg1;\n//}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2300,"y":2780,"wires":[["4e81bae3.0e1ac4","d6e54600.11f788"]]},{"id":"bd4857a4.7f4458","type":"function","z":"9bcfa612.592b38","name":"DataSensor15","func":"date = global.get(\"gDate\");\ntime = global.get(\"gTime\");\n\n// DATA table\ncrop=global.get(\"crop\");\ntrial=global.get(\"trial\");\nlocation=global.get(\"location\");\nauthor=global.get(\"author\");\nemail=global.get(\"email\");\nphone=global.get(\"phone\");\n\n//Sensor\nsensor=\"sensor15\";\ntemp=global.get(\"temp15\");\nhum=global.get(\"hum15\");\ndew=global.get(\"dew15\");\n//Alerts\ntempalert=global.get(\"tempalert\");\nhumalert=global.get(\"humalert\");\n\nfref=global.get(\"fRef\");\n\nquery = \"INSERT INTO DATA (DATE,TIME,CROP,TRIAL,LOCATION,AUTHOR,EMAIL,PHONE,SENSOR,TEMPERATURE,HUMIDITY,DEWPOINT,TEMPALERT,HUMALERT,TREF)\";\nquery = query + \"VALUES ('\" + date + \"','\" + time + \"','\" + crop + \"','\" + trial + \"','\" + location + \"','\" + author + \"','\" + email + \"','\" + phone + \"','\";\nquery = query + sensor + \"','\" + temp + \"','\" + hum + \"','\" + dew + \"','\";\nquery = query + tempalert + \"','\" + humalert + \"','\" + fref + \"');\";\n\n//ID int auto_increment,DATE varchar(255),TIME varchar(255),CROP varchar(255),TRIAL varchar(255),LOCATION varchar(255),AUTHOR varchar(255),EMAIL varchar(255),PHONE INT,SENSOR varchar(255),TEMPERATURE double,HUMIDITY double,DEWPOINT double,TEMPALERT double,HUMALERT double,TREF double,primary key(ID)\n\n\ncsv = (`${date}, ${time}, ${sensor}, ${temp}, ${hum}, ${dew}, ${tempalert}, ${humalert}, ${fref}`);\n//if(status==\"ACTIVE\"){\n//    msg1 = {topic : query, payload: csv};\n//    return msg1;\n//}else{\n    //return null;\n    msg1 = {topic : query, payload: csv};\n    return msg1;\n//}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2300,"y":2820,"wires":[["4e81bae3.0e1ac4","d6e54600.11f788"]]},{"id":"3289ddb8.97c442","type":"function","z":"9bcfa612.592b38","name":"DataSensor16","func":"date = global.get(\"gDate\");\ntime = global.get(\"gTime\");\n\n// DATA table\ncrop=global.get(\"crop\");\ntrial=global.get(\"trial\");\nlocation=global.get(\"location\");\nauthor=global.get(\"author\");\nemail=global.get(\"email\");\nphone=global.get(\"phone\");\n\n//Sensor\nsensor=\"sensor16\";\ntemp=global.get(\"temp16\");\nhum=global.get(\"hum16\");\ndew=global.get(\"dew16\");\n//Alerts\ntempalert=global.get(\"tempalert\");\nhumalert=global.get(\"humalert\");\n\nfref=global.get(\"fRef\");\n\nquery = \"INSERT INTO DATA (DATE,TIME,CROP,TRIAL,LOCATION,AUTHOR,EMAIL,PHONE,SENSOR,TEMPERATURE,HUMIDITY,DEWPOINT,TEMPALERT,HUMALERT,TREF)\";\nquery = query + \"VALUES ('\" + date + \"','\" + time + \"','\" + crop + \"','\" + trial + \"','\" + location + \"','\" + author + \"','\" + email + \"','\" + phone + \"','\";\nquery = query + sensor + \"','\" + temp + \"','\" + hum + \"','\" + dew + \"','\";\nquery = query + tempalert + \"','\" + humalert + \"','\" + fref + \"');\";\n\n//ID int auto_increment,DATE varchar(255),TIME varchar(255),CROP varchar(255),TRIAL varchar(255),LOCATION varchar(255),AUTHOR varchar(255),EMAIL varchar(255),PHONE INT,SENSOR varchar(255),TEMPERATURE double,HUMIDITY double,DEWPOINT double,TEMPALERT double,HUMALERT double,TREF double,primary key(ID)\n\n\ncsv = (`${date}, ${time}, ${sensor}, ${temp}, ${hum}, ${dew}, ${tempalert}, ${humalert}, ${fref}`);\n//if(status==\"ACTIVE\"){\n//    msg1 = {topic : query, payload: csv};\n//    return msg1;\n//}else{\n    //return null;\n    msg1 = {topic : query, payload: csv};\n    return msg1;\n//}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2300,"y":2860,"wires":[["4e81bae3.0e1ac4","d6e54600.11f788"]]},{"id":"fb7328e9.6a56f8","type":"function","z":"9bcfa612.592b38","name":"DataSensor17","func":"date = global.get(\"gDate\");\ntime = global.get(\"gTime\");\n\n// DATA table\ncrop=global.get(\"crop\");\ntrial=global.get(\"trial\");\nlocation=global.get(\"location\");\nauthor=global.get(\"author\");\nemail=global.get(\"email\");\nphone=global.get(\"phone\");\n\n//Sensor\nsensor=\"sensor17\";\ntemp=global.get(\"temp17\");\nhum=global.get(\"hum17\");\ndew=global.get(\"dew17\");\n//Alerts\ntempalert=global.get(\"tempalert\");\nhumalert=global.get(\"humalert\");\n\nfref=global.get(\"fRef\");\n\nquery = \"INSERT INTO DATA (DATE,TIME,CROP,TRIAL,LOCATION,AUTHOR,EMAIL,PHONE,SENSOR,TEMPERATURE,HUMIDITY,DEWPOINT,TEMPALERT,HUMALERT,TREF)\";\nquery = query + \"VALUES ('\" + date + \"','\" + time + \"','\" + crop + \"','\" + trial + \"','\" + location + \"','\" + author + \"','\" + email + \"','\" + phone + \"','\";\nquery = query + sensor + \"','\" + temp + \"','\" + hum + \"','\" + dew + \"','\";\nquery = query + tempalert + \"','\" + humalert + \"','\" + fref + \"');\";\n\n//ID int auto_increment,DATE varchar(255),TIME varchar(255),CROP varchar(255),TRIAL varchar(255),LOCATION varchar(255),AUTHOR varchar(255),EMAIL varchar(255),PHONE INT,SENSOR varchar(255),TEMPERATURE double,HUMIDITY double,DEWPOINT double,TEMPALERT double,HUMALERT double,TREF double,primary key(ID)\n\n\ncsv = (`${date}, ${time}, ${sensor}, ${temp}, ${hum}, ${dew}, ${tempalert}, ${humalert}, ${fref}`);\n//if(status==\"ACTIVE\"){\n//    msg1 = {topic : query, payload: csv};\n//    return msg1;\n//}else{\n    //return null;\n    msg1 = {topic : query, payload: csv};\n    return msg1;\n//}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2300,"y":2900,"wires":[["4e81bae3.0e1ac4","d6e54600.11f788"]]},{"id":"2f2f51ce.7c514e","type":"function","z":"9bcfa612.592b38","name":"DataSensor18","func":"date = global.get(\"gDate\");\ntime = global.get(\"gTime\");\n\n// DATA table\ncrop=global.get(\"crop\");\ntrial=global.get(\"trial\");\nlocation=global.get(\"location\");\nauthor=global.get(\"author\");\nemail=global.get(\"email\");\nphone=global.get(\"phone\");\n\n//Sensor\nsensor=\"sensor18\";\ntemp=global.get(\"temp18\");\nhum=global.get(\"hum18\");\ndew=global.get(\"dew18\");\n//Alerts\ntempalert=global.get(\"tempalert\");\nhumalert=global.get(\"humalert\");\n\nfref=global.get(\"fRef\");\n\nquery = \"INSERT INTO DATA (DATE,TIME,CROP,TRIAL,LOCATION,AUTHOR,EMAIL,PHONE,SENSOR,TEMPERATURE,HUMIDITY,DEWPOINT,TEMPALERT,HUMALERT,TREF)\";\nquery = query + \"VALUES ('\" + date + \"','\" + time + \"','\" + crop + \"','\" + trial + \"','\" + location + \"','\" + author + \"','\" + email + \"','\" + phone + \"','\";\nquery = query + sensor + \"','\" + temp + \"','\" + hum + \"','\" + dew + \"','\";\nquery = query + tempalert + \"','\" + humalert + \"','\" + fref + \"');\";\n\n//ID int auto_increment,DATE varchar(255),TIME varchar(255),CROP varchar(255),TRIAL varchar(255),LOCATION varchar(255),AUTHOR varchar(255),EMAIL varchar(255),PHONE INT,SENSOR varchar(255),TEMPERATURE double,HUMIDITY double,DEWPOINT double,TEMPALERT double,HUMALERT double,TREF double,primary key(ID)\n\n\ncsv = (`${date}, ${time}, ${sensor}, ${temp}, ${hum}, ${dew}, ${tempalert}, ${humalert}, ${fref}`);\n//if(status==\"ACTIVE\"){\n//    msg1 = {topic : query, payload: csv};\n//    return msg1;\n//}else{\n    //return null;\n    msg1 = {topic : query, payload: csv};\n    return msg1;\n//}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2300,"y":2940,"wires":[["4e81bae3.0e1ac4","d6e54600.11f788"]]},{"id":"3c9ef764.57a168","type":"exec","z":"9bcfa612.592b38","command":" sudo rm -r /your location/file_name.csv","addpay":"","append":"","useSpawn":"false","timer":"","oldrc":false,"name":"Erase","x":2250,"y":3220,"wires":[["281a7799.d1d128","2bffd4c5.f14c6c"],[],[]]},{"id":"281a7799.d1d128","type":"function","z":"9bcfa612.592b38","name":"FINAL FUNCTION TO CREATE CSV FROM DATA","func":"var experiment = global.get(\"trial\");\nmsg.topic = \"(SELECT 'DATE','TIME','AUTHOR','EMAIL','PHONE','SENSOR','TEMPERATURE','HUMIDITY','DEWPOINT') UNION ALL (SELECT DATE,TIME,AUTHOR,EMAIL,PHONE,SENSOR,TEMPERATURE,HUMIDITY,DEWPOINT FROM DATA WHERE TRIAL = \\'\"+ experiment +\"\\' ORDER BY id ASC INTO OUTFILE '/your location/file_name.csv' FIELDS TERMINATED BY ',' LINES TERMINATED BY '\\n');\";\nmsg.csv = true;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2530,"y":3200,"wires":[["4e81bae3.0e1ac4"]]},{"id":"e8b3b323.4c56a","type":"inject","z":"9bcfa612.592b38","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":3460,"y":2560,"wires":[["d103c67c.432a58"]]},{"id":"d103c67c.432a58","type":"function","z":"9bcfa612.592b38","name":"Rename Table","func":"var out =\"RENAME TABLE DATA TO OLD_DATA;\"\nmsg={payload: out, topic:out};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":3660,"y":2560,"wires":[[]]},{"id":"f0142f93.58781","type":"function","z":"9bcfa612.592b38","name":"CREATE TABLE DATA","func":"var out =\"create table DATA(ID int auto_increment,DATE varchar(255),TIME varchar(255),CROP varchar(255),TRIAL varchar(255),LOCATION varchar(255),AUTHOR varchar(255),EMAIL varchar(255),PHONE INT,SENSOR varchar(255),TEMPERATURE double,HUMIDITY double,DEWPOINT double,TEMPALERT double,HUMALERT double,primary key(ID));\"\nmsg={payload: out, topic:out};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":3680,"y":2600,"wires":[[]]},{"id":"fa4dbbb6.ba3818","type":"inject","z":"9bcfa612.592b38","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":3460,"y":2600,"wires":[["f0142f93.58781"]]},{"id":"30522855.68c078","type":"function","z":"9bcfa612.592b38","name":"ADD COLUMN","func":"var out =\"ALTER TABLE DATA add TREF double;\"\nmsg={payload: out, topic:out};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3660,"y":2640,"wires":[[]]},{"id":"61ba02bb.81d63c","type":"inject","z":"9bcfa612.592b38","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":3460,"y":2640,"wires":[["30522855.68c078"]]},{"id":"2bffd4c5.f14c6c","type":"debug","z":"9bcfa612.592b38","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":2580,"y":3260,"wires":[]},{"id":"b0f3060c.bd83f8","type":"debug","z":"9bcfa612.592b38","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":3240,"y":2480,"wires":[]},{"id":"e74ca220.1a435","type":"mysql","z":"9bcfa612.592b38","mydb":"d7c7e5cb.50c878","name":"CONFIG","x":2460,"y":3400,"wires":[["e032bc54.04124"]]},{"id":"142245e0.be85ca","type":"inject","z":"9bcfa612.592b38","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":3460,"y":2700,"wires":[["c03ad666.e85578"]]},{"id":"c03ad666.e85578","type":"function","z":"9bcfa612.592b38","name":"Rename Table","func":"var out =\"RENAME TABLE DATA TO OLD_DATA3;\"\nmsg={payload: out, topic:out};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3660,"y":2700,"wires":[[]]},{"id":"c15d9e2a.c971b","type":"function","z":"9bcfa612.592b38","name":"CREATE TABLE CONFIG","func":"var out =\"create table CONFIG(ID int auto_increment,DATE varchar(255),TIME varchar(255),CROP varchar(255),TRIAL varchar(255),LOCATION varchar(255),AUTHOR varchar(255),EMAIL varchar(255),PHONE INT,CTRL_STATUS varchar(255),FANS_TREFS varchar(255),TREF1 double,TREF2 double,TREF3 double,TEMPALERT double,HUMALERT double,CONNECT_COOLSYS varchar(255),COOL_SYS varchar(255),COOL_SYS_STATE varchar(255),primary key(ID));\"\nmsg={payload: out, topic:out};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":3690,"y":2740,"wires":[[]]},{"id":"bc53e77a.ad0b78","type":"inject","z":"9bcfa612.592b38","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":3460,"y":2740,"wires":[["c15d9e2a.c971b"]]},{"id":"e14d4d38.a4c83","type":"function","z":"9bcfa612.592b38","name":"ADD COLUMN","func":"var out =\"ALTER TABLE CONFIG add FANR4 varchar(255);\"\nmsg={payload: out, topic:out};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":3660,"y":2780,"wires":[[]]},{"id":"f150f558.ab9258","type":"inject","z":"9bcfa612.592b38","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":3460,"y":2780,"wires":[["e14d4d38.a4c83"]]},{"id":"21193967.9d50b6","type":"function","z":"9bcfa612.592b38","name":"Config data","func":"date = global.get(\"gDate\");\ntime = global.get(\"gTime\");\n\n// DATA table\ncrop=global.get(\"crop\");\ntrial=global.get(\"trial\");\nlocation=global.get(\"location\");\nauthor=global.get(\"author\");\nemail=global.get(\"email\");\nphone=global.get(\"phone\");\n\n//CONTROL PARAMETERS\nctrl_status=global.get(\"status\");\nfanl1=global.get(\"fanl1\");//fanl1=JSON.stringify(fanl1);\nfanl2=global.get(\"fanl2\");//fanl2=JSON.stringify(fanl2);\nfanr3=global.get(\"fanr3\");//fanr3=JSON.stringify(fanr3);\nfanr4=global.get(\"fanr4\");//fanr4=JSON.stringify(fanr4);\nfans_trefs = {\"fanl1\":fanl1,\"fanl2\":fanl2,\"fanr3\":fanr3,\"fanr4\":fanr4};//Every fan connected to every tref\\\nfans_trefs=JSON.stringify(fans_trefs);\n//fans_trefs = \"fans\";\n//node.log(typeof data);\n//fans_trefs = JSON.stringify(fans_trefs);\ntref1=global.get(\"fRef1\");\ntref2=global.get(\"fRef2\");\ntref3=global.get(\"fRef3\");\nconnect_coolsys=global.get(\"temp2humstate\");//Connect the cooling system with the temp control or let it manually\nconnect_coolsys=JSON.stringify(connect_coolsys);\ncool_sys=global.get(\"Csprog\");//schedule\ncool_sys_state = global.get(\"cooling_state\");//when manually is activated the cooling system\n\n//Alerts\ntempalert=global.get(\"tempalert\");\nhumalert=global.get(\"humalert\");\n\nquery = \"INSERT INTO CONFIG (DATE,TIME,CROP,TRIAL,LOCATION,AUTHOR,EMAIL,PHONE,CTRL_STATUS,FANS_TREFS,TREF1,TREF2,TREF3,TEMPALERT,HUMALERT,CONNECT_COOLSYS,COOL_SYS,COOL_SYS_STATE)\";\nquery = query + \"VALUES ('\" + date + \"','\" + time + \"','\" + crop + \"','\" + trial + \"','\" + location + \"','\" + author + \"','\" + email + \"','\" + phone + \"','\";\nquery = query + ctrl_status + \"','\" + fans_trefs + \"','\" + tref1 + \"','\" + tref2 + \"','\";\nquery = query + tref3 + \"','\" + tempalert + \"','\" + humalert + \"','\" + connect_coolsys + \"','\";\nquery = query + cool_sys + \"','\" + cool_sys_state + \"');\";\n\n    auto_restart=global.get(\"auto_restart\");\n    if(auto_restart == false){\n    msg1 = {topic : query, payload: query};\n    return msg1;\n    }else{\n        query = \"SELECT * FROM CONFIG ORDER BY CONFIG.ID DESC LIMIT 1;\"\n        msg2 = {topic: query};\n        return msg2;\n    }\n//}","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2230,"y":3340,"wires":[["e74ca220.1a435","ab66f2ed.b0e95","8ced23b3.82c88"]]},{"id":"a1b421c.ac1c6e","type":"debug","z":"9bcfa612.592b38","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":1880,"y":2300,"wires":[]},{"id":"795441f3.e9559","type":"link in","z":"9bcfa612.592b38","name":"Save Config","links":["3f78e770.2e82d8","4dad6333.f7efbc","1a558da4.043e82","fe8c8cf3.b30de","7a56e512.3ef4bc"],"x":2075,"y":3340,"wires":[["f75fde52.fda5e","21193967.9d50b6"]]},{"id":"4dad6333.f7efbc","type":"link out","z":"359ed2dc.ceea6e","name":"","links":["795441f3.e9559"],"x":3355,"y":2420,"wires":[]},{"id":"1a558da4.043e82","type":"link out","z":"359ed2dc.ceea6e","name":"","links":["795441f3.e9559"],"x":3035,"y":2820,"wires":[]},{"id":"ab66f2ed.b0e95","type":"debug","z":"9bcfa612.592b38","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":2550,"y":3300,"wires":[]},{"id":"1eb022f2.8acedd","type":"inject","z":"9bcfa612.592b38","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":1900,"y":3300,"wires":[["21193967.9d50b6"]]},{"id":"6f834a23.bc5a84","type":"link in","z":"359ed2dc.ceea6e","name":"vent_in","links":["7879f6e7.cb8fb8","8d587392.32f9e"],"x":1875,"y":2920,"wires":[["c2d98c64.baea","f6d2645b.6304b8"]]},{"id":"f75fde52.fda5e","type":"debug","z":"9bcfa612.592b38","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":1810,"y":3400,"wires":[]},{"id":"d7b3614a.23cbb","type":"trigger","z":"359ed2dc.ceea6e","name":"","op1":"","op2":"","op1type":"nul","op2type":"date","duration":"5","extend":true,"overrideDelay":false,"units":"s","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":2780,"y":3100,"wires":[["1a558da4.043e82"]]},{"id":"8f8cf8c1.9775f8","type":"function","z":"9bcfa612.592b38","name":"MODIFY COLUMN","func":"var out =\"ALTER TABLE CONFIG CHANGE CONNECT_COOLSYS CONNECT_COOLSYS JSON;\"\nmsg={payload: out, topic:out};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":3670,"y":2820,"wires":[[]]},{"id":"4ad3fa0c.ae7104","type":"inject","z":"9bcfa612.592b38","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":3460,"y":2820,"wires":[["8f8cf8c1.9775f8"]]},{"id":"ec20f9e0.6d7768","type":"function","z":"9bcfa612.592b38","name":"DROP COLUMN","func":"var out =\"ALTER TABLE CONFIG DROP COLUMN FANR4;\"\nmsg={payload: out, topic:out};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":3670,"y":2860,"wires":[[]]},{"id":"c0a7e17f.482e6","type":"inject","z":"9bcfa612.592b38","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":3460,"y":2860,"wires":[["ec20f9e0.6d7768"]]},{"id":"376989ec.deb256","type":"trigger","z":"359ed2dc.ceea6e","name":"","op1":"","op2":"","op1type":"nul","op2type":"payl","duration":"1","extend":true,"overrideDelay":false,"units":"s","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":2580,"y":3040,"wires":[["5232725a.20502c","1458656a.7c864b"]]},{"id":"1458656a.7c864b","type":"debug","z":"359ed2dc.ceea6e","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":2990,"y":3060,"wires":[]},{"id":"9f9de43.4fff218","type":"function","z":"359ed2dc.ceea6e","name":"","func":"p=msg.payload;\nss=global.get(\"send_state\");\nif(ss==undefined){\n    global.set(\"send_state\",0);\n}\nif(p==0){\n    global.set(\"send_state\",0);\n}else if(p==1){\n    global.set(\"send_state\",1);\n}\n\nif(ss!=p){\nreturn msg;\n}else if(ss==p){\n    \n}","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2640,"y":3140,"wires":[["d7b3614a.23cbb"]]},{"id":"df60ffaa.a9e93","type":"ui_template","z":"9bcfa612.592b38","group":"d745c5b4.683f88","name":"Download","order":7,"width":6,"height":1,"format":"<script>\n    (function(scope) {\n      scope.$watch('msg', function(msg) {\n        if (msg.payload == \"Download\") {\n            downloadFile();\n            //alert(msg.payload);\n        }\n      });\n    })(scope);\n    \n    //function downloadFile(data, fileName, type=\"text/plain\") {\n    function downloadFile(type=\"text/csv\") {\n      // Create an invisible A element\n      const a = document.createElement(\"a\");\n      a.style.display = \"none\";\n      document.body.appendChild(a);\n    \n      // Set the HREF to a Blob representation of the data to be downloaded\n      a.href = \"/files/conf_zs48.csv\"; /*window.URL.createObjectURL(\n        new Blob([data], { type })\n      );*/\n    \n      // Use download attribute to set set desired file name\n      //a.setAttribute(\"download\", fileName);\n    \n      // Trigger the download by simulating click\n      a.click();\n    \n      // Cleanup\n      window.URL.revokeObjectURL(a.href);\n      document.body.removeChild(a);\n    }\n</script>","storeOutMessages":false,"fwdInMessages":true,"resendOnRefresh":false,"templateScope":"local","x":2360,"y":3980,"wires":[[]]},{"id":"669f4035.75a8a","type":"function","z":"9bcfa612.592b38","name":"FINAL FUNCTION TO CREATE CSV FROM CONFIG","func":"var experiment = global.get(\"trial\");\nmsg.topic = \"(SELECT 'ID','DATE','TIME','CROP','TRIAL','LOCATION','CTRL_STATUS','TREF1','TREF2','TREF3','TEMPALERT','HUMALERT','COOL_SYS_STATE') UNION ALL (SELECT ID,DATE,TIME,CROP,TRIAL,LOCATION,CTRL_STATUS,TREF1,TREF2,TREF3,TEMPALERT,HUMALERT,COOL_SYS_STATE FROM CONFIG WHERE TRIAL = \\'\"+ experiment +\"\\' ORDER BY id  ASC INTO OUTFILE '/your location/file_name.csv' FIELDS TERMINATED BY ',' LINES TERMINATED BY '\\n');\";\nmsg.csv = true;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2560,"y":3520,"wires":[["e74ca220.1a435"]]},{"id":"8ced23b3.82c88","type":"exec","z":"9bcfa612.592b38","command":" sudo rm -r /your location/file_name.csv","addpay":"","append":"","useSpawn":"false","timer":"","oldrc":false,"name":"Erase","x":2250,"y":3500,"wires":[["669f4035.75a8a"],[],[]]},{"id":"3ae95e08.83ae52","type":"ui_template","z":"9bcfa612.592b38","group":"d745c5b4.683f88","name":"ui_template - present download links on dashboard","order":1,"width":0,"height":0,"format":"<div >\n    <a href=\"/your location/file_name.csv\" style=\"color: BLUE\">DOWNLOAD EXPERIMENT DATA</a>\n</div>","storeOutMessages":true,"fwdInMessages":true,"resendOnRefresh":false,"templateScope":"local","x":2250,"y":4080,"wires":[[]]},{"id":"3c78bf5d.949e4","type":"ui_template","z":"9bcfa612.592b38","group":"d745c5b4.683f88","name":"ui_template - present download links on dashboard","order":2,"width":0,"height":0,"format":"<div >\n    <a href=\"/your location/file_name.csv\" style=\"color: GREEN\">DOWNLOAD CONFIG DATA</a>\n</div>","storeOutMessages":true,"fwdInMessages":true,"resendOnRefresh":false,"templateScope":"local","x":2750,"y":4080,"wires":[[]]},{"id":"ab9fb435.0e2b08","type":"ui_text","z":"359ed2dc.ceea6e","group":"7b3878b4.914658","order":1,"width":2,"height":1,"name":"Fan State","label":"EXTRACTOR 1","format":"{{msg.payload}}","layout":"col-center","x":3280,"y":2000,"wires":[]},{"id":"2965fd07.bbfbc2","type":"ui_text","z":"359ed2dc.ceea6e","group":"7b3878b4.914658","order":2,"width":2,"height":1,"name":"Fan State","label":"EXTRACTOR 2","format":"{{msg.payload}}","layout":"col-center","x":3280,"y":2040,"wires":[]},{"id":"afa7952b.456528","type":"ui_text","z":"359ed2dc.ceea6e","group":"7b3878b4.914658","order":3,"width":2,"height":1,"name":"Fan State","label":"EXTRACTOR 3","format":"{{msg.payload}}","layout":"col-center","x":3280,"y":2080,"wires":[]},{"id":"f9a8fc8b.75e04","type":"ui_text","z":"359ed2dc.ceea6e","group":"7b3878b4.914658","order":4,"width":2,"height":1,"name":"Fan State","label":"EXTRACTOR 4","format":"{{msg.payload}}","layout":"col-center","x":3280,"y":2120,"wires":[]},{"id":"5e9ea3ca.4d1abc","type":"function","z":"359ed2dc.ceea6e","name":"","func":"//show in dashboard the state of every extractor\nfl1=global.get(\"fl1cs\");\nfl2=global.get(\"fl2cs\");\nfr3=global.get(\"fr3cs\");\nfr4=global.get(\"fr4cs\");\nmsg1={payload:fl1};//left 1\nmsg2={payload:fl2};//left 2\nmsg3={payload:fr3};//right 1\nmsg4={payload:fr4};//right 2\nreturn [msg1,msg2,msg3,msg4];","outputs":4,"noerr":0,"initialize":"","finalize":"","libs":[],"x":3100,"y":2060,"wires":[["ab9fb435.0e2b08"],["2965fd07.bbfbc2"],["afa7952b.456528"],["f9a8fc8b.75e04"]]},{"id":"1a0c8bcd.916d24","type":"ui_button","z":"9bcfa612.592b38","d":true,"name":"trash","group":"d745c5b4.683f88","order":5,"width":3,"height":1,"passthru":false,"label":"","tooltip":"","color":"","bgcolor":"gray","icon":"fa-trash","payload":"Really delete ALL data?","payloadType":"str","topic":"","x":2130,"y":3860,"wires":[["ebd700c4.d0ba2"]]},{"id":"5cc887fb.a58aa8","type":"ui_button","z":"9bcfa612.592b38","d":true,"name":"download","group":"d745c5b4.683f88","order":4,"width":3,"height":1,"passthru":false,"label":"Config Data","tooltip":"","color":"","bgcolor":"#008000","icon":"fa-download","payload":"Download Config Data","payloadType":"str","topic":"","x":2160,"y":3980,"wires":[["df60ffaa.a9e93"]]},{"id":"f908ab89.2d4348","type":"ui_button","z":"9bcfa612.592b38","d":true,"name":"download","group":"d745c5b4.683f88","order":3,"width":6,"height":1,"passthru":false,"label":"EXPERIMENT DATA","tooltip":"","color":"","bgcolor":"#3296FF","icon":"fa-download","payload":"Download Exp Data","payloadType":"str","topic":"","x":2140,"y":3820,"wires":[["1f95f753.7cb1c9"]]},{"id":"c6165ea8.9b2a9","type":"ui_time_scheduler","z":"359ed2dc.ceea6e","group":"ed07161e.0a9588","name":"","startDay":0,"refresh":60,"devices":["Cooling System Valve"],"singleOff":false,"onlySendChange":false,"customPayload":false,"eventMode":false,"eventOptions":[],"sendTopic":false,"lat":"","lon":"","customContextStore":"","outputs":2,"order":14,"width":0,"height":0,"x":2350,"y":2980,"wires":[["7f70e569.7cbeac","cb4229c6.350c48"],["5232725a.20502c"]]},{"id":"f8ccee5f.ad5aa","type":"ui_list","z":"359ed2dc.ceea6e","group":"b6dea28f.35559","name":"Connect Cooling","order":8,"width":6,"height":1,"lineType":"one","actionType":"check","allowHTML":false,"outputs":1,"topic":"","x":2690,"y":2700,"wires":[["d912a0c6.5b47"]]},{"id":"bd512536.cdf3b8","type":"function","z":"98e3ec9b.ecb6a","name":"FL1","func":"//apply the configuration selected and extracted from MySQL after unexpected reboot\nstatus=global.get(\"status\");\nif (status==\"ACTIVE\"){\n    msg={enabled: false, background: \"transparent\", payload:global.get(\"fanl1\")}\n    fl1 = global.get(\"fanl1\");\n    global.set(\"fl1_tr1\",fl1[0].isChecked);\n    global.set(\"fl1_tr2\",fl1[1].isChecked);\n    global.set(\"fl1_tr3\",fl1[2].isChecked);\n    return msg;\n}else{\n    msg={enabled: true, payload:global.get(\"fanl1\")}\n    return msg;\n}\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2170,"y":2460,"wires":[["999c51eb.92623","88ffd608.322028"]]},{"id":"d158bda9.52e9d","type":"inject","z":"98e3ec9b.ecb6a","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":true,"onceDelay":"1","topic":"","payload":"","payloadType":"date","x":1990,"y":2400,"wires":[["610a05e2.30fffc","412d5e1e.115c8","988a3adf.a33758","c5e056f7.63dbf8"]]},{"id":"999c51eb.92623","type":"ui_list","z":"98e3ec9b.ecb6a","group":"afb24e79.9b765","name":"","order":1,"width":6,"height":3,"lineType":"one","actionType":"check","allowHTML":false,"outputs":1,"topic":"","x":2370,"y":2400,"wires":[["193c9e26.637292"]]},{"id":"921e9db6.228cc","type":"debug","z":"98e3ec9b.ecb6a","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":2730,"y":2400,"wires":[]},{"id":"193c9e26.637292","type":"function","z":"98e3ec9b.ecb6a","name":"","func":"fl1 = msg.payload;\ntr1state = global.get(\"fl1_tr1\");\ntr2state = global.get(\"fl1_tr2\");\ntr3state = global.get(\"fl1_tr3\");\ntitle=fl1.title;\nif(title === \"TempRef1\"){\n    tr1state=fl1.isChecked;\n    global.set(\"fl1_tr1\",tr1state);\n}\nif(title === \"TempRef2\"){\n    tr2state=fl1.isChecked;\n    global.set(\"fl1_tr2\",tr2state);\n}\nif(title === \"TempRef3\"){\n    tr3state=fl1.isChecked;\n    global.set(\"fl1_tr3\",tr3state);\n}\nfanl1 = [{\"title\":\"TempRef1\",\"isChecked\":tr1state},\n{\"title\":\"TempRef2\",\"isChecked\":tr2state},\n{\"title\":\"TempRef3\",\"isChecked\":tr3state}]\n\nglobal.set(\"fanl1\",fanl1);\nmsg.payload = fanl1;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2540,"y":2400,"wires":[["921e9db6.228cc","7a56e512.3ef4bc"]]},{"id":"88ffd608.322028","type":"debug","z":"98e3ec9b.ecb6a","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":2450,"y":2460,"wires":[]},{"id":"610a05e2.30fffc","type":"function","z":"98e3ec9b.ecb6a","name":"","func":"    //Initialize ventilation selector\n    global.set(\"fl1_tr1\",true);\n    global.set(\"fl1_tr2\",true);\n    global.set(\"fl1_tr3\",true);\n    fanl1 = [{\"title\":\"TempRef1\",\"isChecked\":true},\n    {\"title\":\"TempRef2\",\"isChecked\":true},\n    {\"title\":\"TempRef3\",\"isChecked\":true}]\n    global.set(\"fanl1\",fanl1);\n    msg.payload = fanl1;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2160,"y":2400,"wires":[["999c51eb.92623","22cf3397.5259ec"]]},{"id":"22cf3397.5259ec","type":"debug","z":"98e3ec9b.ecb6a","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":2290,"y":2340,"wires":[]},{"id":"c6ba470b.37e6d8","type":"function","z":"98e3ec9b.ecb6a","name":"FL2","func":"\n\nstatus=global.get(\"status\");\nif (status==\"ACTIVE\"){\n    msg={enabled: false, background: \"transparent\", payload:global.get(\"fanl2\")}\n    fl2 = global.get(\"fanl2\");\n    global.set(\"fl2_tr1\",fl2[0].isChecked);\n    global.set(\"fl2_tr2\",fl2[1].isChecked);\n    global.set(\"fl2_tr3\",fl2[2].isChecked);\n    return msg;\n}else{\n    msg={enabled: true, payload:global.get(\"fanl2\")}    \n    return msg;\n}\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2190,"y":2620,"wires":[["2935ef9b.589c2","a85b5d04.4d6ff"]]},{"id":"2935ef9b.589c2","type":"ui_list","z":"98e3ec9b.ecb6a","group":"a83c6fd2.b673","name":"","order":1,"width":6,"height":3,"lineType":"one","actionType":"check","allowHTML":false,"outputs":1,"topic":"","x":2370,"y":2560,"wires":[["e7df6001.40813"]]},{"id":"ce7ecc44.13a76","type":"debug","z":"98e3ec9b.ecb6a","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":2730,"y":2560,"wires":[]},{"id":"e7df6001.40813","type":"function","z":"98e3ec9b.ecb6a","name":"","func":"fl2 = msg.payload;\ntr1state = global.get(\"fl2_tr1\");\ntr2state = global.get(\"fl2_tr2\");\ntr3state = global.get(\"fl2_tr3\");\ntitle=fl2.title;\nif(title === \"TempRef1\"){\n    tr1state=fl2.isChecked;\n    global.set(\"fl2_tr1\",tr1state);\n}\nif(title === \"TempRef2\"){\n    tr2state=fl2.isChecked;\n    global.set(\"fl2_tr2\",tr2state);\n}\nif(title === \"TempRef3\"){\n    tr3state=fl2.isChecked;\n    global.set(\"fl2_tr3\",tr3state);\n}\nfanl2 = [{\"title\":\"TempRef1\",\"isChecked\":tr1state},\n{\"title\":\"TempRef2\",\"isChecked\":tr2state},\n{\"title\":\"TempRef3\",\"isChecked\":tr3state}]\nglobal.set(\"fanl2\",fanl2);\nmsg.payload = fanl2;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2540,"y":2560,"wires":[["ce7ecc44.13a76","7a56e512.3ef4bc"]]},{"id":"a85b5d04.4d6ff","type":"debug","z":"98e3ec9b.ecb6a","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":2450,"y":2620,"wires":[]},{"id":"412d5e1e.115c8","type":"function","z":"98e3ec9b.ecb6a","name":"","func":"    //Ventilation\n    global.set(\"fl2_tr1\",true);\n    global.set(\"fl2_tr2\",true);\n    global.set(\"fl2_tr3\",true);\n    fanl2 = [{\"title\":\"TempRef1\",\"isChecked\":true},\n    {\"title\":\"TempRef2\",\"isChecked\":true},\n    {\"title\":\"TempRef3\",\"isChecked\":true}]\n    global.set(\"fanl2\",fanl2);\n    msg.payload = fanl2;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2160,"y":2560,"wires":[["2935ef9b.589c2","c771105c.475ec"]]},{"id":"c771105c.475ec","type":"debug","z":"98e3ec9b.ecb6a","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":2290,"y":2500,"wires":[]},{"id":"732cdbeb.6e8084","type":"function","z":"98e3ec9b.ecb6a","name":"FR3","func":"\nstatus=global.get(\"status\");\nif (status==\"ACTIVE\"){\n    msg={enabled: false, background: \"transparent\", payload:global.get(\"fanr3\")}\n    fr3 = global.get(\"fanr3\");\n    global.set(\"fr3_tr1\",fr3[0].isChecked);\n    global.set(\"fr3_tr2\",fr3[1].isChecked);\n    global.set(\"fr3_tr3\",fr3[2].isChecked);    \n    return msg;\n}else{\n    msg={enabled: true, payload:global.get(\"fanr3\")}\n    return msg;\n}\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2210,"y":2800,"wires":[["fbc81a9f.2f4e18","3099db65.20d0e4"]]},{"id":"fbc81a9f.2f4e18","type":"ui_list","z":"98e3ec9b.ecb6a","group":"e9e68015.2f878","name":"","order":1,"width":6,"height":3,"lineType":"one","actionType":"check","allowHTML":false,"outputs":1,"topic":"","x":2390,"y":2740,"wires":[["c78e7af3.2b46b8"]]},{"id":"453f559c.7261ec","type":"debug","z":"98e3ec9b.ecb6a","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":2750,"y":2740,"wires":[]},{"id":"c78e7af3.2b46b8","type":"function","z":"98e3ec9b.ecb6a","name":"","func":"fr3 = msg.payload;\ntr1state = global.get(\"fr3_tr1\");\ntr2state = global.get(\"fr3_tr2\");\ntr3state = global.get(\"fr3_tr3\");\ntitle=fr3.title;\nif(title === \"TempRef1\"){\n    tr1state=fr3.isChecked;\n    global.set(\"fr3_tr1\",tr1state);\n}\nif(title === \"TempRef2\"){\n    tr2state=fr3.isChecked;\n    global.set(\"fr3_tr2\",tr2state);\n}\nif(title === \"TempRef3\"){\n    tr3state=fr3.isChecked;\n    global.set(\"fr3_tr3\",tr3state);\n}\nfanr3 = [{\"title\":\"TempRef1\",\"isChecked\":tr1state},\n{\"title\":\"TempRef2\",\"isChecked\":tr2state},\n{\"title\":\"TempRef3\",\"isChecked\":tr3state}]\nglobal.set(\"fanr3\",fanr3);\nmsg.payload = fanr3;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2560,"y":2740,"wires":[["453f559c.7261ec","7a56e512.3ef4bc"]]},{"id":"3099db65.20d0e4","type":"debug","z":"98e3ec9b.ecb6a","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":2470,"y":2800,"wires":[]},{"id":"988a3adf.a33758","type":"function","z":"98e3ec9b.ecb6a","name":"","func":"    //Ventilation\n    global.set(\"fr3_tr1\",true);\n    global.set(\"fr3_tr2\",true);\n    global.set(\"fr3_tr3\",true);\n    fanr3 = [{\"title\":\"TempRef1\",\"isChecked\":true},\n    {\"title\":\"TempRef2\",\"isChecked\":true},\n    {\"title\":\"TempRef3\",\"isChecked\":true}]\n    global.set(\"fanr3\",fanr3);\n    msg.payload = fanr3;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2180,"y":2740,"wires":[["fbc81a9f.2f4e18","88fd4242.54f26"]]},{"id":"88fd4242.54f26","type":"debug","z":"98e3ec9b.ecb6a","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":2310,"y":2680,"wires":[]},{"id":"1673ae0c.f34962","type":"function","z":"98e3ec9b.ecb6a","name":"FR4","func":"\n\nstatus=global.get(\"status\");\nif (status==\"ACTIVE\"){\n    msg={enabled: false, background: \"transparent\", payload:global.get(\"fanr4\")}\n    fr4 = global.get(\"fanr4\");\n    global.set(\"fr4_tr1\",fr4[0].isChecked);\n    global.set(\"fr4_tr2\",fr4[1].isChecked);\n    global.set(\"fr4_tr3\",fr4[2].isChecked);    \n    return msg;\n}else{\n    msg={enabled: true, payload:global.get(\"fanr4\")}\n    return msg;\n}\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2210,"y":2980,"wires":[["b5f6bc57.3a47f","ff602787.4c7ea8"]]},{"id":"b5f6bc57.3a47f","type":"ui_list","z":"98e3ec9b.ecb6a","group":"7cb1faaf.799074","name":"","order":1,"width":6,"height":3,"lineType":"one","actionType":"check","allowHTML":false,"outputs":1,"topic":"","x":2390,"y":2920,"wires":[["41b4e80c.47e908"]]},{"id":"f186b8a4.166f68","type":"debug","z":"98e3ec9b.ecb6a","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":2750,"y":2920,"wires":[]},{"id":"41b4e80c.47e908","type":"function","z":"98e3ec9b.ecb6a","name":"","func":"fr4 = msg.payload;\ntr1state = global.get(\"fr4_tr1\");\ntr2state = global.get(\"fr4_tr2\");\ntr3state = global.get(\"fr4_tr3\");\ntitle=fr4.title;\nif(title === \"TempRef1\"){\n    tr1state=fr4.isChecked;\n    global.set(\"fr4_tr1\",tr1state);\n}\nif(title === \"TempRef2\"){\n    tr2state=fr4.isChecked;\n    global.set(\"fr4_tr2\",tr2state);\n}\nif(title === \"TempRef3\"){\n    tr3state=fr4.isChecked;\n    global.set(\"fr4_tr3\",tr3state);\n}\nfanr4 = [{\"title\":\"TempRef1\",\"isChecked\":tr1state},\n{\"title\":\"TempRef2\",\"isChecked\":tr2state},\n{\"title\":\"TempRef3\",\"isChecked\":tr3state}]\nglobal.set(\"fanr4\",fanr4);\nmsg.payload = fanr4;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2540,"y":2920,"wires":[["f186b8a4.166f68","7a56e512.3ef4bc"]]},{"id":"ff602787.4c7ea8","type":"debug","z":"98e3ec9b.ecb6a","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":2470,"y":2980,"wires":[]},{"id":"c5e056f7.63dbf8","type":"function","z":"98e3ec9b.ecb6a","name":"","func":"    //Ventilation\n    global.set(\"fr4_tr1\",true);\n    global.set(\"fr4_tr2\",true);\n    global.set(\"fr4_tr3\",true);\n    fanr4 = [{\"title\":\"TempRef1\",\"isChecked\":true},\n    {\"title\":\"TempRef2\",\"isChecked\":true},\n    {\"title\":\"TempRef3\",\"isChecked\":true}]\n    global.set(\"fanr4\",fanr4);\n    msg.payload = fanr4;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2180,"y":2920,"wires":[["b5f6bc57.3a47f","d32497d3.76d308"]]},{"id":"d32497d3.76d308","type":"debug","z":"98e3ec9b.ecb6a","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":2310,"y":2860,"wires":[]},{"id":"f43e21c6.01994","type":"comment","z":"98e3ec9b.ecb6a","name":"Fan Selector","info":"","x":2290,"y":2300,"wires":[]},{"id":"6b41844.56c7a7c","type":"inject","z":"98e3ec9b.ecb6a","d":true,"name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"10","crontab":"","once":true,"onceDelay":"40","topic":"","payload":"","payloadType":"date","x":1890,"y":2620,"wires":[["bd512536.cdf3b8","c6ba470b.37e6d8","732cdbeb.6e8084","1673ae0c.f34962"]]},{"id":"7a56e512.3ef4bc","type":"link out","z":"98e3ec9b.ecb6a","name":"","links":["795441f3.e9559"],"x":3015,"y":2660,"wires":[]},{"id":"a63c8ed.f7b3d7","type":"link in","z":"98e3ec9b.ecb6a","name":"vent_in","links":["7879f6e7.cb8fb8","8d587392.32f9e"],"x":1895,"y":2680,"wires":[["bd512536.cdf3b8","c6ba470b.37e6d8","732cdbeb.6e8084","1673ae0c.f34962"]]},{"id":"1f5139cf.c654b6","type":"comment","z":"359ed2dc.ceea6e","name":"Cooling system (Readme)","info":"This is based on a system controlled by \nelectrovalves which controls the flow of water trhough the soil inside greenhouse.\n\nThis can be used also for controlling a irrigation system for the plants based on times to open or close the valves based on the needs of the plants.\n\nThe control is connected to the pin35 in the Raspberry Pi. However you can change it as well as you need.","x":2660,"y":2640,"wires":[]},{"id":"dffd6a4d.f7c8c8","type":"comment","z":"359ed2dc.ceea6e","name":"Control of extractors (Readme)","info":"This is based on a system controlled by \nrelays connected to the Raspberry Pi and an adittional electrical power system to control motors.\n\nThese motors are working as heat extractors (extractors/fans), and will be controlled regarding to the data from sensors and references set by user in dashboard.\n\nThere are four extractors connected to the pins 29,31,33 and 36 of the Raspberry Pi. We called them:\nFan left 1 (fl1)\nFan left 2 (fl2)\nFan right 1 (fr1)\nFan right 2 (fr2)","x":2470,"y":1800,"wires":[]},{"id":"83491da9.897bc","type":"comment","z":"9bcfa612.592b38","name":"Download data (Readme)","info":"These are the flows needed to download the data stored in the table DATA inside your database.\n\nRemember that this will only download your information related to the current trial in course selected by user in dashboard.\n\nThis was done in that way to do not overload the Raspberry Pi with downloading very heavy files\n\nNote that are created two files to be downloaded.\n\nOne file is from DATA database and contains all information from sensors stored.\nThe second one is from SETTINGS database, where are stored all configuration that user set before.\n\nThen is possible to download both files with different information but depending on the current trial name.\n\nPLEASE MAKE SURE THAT THE TWO FILES (FROM DATA AND CONFIG) ARE NAMED CORRECLTY AND DIFFERENT.","x":2270,"y":3100,"wires":[]},{"id":"cf8723a1.efb04","type":"comment","z":"9bcfa612.592b38","name":"Store in Database(Readme)","info":"These flows are for storing in the database.\n\nNote that data will be stored every ten minutes. You can change this in the \"Store interval\" node.\n\nData will be saved in the table DATA (you can change this on every DataSensor node).\n\nRemember that data must coincide with the columns in the created table.\n\nHere you will find also the email sending flow for alerts notification to the user.","x":2240,"y":1880,"wires":[]},{"id":"db440145.395fd","type":"comment","z":"9bcfa612.592b38","name":"Here you will download from DATA (Name the file)","info":"","x":2220,"y":4040,"wires":[]},{"id":"d2d8e70.4eff618","type":"comment","z":"9bcfa612.592b38","name":"Here you will download from CONFIG (Name the file)","info":"","x":2730,"y":4040,"wires":[]},{"id":"ae3c214a.8b411","type":"comment","z":"9bcfa612.592b38","name":"Create / modifiy MySQL tables (Readme)","info":"You can create or modify your MySQL tables from here.\n\nMake sure that your connection with your database is correctly configured.","x":3620,"y":2480,"wires":[]}]